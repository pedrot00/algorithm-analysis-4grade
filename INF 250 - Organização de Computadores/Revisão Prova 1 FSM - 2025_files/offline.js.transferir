(function(g){var window=this;'use strict';var hXr=function(L){var m=new g.t3("und",new g.p3("Default","und",!0));m.captionTracks=L.captionTracks;return m},rx_=function(L){return new g.fG(function(m,n){var C=L.length,Z=[];
if(C)for(var z=function(T,V){C--;Z[T]=V;C==0&&m(Z)},v=function(T){n(T)},X,N=0;N<L.length;N++)X=L[N],g.hM3(X,g.ip(z,N),v);
else m(Z)})},Fz=function(L){this.W=L},u1=function(){Fz.apply(this,arguments)},koH=function(){u1.apply(this,arguments)},HAF=function(){u1.apply(this,arguments)},YUw=function(){u1.apply(this,arguments)},WUz=function(){u1.apply(this,arguments)},Gof=function(){u1.apply(this,arguments)},dTp=function(){u1.apply(this,arguments)},KU1=function(){u1.apply(this,arguments)},xTH=function(){Fz.apply(this,arguments)},yx$=function(){u1.apply(this,arguments)},jEF=function(){u1.apply(this,arguments)},ocZ=function(){u1.apply(this,
arguments)},cxf=function(){u1.apply(this,arguments)},LV$=function(){u1.apply(this,arguments)},mEr=function(){u1.apply(this,arguments)},ndf=function(){u1.apply(this,arguments)},C7f=function(){u1.apply(this,arguments)},ZqD=function(){u1.apply(this,arguments)},zHJ=function(){u1.apply(this,arguments)},vd0=function(){u1.apply(this,arguments)},EdJ=function(){u1.apply(this,arguments)},Xlr=function(){Fz.apply(this,arguments)},No1=function(){u1.apply(this,arguments)},ToJ=function(){u1.apply(this,arguments)},
VUD=function(){u1.apply(this,arguments)},iqF=function(){u1.apply(this,arguments)},$EF=function(){u1.apply(this,arguments)},anl=function(){u1.apply(this,arguments)},qRH=function(){u1.apply(this,arguments)},DEp=function(){u1.apply(this,arguments)},Oqp=function(){u1.apply(this,arguments)},lnF=function(){Fz.apply(this,arguments)},RHJ=function(){Fz.apply(this,arguments)},wlf=function(){Fz.apply(this,arguments)},eH$=function(){u1.apply(this,arguments)},gdF=function(){u1.apply(this,arguments)},MUl=function(){u1.apply(this,
arguments)},SRF=function(){u1.apply(this,arguments)},In1=function(){u1.apply(this,arguments)},Jd0=function(){u1.apply(this,arguments)},AdZ=function(){u1.apply(this,arguments)},bqZ=function(){u1.apply(this,arguments)},tU$=function(){u1.apply(this,arguments)},fnw=function(){u1.apply(this,arguments)},UEr=function(){u1.apply(this,arguments)},BoF=function(){u1.apply(this,arguments)},P7r=function(){u1.apply(this,arguments)},sAo=function(){u1.apply(this,arguments)},QAZ=function(){u1.apply(this,arguments)},
pll=function(){u1.apply(this,arguments)},FVZ=function(){u1.apply(this,arguments)},uHf=function(){u1.apply(this,arguments)},hHD=function(){u1.apply(this,arguments)},rdH=function(){u1.apply(this,arguments)},kNw=function(){u1.apply(this,arguments)},Hq$=function(){u1.apply(this,arguments)},YRr=function(){u1.apply(this,arguments)},WVH=function(){u1.apply(this,arguments)},GN$=function(){u1.apply(this,arguments)},dE_=function(){u1.apply(this,arguments)},KVw=function(){u1.apply(this,arguments)},xEr=function(){Fz.apply(this,
arguments)},yd0=function(){u1.apply(this,arguments)},jAD=function(){u1.apply(this,arguments)},odz=function(){u1.apply(this,arguments)},cdp=function(){u1.apply(this,arguments)},LY_=function(){u1.apply(this,arguments)},mFH=function(){u1.apply(this,arguments)},noH=function(){u1.apply(this,arguments)},CSw=function(){u1.apply(this,arguments)},ZGz=function(){u1.apply(this,arguments)},zS_=function(){u1.apply(this,arguments)},vow=function(){u1.apply(this,arguments)},Eol=function(){u1.apply(this,arguments)},
XRD=function(){u1.apply(this,arguments)},NFZ=function(){u1.apply(this,arguments)},TFH=function(){u1.apply(this,arguments)},V1Z=function(){u1.apply(this,arguments)},iGw=function(){u1.apply(this,arguments)},$F_=function(){u1.apply(this,arguments)},akH=function(){u1.apply(this,arguments)},qqz=function(){u1.apply(this,arguments)},DFp=function(){u1.apply(this,arguments)},OGp=function(){u1.apply(this,arguments)},lk_=function(){u1.apply(this,arguments)},RS1=function(){u1.apply(this,arguments)},wRf=function(){u1.apply(this,
arguments)},eSw=function(){u1.apply(this,arguments)},go$=function(){u1.apply(this,arguments)},M10=function(){u1.apply(this,arguments)},Sqf=function(){u1.apply(this,arguments)},Ik_=function(){u1.apply(this,arguments)},J50=function(){u1.apply(this,arguments)},A5p=function(){u1.apply(this,arguments)},bG1=function(){u1.apply(this,arguments)},t1Z=function(){u1.apply(this,arguments)},fkr=function(L){L=L.key||L.id;
if(!L)throw Error("Entity key is missing");return L},UF$=function(){if(he)return he();
var L={};he=g.or("PersistentEntityStoreDb",{b_:(L.EntityStore={LH:1},L.EntityAssociationStore={LH:2},L),shared:!1,upgrade:function(m,n){n(1)&&g.PE(g.A4(m,"EntityStore",{keyPath:"key"}),"entityType","entityType");n(2)&&(m=g.A4(m,"EntityAssociationStore",{keyPath:["parentEntityKey","childEntityKey"]}),g.PE(m,"byParentEntityKey","parentEntityKey"),g.PE(m,"byChildEntityKey","childEntityKey"))},
version:3});return he()},BFF=function(L){return g.kG(UF$(),L)},PS_=function(L){return g.kG((0,g.i6$)(),L)},rk=function(L){this.token=L},k$=function(L,m){m=m===void 0?{}:m;
g.YZ.call(this,g.$Nw[L],Object.assign({},{name:"PESEncoderError",type:L},m));this.type=L;this.level="WARNING";Object.setPrototypeOf(this,k$.prototype)},sFf=function(L){return new k$("WRONG_DATA_TYPE",{Dz:L})},QFr=function(L){return L instanceof Error?new k$("UNKNOWN_ENCODE_ERROR",{originalMessage:L.message}):new k$("UNKNOWN_ENCODE_ERROR")},pRF=function(L){return L instanceof Error?new k$("UNKNOWN_DECODE_ERROR",{originalMessage:L.message}):new k$("UNKNOWN_DECODE_ERROR")},FY1=function(L,m){L=L instanceof
k$?L:m(L);
g.fp(L);throw L;},uN0=function(){},hSo=function(L,m,n){try{return L.G(m,n)}catch(C){FY1(C,QFr)}},r5p=function(L){L=(new TextEncoder).encode(L).subarray(0,16);
var m=new Uint8Array(16);m.set(L);return m},Hw=function(L){this.W=L},HGF=function(L){var m=kFr[L];
if(m)return m;g.U$(new g.YZ("Entity model not found.",{entityType:L}))},Yqw=function(L,m){this.W=L;
this.J=m;this.G={}},GF1=function(L,m){a:{L=WY$(L.J,m.version);
try{var n=L.J(m.data,m.key);break a}catch(C){FY1(C,pRF)}n=void 0}return n},Y$=function(L,m,n){return L.W.objectStore("EntityStore").get(m).then(function(C){if(C){if(n&&C.entityType!==n)throw Error("Incorrect entity type");
return GF1(L,C)}})},Ww=function(L,m,n){return n?(n=n.map(function(C){return Y$(L,C,m)}),g.w9.all(n)):L.W.objectStore("EntityStore").index("entityType").getAll(IDBKeyRange.only(m)).then(function(C){return C.map(function(Z){return GF1(L,Z)})})},dk=function(L,m,n){var C=fkr(m),Z=WY$(L.J,1),z=Object.assign({},m);
return L.W.objectStore("EntityStore").get(C).then(function(v){if(v){if(v.entityType!==n)throw Error("Incorrect entity type");z.entityMetadata||(v=GF1(L,v),z.entityMetadata=v.entityMetadata)}}).then(function(){var v={key:C,
entityType:n,data:hSo(Z,z,C),version:1};return g.w9.all([g.fj(L.W.objectStore("EntityStore"),v),dFw(L,z,n)])}).then(function(){GM(L,C,n);
return C})},KYp=function(L,m,n){m=m.map(function(C){return dk(L,C,n)});
return g.w9.all(m)},KE=function(L,m,n){if(n==null?0:n.Fm){var C=new Set;
return xFp(L,m,C).then(function(){for(var z=[],v=g.M(C),X=v.next();!X.done;X=v.next())z.push(KE(L,X.value));return g.w9.all(z).then(function(){})})}var Z=g.ot(m).entityType;
return g.w9.all([L.W.objectStore("EntityStore").delete(m),y5F(L,m)]).then(function(){GM(L,m,Z)})},jFf=function(L,m){return g.F2(L.W.objectStore("EntityStore").index("entityType"),{query:IDBKeyRange.only(m)},function(n){return g.w9.all([n.delete(),
y5F(L,n.cursor.primaryKey)]).then(function(){GM(L,n.cursor.primaryKey,m);return g.Q3(n)})})},oop=function(L,m,n,C){var Z=WY$(L.J,1);
return Y$(L,m,C).then(function(z){if(z){z=g.vq(z,n);var v={key:m,entityType:C,data:hSo(Z,z,m),version:1};return g.w9.all([g.fj(L.W.objectStore("EntityStore"),v),dFw(L,z,C)])}}).then(function(){GM(L,m,C);
return m})},GM=function(L,m,n){var C=L.G[n];
C||(C=new Set,L.G[n]=C);C.add(m)},c5z=function(L,m,n){var C=fkr(m);
n=HGF(n);if(!n)return g.w9.resolve([]);n=new n(m);L=L.W.objectStore("EntityAssociationStore");m=[];n=g.M(n.J());for(var Z=n.next();!Z.done;Z=n.next())m.push(g.fj(L,{parentEntityKey:C,childEntityKey:Z.value}));return g.w9.all(m).then(function(z){return z.map(function(v){return v[1]})})},y5F=function(L,m){return L.W.objectStore("EntityAssociationStore").index("byParentEntityKey").delete(IDBKeyRange.only(m))},dFw=function(L,m,n){var C=fkr(m);
return y5F(L,C).then(function(){return c5z(L,m,n)})},xFp=function(L,m,n){if(n.has(m))return g.w9.resolve(void 0);
n.add(m);return LjZ(L,m).then(function(C){return L.W.objectStore("EntityAssociationStore").index("byParentEntityKey").delete(IDBKeyRange.only(m)).then(function(){return C})}).then(function(C){var Z=g.w9.resolve(void 0);
C=g.M(C);for(var z=C.next(),v={};!z.done;v={SE:void 0},z=C.next())v.SE=z.value,Z=Z.then(function(X){return function(){return xFp(L,X.SE,n)}}(v));
return Z}).then(function(){})},LjZ=function(L,m){var n=L.W.objectStore("EntityAssociationStore");
return n.index("byParentEntityKey").getAll(IDBKeyRange.only(m)).then(function(C){var Z=[];C=g.M(C);for(var z=C.next();!z.done;z=C.next())z=z.value,Z.push(n.index("byChildEntityKey").getAll(z.childEntityKey));return g.w9.all(Z)}).then(function(C){var Z=[];
C=g.M(C);for(var z=C.next();!z.done;z=C.next())z=z.value,z.length===1&&Z.push(z[0].childEntityKey);return Z})},x$=function(){},mpw=function(){this.W={};
this.W[0]=new x$;if(!g.wy("aes_pes_encoder_killswitch")){var L=this.W;try{var m=g.WW();var n=r5p(m);var C=new Hw(new g.aw(n),new g.qk(n))}catch(Z){throw L=Z instanceof Error?new k$("KEY_CREATION_FAILED",{originalMessage:Z.message}):new k$("KEY_CREATION_FAILED"),g.fp(L),L;}L[1]=C}},WY$=function(L,m){m=m===void 0?0:m;
L=L.W[m];if(!L)throw m=new k$("INVALID_ENCODER_VERSION",{Dz:m}),g.fp(m),m;return L},yV=function(L,m){g.u.call(this);
this.token=L;this.W=m;this.observers=[];L=new g.oU.BroadcastChannel("PERSISTENT_ENTITY_STORE_SYNC:"+g.WW());L.onmessage=this.J.bind(this);this.channel=L},jj=function(L,m,n){var C,Z,z,v;
return g.B(function(X){if(X.W==1)return g.U(X,BFF(L.token),2);if(X.W!=3)return C=X.J,g.U(X,g.t4(C,["EntityStore","EntityAssociationStore"],m,function(N){Z=new Yqw(N,L.W);return n(Z)}),3);
z=X.J;Z&&(v=Z.G,Object.keys(v).length>0&&(L.channel.postMessage(v),nz0(L,v)));return X.return(z)})},o2=function(L,m,n){return jj(L,{mode:"readwrite",
Tb:!0},function(C){return dk(C,m,n)})},Cyz=function(L,m){return jj(L,{mode:"readwrite",
Tb:!0},function(n){return KYp(n,m,"offlineOrchestrationActionWrapperEntity")})},Z_1=function(L,m){return jj(L,{mode:"readwrite",
Tb:!0},function(n){return KE(n,m)})},zyo=function(L){return jj(L,{mode:"readwrite",
Tb:!0},function(m){return jFf(m,"videoPlaybackPositionEntity")})},cw=function(L,m,n){return jj(L,{mode:"readonly",
Tb:!0},function(C){return Y$(C,m,n)})},LL=function(L,m,n){return jj(L,{mode:"readonly",
Tb:!0},function(C){return Ww(C,m,n)})},nz0=function(L,m){L=g.M(L.observers);
for(var n=L.next();!n.done;n=L.next())n=n.value,n(m)},vzp=function(){var L,m,n;
return g.B(function(C){if(C.W==1)return g.M3(C,2),g.U(C,g.y3(),4);if(C.W!=2){L=C.J;if(!L||!g.G4()||typeof g.oU.BroadcastChannel==="undefined")return C.return();m=new mpw;return C.return(new yV(L,m))}n=g.fJ(C);n instanceof Error&&g.fp(n);return C.return()})},ms=function(){EzJ||(EzJ=vzp());
return EzJ},XhD=function(L){var m;
L=(m=L.options)==null?void 0:m.persistenceOption;return L==="ENTITY_PERSISTENCE_OPTION_PERSIST"||L==="ENTITY_PERSISTENCE_OPTION_INMEMORY_AND_PERSIST"},NIw=function(L){var m;
return g.B(function(n){return n.W==1?g.U(n,ms(),2):(m=n.J)?g.U(n,jj(m,"readwrite",function(C){for(var Z={},z=g.M(L),v=z.next(),X={};!v.done;X={Sl:void 0,Nz:void 0},v=z.next())X.Sl=v.value,X.Sl.entityKey&&XhD(X.Sl)&&(X.Nz=g.zf(X.Sl.payload),v=void 0,X.Sl.type==="ENTITY_MUTATION_TYPE_REPLACE"&&(v=function(N){return function(){return dk(C,N.Sl.payload[N.Nz],N.Nz)}}(X)),X.Sl.type==="ENTITY_MUTATION_TYPE_DELETE"&&(v=function(N){return function(){return KE(C,N.Sl.entityKey)}}(X)),X.Sl.type==="ENTITY_MUTATION_TYPE_UPDATE"&&
(v=function(N){return function(){return oop(C,N.Sl.entityKey,N.Sl.payload[N.Nz],N.Nz)}}(X)),v&&(Z[X.Sl.entityKey]=Z[X.Sl.entityKey]?Z[X.Sl.entityKey].then(v):v()));
return g.w9.all(Object.values(Z))}),0):n.return()})},TI$=function(L){var m;
return g.B(function(n){if(n.W==1){m=L.mutations;if(!m||m.length<=0)return n.return();if(g.BH){var C={type:"ENTITY_LOADED"};m!==void 0&&(C.payload=m);g.BH.dispatch(C)}return g.U(n,NIw(m),2)}m.length=0;g.gp(n)})},VJl=function(L){return L!==void 0},i_0=function(L){var m=g.Xw();
m=Object.assign({},m);L=Object.assign({},L);for(var n in m)L[n]?(m[n]!==4&&(m[n]=L[n]),delete L[n]):m[n]!==2&&(m[n]=4);Object.assign(m,L);g.j$g(m);JSON.stringify(m);return m},$pp=function(L){var m,n;
return g.B(function(C){if(C.W==1)return g.U(C,g.y3(),2);if(C.W!=3)return(m=C.J)?g.U(C,g.VP(m),3):C.return();n=C.J;return C.return(g.t4(n,["index","media","captions"],{mode:"readwrite",Tb:!0},function(Z){var z=IDBKeyRange.bound(L+"|",L+"~");Z=[Z.objectStore("index").delete(z),Z.objectStore("media").delete(z),Z.objectStore("captions").delete(z)];return g.w9.all(Z).then(function(){})}))})},aGo=function(){var L,m;
return g.B(function(n){if(n.W==1)return g.U(n,g.y3(),2);if(n.W!=3){L=n.J;if(!L)throw g.lU("rvdfd");return g.U(n,g.VP(L),3)}m=n.J;return n.return(g.t4(m,["index","media"],{mode:"readwrite",Tb:!0},function(C){var Z={};return g.sD(C.objectStore("index"),{},function(z){var v=z.cursor.key.match(/^([\w\-_]+)\|(a|v)$/),X=g.w9.resolve(void 0);if(v){var N=v[1];v=v[2];Z[N]=Z[N]||{};var T;Z[N][v]=g.ng8((T=z.getValue())==null?void 0:T.fmts)}else X=z.delete().then(function(){});
return g.w9.all([g.Q3(z),X]).then(function(V){return g.M(V).next().value})}).then(function(){for(var z={},v=g.M(Object.keys(Z)),X=v.next();!X.done;X=v.next()){X=X.value;
var N=Z[X].v;z[X]=Z[X].a&&N?1:2}var T=i_0(z);return g.Bz_(C.objectStore("media"),{},function(V){var a=V.cursor.key.match(g.vgd);a&&z[a[1]]||C.objectStore("media").delete(V.cursor.key);return g.MWd(V)}).then(function(){return T})})}))})},qVz=function(L,m){var n,C;
return g.B(function(Z){if(Z.W==1)return g.U(Z,g.y3(),2);if(Z.W!=3){n=Z.J;if(!n)throw g.lU("wct");return g.U(Z,g.VP(n),3)}C=Z.J;return g.U(Z,g.t4(C,["captions"],{mode:"readwrite",Tb:!0},function(z){var v=[];z=z.objectStore("captions");for(var X=0;X<m.length;X++){var N=g.fj(z,m[X],L+"|"+m[X].metadata.vss_id);v.push(N)}return g.w9.all(v)}),0)})},Dp0=function(L){var m,n,C;
return g.B(function(Z){if(Z.W==1)return m=IDBKeyRange.bound(L+"|",L+"~"),g.U(Z,g.y3(),2);if(Z.W!=3){n=Z.J;if(!n)throw g.lU("gactfv");return g.U(Z,g.VP(n),3)}C=Z.J;return Z.return(C.getAll("captions",m))})},O_H=function(L){return g.B(function(m){g.Tq(L,0);
return m.return($pp(L))})},lGr=function(L){return{context:g.ov(),
videoIds:L}},RyJ=function(L){return{context:g.ov(),
playlistIds:L}},whZ=function(L){return{context:g.ov(),
offlinePlaylistSyncChecks:L}},eyw=function(){this.W=new Map},MJl=function(){gzf||(gzf=new eyw);
return gzf},SVo=function(L,m){return{eventType:{flowEventNamespace:"FLOW_EVENT_NAMESPACE_OFFLINE_ORCHESTRATION",
flowEventType:L},metadata:m,statusCode:void 0,csn:void 0,can:void 0}},IGr=function(L,m,n){if(!n){var C=C===void 0?!1:C;
n=L.W.get("FLOW_TYPE_OFFLINE_ORCHESTRATION");if(!n||C)n=g.lt(16),L.W.set("FLOW_TYPE_OFFLINE_ORCHESTRATION",n)}L={flowNonce:n,flowType:"FLOW_TYPE_OFFLINE_ORCHESTRATION",flowEventType:m.eventType};m.metadata&&(L.flowMetadata=m.metadata);m.statusCode!==void 0&&(L.flowEventStatus=m.statusCode);m.csn&&(L.csn=m.csn);m.can&&(L.can=m.can);g.vE("flowEvent",L,void 0)},Jk1=function(L){var m,n,C,Z,z,v,X,N,T,V,a,q,D,O,e,I,t,b,P,F,r,x,Y,Ed,N3,ZF,$P,mZ,J_,xP,Vw,T0,h_,Bm,nX,Pz,k_,EC,f,UC;
return g.B(function(JJ){if(JJ.W==1)return g.U(JJ,jj(L,{mode:"readonly",Tb:!0},function(CJ){return Ww(CJ,"playbackData").then(function(AJ){var S=AJ.map(function(F$){return F$.transfer}).filter(function(F$){return!!F$}),nJ=AJ.map(function(F$){return F$.offlineVideoPolicy}).filter(function(F$){return!!F$}),Au=AJ.filter(function(F$){return!!F$.key}).map(function(F$){return g.cq(g.ot(F$.key).entityId,"downloadStatusEntity")});
S=Ww(CJ,"transfer",S);nJ=Ww(CJ,"offlineVideoPolicy",nJ);Au=Ww(CJ,"downloadStatusEntity",Au);var y7=S.then(function(F$){F$=F$.reduce(function(KJ,mD){(mD==null?0:mD.offlineVideoStreams)&&KJ.push.apply(KJ,g.q3(mD.offlineVideoStreams));return KJ},[]).filter(function(KJ){return!!KJ});
return Ww(CJ,"offlineVideoStreams",F$)});
return g.w9.all([S,nJ,y7,Au]).then(function(F$){var KJ=g.M(F$);F$=KJ.next().value;var mD=KJ.next().value;var Zj=KJ.next().value;KJ=KJ.next().value;return[AJ,F$,mD,Zj,KJ]})})}),2);
if(JJ.W!=3)return m=JJ.J,g.U(JJ,jj(L,{mode:"readonly",Tb:!0},function(CJ){return Ww(CJ,"mainDownloadsListEntity").then(function(AJ){var S,nJ;return(nJ=(S=AJ[0])==null?void 0:S.downloads)!=null?nJ:[]})}),3);
n=JJ.J;C=g.M(m);Z=C.next().value;z=C.next().value;v=C.next().value;X=C.next().value;N=C.next().value;T=Z;V=z;a=v;q=X;D=N;O={};e={};I={};t={};b={};P=[];F=g.M(V);for(r=F.next();!r.done;r=F.next())(x=r.value)&&(O[x.key]=x);Y=g.M(a);for(Ed=Y.next();!Ed.done;Ed=Y.next())(N3=Ed.value)&&(e[N3.key]=N3);ZF=g.M(D);for($P=ZF.next();!$P.done;$P=ZF.next())(mZ=$P.value)&&(I[mZ.key]=mZ);J_=g.M(q);for(xP=J_.next();!xP.done;xP=J_.next())(Vw=xP.value)&&(t[Vw.key]=Vw);T0=g.M(n);for(h_=T0.next();!h_.done;h_=T0.next())Bm=
h_.value,nX=void 0,b[(nX=Bm.videoItem)!=null?nX:""]=!0,Bm.videoItem&&(k_=Pz=void 0,EC=(k_=(Pz=g.ot(Bm.videoItem))==null?void 0:Pz.entityId)!=null?k_:"",P.push({externalVideoId:EC}));f=T.filter(function(CJ){if(!CJ||!CJ.key||!CJ.offlineVideoPolicy)return!1;CJ=g.ot(CJ.key).entityId;CJ=g.cq(CJ,"downloadStatusEntity");var AJ;return!(CJ&&((AJ=I[CJ])==null?void 0:AJ.downloadState)==="DOWNLOAD_STATE_USER_DELETED")});
UC=f.map(function(CJ){var AJ=O[CJ.transfer],S=[];if(AJ==null?0:AJ.offlineVideoStreams)for(var nJ=g.M(AJ.offlineVideoStreams),Au=nJ.next();!Au.done;Au=nJ.next())(Au=t[Au.value])&&S.push(Au);nJ=e[CJ.offlineVideoPolicy];Au=b;var y7=CJ==null?void 0:CJ.playerResponseTimestamp,F$=g.ot(nJ.key).entityId;CJ=g.cq(F$,"mainVideoEntity");if(nJ.action==="OFFLINE_VIDEO_POLICY_ACTION_DISABLE"){var KJ="OFFLINE_VIDEO_STATE_DISABLED";nJ.expirationTimestamp&&Number(nJ.expirationTimestamp)<Date.now()/1E3&&(KJ="OFFLINE_VIDEO_STATE_EXPIRED")}else if(nJ.action===
"OFFLINE_VIDEO_POLICY_ACTION_DOWNLOAD_FAILED")KJ="OFFLINE_VIDEO_STATE_OFFLINE_FAILED";else{switch(AJ==null?void 0:AJ.transferState){case "TRANSFER_STATE_TRANSFER_IN_QUEUE":KJ="OFFLINE_VIDEO_STATE_PENDING";break;case "TRANSFER_STATE_TRANSFERRING":KJ="OFFLINE_VIDEO_STATE_TRANSFERRING";break;case "TRANSFER_STATE_PAUSED_BY_USER":KJ="OFFLINE_VIDEO_STATE_PAUSED_TRANSFER";break;case "TRANSFER_STATE_FAILED":KJ="OFFLINE_VIDEO_STATE_OFFLINE_FAILED";break;case "TRANSFER_STATE_COMPLETE":KJ="OFFLINE_VIDEO_STATE_PLAYABLE";
break;case "TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH":KJ="OFFLINE_VIDEO_STATE_STREAMS_OUT_OF_DATE";break;default:KJ="OFFLINE_VIDEO_STATE_UNKNOWN"}if(KJ==="OFFLINE_VIDEO_STATE_OFFLINE_FAILED")switch(AJ==null?void 0:AJ.failureReason){case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":KJ="OFFLINE_VIDEO_STATE_OUT_OF_STORAGE_ERROR";break;case "TRANSFER_FAILURE_REASON_STREAM_MISSING":KJ="OFFLINE_VIDEO_STATE_STREAMS_MISSING";break;case "TRANSFER_FAILURE_REASON_NETWORK":case "TRANSFER_FAILURE_REASON_NETWORK_LOST":KJ=
"OFFLINE_VIDEO_STATE_NETWORK_ERROR"}}F$={id:F$,videoState:KJ};if(AJ==null?0:AJ.cotn)F$.cotn=AJ.cotn;if(AJ==null?0:AJ.maximumDownloadQuality)F$.selectedVideoQuality=AJ==null?void 0:AJ.maximumDownloadQuality;if(AJ==null?0:AJ.lastProgressTimeMs)F$.lastProgressTimeMs=AJ.lastProgressTimeMs;y7&&(F$.playerResponseSavedTimeMs=String(Number(y7)*1E3));AJ=String;y7=0;S=g.M(S);for(KJ=S.next();!KJ.done;KJ=S.next())if(KJ=KJ.value,KJ.streamsProgress){KJ=g.M(KJ.streamsProgress);for(var mD=KJ.next();!mD.done;mD=KJ.next()){var Zj=
void 0;y7+=Number((Zj=mD.value.numBytesDownloaded)!=null?Zj:0)}}F$.downloadedBytes=AJ(y7);F$.selectedOfflineMode=Au[CJ]?"OFFLINE_MODE_TYPE_AUTO_OFFLINE":"OFFLINE_NOW";nJ.action==="OFFLINE_VIDEO_POLICY_ACTION_DISABLE"&&(F$.offlinePlaybackDisabledReason=nJ.offlinePlaybackDisabledReason);return F$});
return JJ.return({offlineVideos:UC,additionalOfflineClientState:{mainAppAdditionalOfflineClientState:{smartDownloadVideos:P}}})})},Akf=function(){this.locks=navigator.locks},b_1=function(){try{var L=g.LF("ytglobal.locks_");
if(L)return L;var m;if(m=navigator){var n=navigator;m="locks"in n&&!!n.locks}if(m)return g.oU.localStorage&&g.oU.localStorage.getItem("noop"),L=new Akf,g.cm("ytglobal.locks_",L),L}catch(C){}},nL=function(){},tJD=function(){},fGD=function(L){if(L.includes(":"))throw Error("Invalid user cache name: "+L);
return L+":"+g.WW("CacheStorage get")},Upz=function(){return g.B(function(L){if(CL!==void 0)return L.return(CL);
CL=new Promise(function(m){var n;return g.B(function(C){switch(C.W){case 1:return g.M3(C,2),g.U(C,ZN.open("test-only"),4);case 4:return g.U(C,ZN.delete("test-only"),5);case 5:g.t_(C,3);break;case 2:if(n=g.fJ(C),n instanceof Error&&n.name==="SecurityError")return m(!1),C.return();case 3:m("caches"in window),g.gp(C)}})});
return L.return(CL)})},Py1=function(){return g.B(function(L){if(L.W==1)return g.U(L,Upz(),2);
if(!L.J)return L.return(void 0);BIw||(BIw=new tJD);return L.return(BIw)})},z8=function(L,m,n){g.U$(new g.YZ("Woffle: "+L,n?{cotn:n}:""));
m instanceof Error&&g.U$(m)},ss1=function(L){var m;
return g.B(function(n){if(n.W==1)return g.U(n,Jk1(L),2);m=n.J;g.vE("offlineStateSnapshot",m);g.gp(n)})},vU=function(L){g.u.call(this);
var m=this;this.api=L;this.Xe={XqU:function(){return m.W},
cBb:function(){return m.J}};
typeof g.oU.BroadcastChannel!=="undefined"&&(this.W=new g.oU.BroadcastChannel("PLAYER_OFFLINE_ERROR_SYNC:"+g.WW()),this.W.onmessage=this.G.bind(this),this.J=new g.oU.BroadcastChannel("PLAYER_OFFLINE_PAUSE_SYNC:"+g.WW()),this.J.onmessage=this.L.bind(this))},EP=function(L,m){L.api.Vd("onOfflineOperationFailure",m);
var n;(n=L.W)==null||n.postMessage(m)},QsD=function(L,m,n){var C=this;
this.C=L;this.X=m;this.visibility=n;this.K=this.B=this.S=this.G=this.W=!1;this.L=new g.jW(function(){C.FY()});
this.Xe={nk:function(){return C.J},
FY:function(){C.FY()},
SM3:function(){return C.L}};
this.visibility.subscribe("visibilitystatechange",function(){C.oU()})},phF=function(L){if(!L.G&&!L.W){var m=b_1();
if(m){L.G=!0;var n=g.WW("OfflineLockManager");m.request("woffle_orchestration_leader:"+n,{},function(){var C,Z;return g.B(function(z){switch(z.W){case 1:return g.M3(z,2),L.J=new g.$z,L.W=!0,L.G=!1,g.U(z,L.C(),4);case 4:return g.U(z,L.J.promise,5);case 5:g.t_(z,0);break;case 2:C=g.fJ(z),L.FY(),C instanceof Error&&(Z=C,Z.args=[{name:"WoLockManagerError",Yq:C.name}],g.fp(Z)),g.gp(z)}})})}}},Fjw=function(L){L.W&&(L.K=!0,XF(L))},uyl=function(L,m){L.W&&(L.S=m,XF(L))},hyJ=function(L,m){L.W&&(L.B=m,XF(L))},
XF=function(L){L.B&&L.S&&L.K&&L.visibility.isBackground()?g.oa(L.L,6E4):L.L.stop()},N2=function(L){var m;
L.offlineDeleteReason=(m=L.offlineDeleteReason)!=null?m:"OFFLINE_DELETE_REASON_UNKNOWN";var n;L.offlineModeType=(n=L.offlineModeType)!=null?n:"OFFLINE_NOW";g.vE("offlineDeleteEvent",L)},T8=function(L,m){var n=m.videoId;
var C=m.jZ;m=m.offlineModeType;L.encryptedVideoId=n;L.cotn=C==null?void 0:C.cotn;L.offlineabilityFormatType=C==null?void 0:C.maximumDownloadQuality;var Z;L.isRefresh=(Z=C==null?void 0:C.isRefresh)!=null?Z:!1;var z;L.softErrorCount=(z=C==null?void 0:C.transferRetryCount)!=null?z:0;L.offlineModeType=m!=null?m:"OFFLINE_NOW";(L.transferStatusType==="TRANSFER_STATUS_TYPE_UNKNOWN"&&L.statusType==="UNKNOWN_STATUS_TYPE"||!L.transferStatusType&&!L.statusType)&&g.U$(Error("Woffle unknown transfer status"));
g.vE("offlineTransferStatusChanged",L)},rkw=function(L){T8({transferStatusType:"TRANSFER_STATUS_TYPE_ENQUEUED",
statusType:"ADDED_TO_QUEUE"},L)},kJl=function(L,m,n,C){C={transferStatusType:"TRANSFER_STATUS_TYPE_PROCESSING",
statusType:"OFFLINING_STARTED",transferFirstStarted:!!C};m&&n&&(m=Math.floor(m/1024).toFixed(),n=Math.floor(n/1024).toFixed(),C.alreadyDownloadedKbytes=m,C.totalFetchedKbytes=m,C.totalContentKbytes=n);T8(C,L)},H_Z=function(L){T8({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_PLAYER_RESPONSE_REFRESH"},L)},YVD=function(L){T8({transferStatusType:"TRANSFER_STATUS_TYPE_DEQUEUED_BY_USER_PAUSE",
statusType:"SUSPENDED"},L)},Wjz=function(L){switch(L){case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":return"OFFLINE_DATABASE_ERROR";
case "TRANSFER_FAILURE_REASON_PLAYABILITY":return"NOT_PLAYABLE";case "TRANSFER_FAILURE_REASON_TOO_MANY_RETRIES":return"TOO_MANY_RETRIES";case "TRANSFER_FAILURE_REASON_INTERNAL":return"OFFLINE_DOWNLOAD_CONTROLLER_ERROR";case "TRANSFER_FAILURE_REASON_STREAM_MISSING":return"STREAM_VERIFICATION_FAILED";case "TRANSFER_FAILURE_REASON_SERVER":case "TRANSFER_FAILURE_REASON_SERVER_PROPERTY_MISSING":return"OFFLINE_REQUEST_FAILURE";case "TRANSFER_FAILURE_REASON_NETWORK":return"OFFLINE_NETWORK_ERROR";default:return"UNKNOWN_FAILURE_REASON"}},
VH=function(L){var m,n,C;
return((C=(m=L.actionMetadata)==null?void 0:(n=m.retryScheduleIntervalsInSeconds)==null?void 0:n.length)!=null?C:0)>0},iE=function(L){return L.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD"&&!!L.entityKey},$t=function(L){return L.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&!!L.entityKey},aR=function(L){return L.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&!!L.entityKey},GJl=function(L){return L.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_UPDATE"&&!!L.entityKey},
q2=function(L,m,n,C,Z){Z=Z===void 0?!1:Z;
var z,v,X,N,T,V;return g.B(function(a){if(a.W==1)return z=g.cq(L,m),v=g.cq(L,"downloadStatusEntity"),g.U(a,jj(n,{mode:"readonly",Tb:!0},function(q){return g.w9.all([Y$(q,z,m),Y$(q,v,"downloadStatusEntity")])}),2);
X=a.J;N=X.length?X[0]:void 0;if(!N)return a.Zl(0);T=dpw;if(V=X.length>1?X[1]:void 0){if(V.downloadState==="DOWNLOAD_STATE_USER_DELETED"&&!Z)return a.return();V.downloadState=C}else V={key:v,downloadState:C};g.pp(N,T,V);return g.U(a,jj(n,{mode:"readwrite",Tb:!0},function(q){return g.w9.all([dk(q,N,m),dk(q,V,"downloadStatusEntity")])}),0)})},DN=function(L,m){return L.actionType===m.actionType&&L.entityKey===m.entityKey},OP=function(L,m){if(L&&L.transferState!=="TRANSFER_STATE_COMPLETE"&&L.transferState!==
"TRANSFER_STATE_FAILED"){var n=g.ot(L.key).entityId;
T8({transferStatusType:"TRANSFER_STATUS_TYPE_TERMINATED_BY_USER",statusType:"CANCELLED"},{videoId:n,jZ:L,offlineModeType:m})}},lE=function(L){if(!L||!L.thumbnails)return[];
var m=[];L=g.M(L.thumbnails);for(var n=L.next();!n.done;n=L.next())n=n.value,n.url&&m.push(n.url);return m},Kjl=function(L,m,n){n=n===void 0?[]:n;
var C,Z,z,v,X,N,T,V,a,q,D,O,e;return g.B(function(I){if(I.W==1)return n.length?g.U(I,LL(L,m),2):I.return([]);C=I.J;Z=new Set;z=g.M(C);for(v=z.next();!v.done;v=z.next())if(X=v.value,N=X.id||X.key)T=g.ot(N).entityId,Z.add(T);V=[];a=g.M(n);for(q=a.next();!q.done;q=a.next())D=q.value,O=D.offlineVideoData,e=void 0,((e=O)==null?0:e.videoId)&&!Z.has(O.videoId)&&V.push(D);return I.return(V)})},xpr=function(L,m,n){return new g.MA(L,{cotn:m,
raw_player_response:n,download_media:!0,start:Infinity,disable_watch_next:!0})},ykH=function(){return{priority:1,
retryScheduleIntervalsInSeconds:[1,2,4]}},RR=function(L,m,n,C,Z,z,v,X,N,T,V){this.entityType=L;
this.actionId=m;this.action=n;this.parentActionId=C;this.rootActionId=Z===void 0?m:Z;this.childActionIds=z;this.prereqActionId=v;this.postreqActionIds=X;this.hasChildActionFailed=T;this.retryScheduleIndex=0;this.W=V||Date.now();this.retryScheduleIndex=N||0},wi=function(L){if(!L.key)throw Error("Entity key is required.");
if(!L.actionProto)throw Error("OfflineOrchestrationAction is required.");var m=g.ot(L.key),n=g.ot(L.actionProto.entityKey);return new RR(n.entityType,m.entityId,L.actionProto,L.parentActionId,L.rootActionId,L.childActionIds,L.prereqActionId,L.postreqActionIds,L.retryScheduleIndex,L.hasChildActionFailed,Number(L.enqueueTimeSec)*1E3)},eP=function(L){return{key:g.cq(L.actionId,"offlineOrchestrationActionWrapperEntity"),
actionProto:L.action,parentActionId:L.parentActionId,rootActionId:L.rootActionId,childActionIds:L.childActionIds,prereqActionId:L.prereqActionId,postreqActionIds:L.postreqActionIds,retryScheduleIndex:L.retryScheduleIndex,hasChildActionFailed:L.hasChildActionFailed,enqueueTimeSec:(L.W/1E3).toFixed()}},jsz=function(){var L;
return g.B(function(m){return m.W==1?g.U(m,Py1(),2):(L=m.J)?m.return(L.delete("yt-player-local-img")):m.return(!0)})},gi=function(L){var m,n;
return g.B(function(C){if(C.W==1)return g.U(C,Py1(),2);if(C.W!=3){m=C.J;if(!m)throw Error("Cache API not supported");return L.length?g.U(C,m.open("yt-player-local-img"),3):C.return()}n=C.J;return g.U(C,Promise.all(L.map(function(Z){return n.delete(Z)})),0)})},M2=function(L){var m,n;
return g.B(function(C){if(C.W==1)return g.U(C,Py1(),2);if(C.W!=3){m=C.J;if(!m)throw Error("Cache API not supported");return L.length?g.U(C,m.open("yt-player-local-img"),3):C.return()}n=C.J;return g.U(C,n.addAll(L),0)})},SP=function(L,m,n,C,Z){var z,v,X,N,T,V,a,q,D,O,e,I,t,b,P,F,r,x,Y,Ed,N3,ZF,$P,mZ,J_,xP,Vw,T0,h_,Bm,nX;
return g.B(function(Pz){switch(Pz.W){case 1:return z=g.cq(L,"mainVideoEntity"),v=g.cq(L,"ytMainChannelEntity"),X=g.cq(L,"transfer"),N=g.cq(L,"videoDownloadContextEntity"),g.U(Pz,jj(m,{mode:"readonly",Tb:!0},function(k_){return g.w9.all([Y$(k_,z,"mainVideoEntity"),Y$(k_,v,"ytMainChannelEntity"),Y$(k_,X,"transfer"),Y$(k_,N,"videoDownloadContextEntity"),Ww(k_,"ytMainChannelEntity"),Ww(k_,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:T=Pz.J;V=g.M(T);a=V.next().value;q=V.next().value;D=V.next().value;O=V.next().value;e=V.next().value;I=V.next().value;t=a;b=q;P=D;F=O;r=e;x=I;if(!t&&!b){Pz.Zl(3);break}Y=t?lE(t.thumbnail):[];if(!b){Ed=[];Pz.Zl(4);break}return g.U(Pz,ozf(b,r),5);case 5:Ed=Pz.J;case 4:return N3=Ed,g.U(Pz,gi(Y.concat(N3)),3);case 3:ZF=[];$P=g.cq(L,"downloadStatusEntity");mZ=g.M(x);for(J_=mZ.next();!J_.done;J_=mZ.next())xP=J_.value,Vw=g.ot(xP.key).entityId,T0=wi(xP),h_=g.ot(T0.action.entityKey).entityId,Vw!==L&&
h_!==L||DN(n,xP.actionProto)||ZF.push(xP.key);return g.U(Pz,jj(m,{mode:"readwrite",Tb:!0},function(k_){var EC=ZF.map(function(f){return KE(k_,f)});
EC.push(KE(k_,z,{Fm:!0}));EC.push(KE(k_,$P,{Fm:!0}));return g.w9.all(EC)}),7);
case 7:nX=(Bm=F)==null?void 0:Bm.offlineModeType,Z&&(N2(Z),Z.offlineModeType&&(nX=Z.offlineModeType)),OP(P,nX),EP(C,{entityKey:z,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"}),g.gp(Pz)}})},mg$=function(L,m,n,C){var Z,z,v,X,N,T,V,a,q,D,O,e,I,t,b,P,F,r,x,Y,Ed,N3,ZF,$P,mZ,J_,xP,Vw,T0,h_,Bm,nX,Pz,k_,EC,f,UC,JJ,CJ,AJ,S,nJ,Au,y7,F$,KJ,mD,Zj,H_,J;
return g.B(function(w){switch(w.W){case 1:return Z=g.cq(L,"mainPlaylistEntity"),z=g.cq(L,"ytMainChannelEntity"),g.U(w,jj(m,{mode:"readonly",Tb:!0},function(A){return g.w9.all([Y$(A,Z,"mainPlaylistEntity"),Y$(A,z,"ytMainChannelEntity"),Ww(A,"mainPlaylistEntity"),Ww(A,"mainDownloadsListEntity"),Ww(A,"ytMainChannelEntity"),Ww(A,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:v=w.J;X=g.M(v);N=X.next().value;T=X.next().value;V=X.next().value;a=X.next().value;q=X.next().value;D=X.next().value;O=N;e=T;I=V;t=a;b=q;P=D;if(!O&&!e){w.Zl(3);break}F=O?ckw(O):[];if(!e){r=[];w.Zl(4);break}return g.U(w,ozf(e,b),5);case 5:r=w.J;case 4:return x=r,g.U(w,gi(F.concat(x)),3);case 3:Y=[];Ed=new Map;if(!O){w.Zl(7);break}return g.U(w,Lro(O,I,t),8);case 8:Y=w.J;N3=g.M(Y);for(ZF=N3.next();!ZF.done;ZF=N3.next())$P=ZF.value,Ed.set($P,{videoId:$P,playlistId:L,offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});
return g.U(w,jj(m,{mode:"readonly",Tb:!0},function(A){return g.w9.all([Ww(A,"transfer"),Ww(A,"videoDownloadContextEntity")])}),9);
case 9:mZ=w.J;J_=g.M(mZ);xP=J_.next().value;Vw=J_.next().value;T0=xP;h_=Vw;Bm=g.M(T0);for(nX=Bm.next();!nX.done;nX=Bm.next())Pz=nX.value,k_=g.ot(Pz.key).entityId,(EC=Ed.get(k_))&&Pz&&(EC.cotn=Pz.cotn);f=g.M(h_);for(UC=f.next();!UC.done;UC=f.next())JJ=UC.value,CJ=g.ot(JJ.key).entityId,(AJ=Ed.get(CJ))&&JJ&&(AJ.offlineModeType=JJ.offlineModeType);case 7:S=[];nJ=g.M(P);for(Au=nJ.next();!Au.done;Au=nJ.next())y7=Au.value,F$=g.ot(y7.key).entityId,KJ=wi(y7),F$!==L&&KJ.rootActionId!==L||DN(n,y7.actionProto)||
S.push(y7.key);mD=g.cq(L,"mainPlaylistEntity");return g.U(w,jj(m,{mode:"readwrite",Tb:!0},function(A){var Q=S.map(function(G){return KE(A,G)});
Q.push(KE(A,mD,{Fm:!0}));return g.w9.all(Q)}),10);
case 10:if(!O){w.Zl(0);break}Y.reverse();if(!Y){w.Zl(0);break}Zj=g.M(Y);H_=Zj.next();case 13:if(H_.done){w.Zl(0);break}J=H_.value;return g.U(w,SP(J,m,n,C,Ed.get(J)),14);case 14:H_=Zj.next(),w.Zl(13)}})},CKZ=function(L,m,n,C){var Z,z,v,X,N,T,V,a,q;
return g.B(function(D){if(D.W==1)return Z=g.cq("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),z=new Map,g.U(D,jj(L,{mode:"readwrite",Tb:!0},function(O){var e=Ww(O,"transfer"),I=Ww(O,"offlineOrchestrationActionWrapperEntity"),t=Ww(O,"videoDownloadContextEntity"),b=Y$(O,Z,"mainDownloadsListEntity");return g.w9.all([e,I,t,b]).then(function(P){P=g.M(P);var F=P.next().value;var r=P.next().value;var x=P.next().value;var Y=P.next().value;P=naw.map(function(N3){return jFf(O,N3)});
r=g.M(r);for(var Ed=r.next();!Ed.done;Ed=r.next())Ed=Ed.value,DN(m,Ed.actionProto)||P.push(KE(O,Ed.key,{Fm:!0}));Y&&(Y.downloads=[],P.push(dk(O,Y,"mainDownloadsListEntity")));if(x)for(x=g.M(x),Y=x.next();!Y.done;Y=x.next())Y=Y.value,r=g.ot(Y.key).entityId,r=g.cq(r,"transfer"),z.set(r,Y.offlineModeType);return g.w9.all(P).then(function(){return F})})}),2);
v=D.J;X=g.M(v);for(N=X.next();!N.done;N=X.next())T=N.value,OP(T,z.get(T.key)),V=g.ot(T.key).entityId,a={videoId:V,offlineDeleteReason:C,cotn:T.cotn,offlineModeType:z.get(T.key)},N2(a),q=g.cq(V,"mainVideoEntity"),EP(n,{entityKey:q,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"});return g.U(D,jsz(),0)})},ckw=function(L,m){var n=[];
if(L.thumbnailStyleData){L=g.M(L.thumbnailStyleData);for(var C=L.next();!C.done;C=L.next()){var Z=void 0,z=void 0,v=void 0;n=n.concat(lE((Z=C.value)==null?void 0:(z=Z.value)==null?void 0:(v=z.collageThumbnail)==null?void 0:v.coverThumbnail))}}m=lE(m);return n.concat(m)},Lro=function(L,m,n){var C,Z,z,v,X,N,T,V,a,q,D,O,e,I,t,b,P,F,r,x,Y,Ed,N3;
return g.B(function(ZF){C=[];Z=new Set;if(n.length)for(z=g.M(n),v=z.next();!v.done;v=z.next())if(X=v.value,N=void 0,(N=X.downloads)==null?0:N.length)for(T=g.M(X.downloads),V=T.next();!V.done;V=T.next())a=V.value,a.videoItem&&(q=g.ot(a.videoItem).entityId,Z.add(q));if(L.videos){D=g.M(L.videos);for(O=D.next();!O.done;O=D.next())e=O.value,I=JSON.parse(g.ot(e).entityId),I.videoId&&!Z.has(I.videoId)&&C.push(I.videoId);t=g.M(m);for(b=t.next();!b.done;b=t.next())if(P=b.value,P.key!==L.key&&(F=P.videos))for(r=
g.M(F),x=r.next();!x.done;x=r.next())Y=x.value,Ed=JSON.parse(g.ot(Y).entityId),Ed.videoId&&(N3=C.indexOf(Ed.videoId),N3!==-1&&C.splice(N3,1))}return ZF.return(C)})},ozf=function(L,m){var n,C,Z,z,v,X,N,T;
return g.B(function(V){n=lE(L.avatar);C=g.M(m);for(Z=C.next();!Z.done;Z=C.next())if(z=Z.value,z.id!==L.id)for(v=g.M(lE(z.avatar)),X=v.next();!X.done;X=v.next())N=X.value,T=n.indexOf(N),T!==-1&&n.splice(T,1);return V.return(n)})},ZrD=function(L){var m;
return g.B(function(n){m=g.k(L.frameworkUpdates,IR);return L.frameworkUpdates&&m?g.U(n,TI$(m),0):n.return()})},va_=function(L){var m;
if((m=L.onResponseReceivedActions)!=null&&m.length){var n;L=(n=g.k(g.k(L.onResponseReceivedActions[0],z_F),g.Eq$))==null?void 0:n.actions;if(L!=null&&L.length)return L}},EaF=function(L){var m,n,C;
return g.B(function(Z){if(Z.W==1)return L?g.U(Z,cw(L,g.hH,"mainDownloadsListEntity"),2):Z.return([]);m=Z.J;return((n=m)==null?0:(C=n.downloads)==null?0:C.length)?Z.return(m.downloads.map(function(z){var v;return(v=z.videoItem)!=null?v:""})):Z.return([])})},NzH=function(L,m){var n;
return g.B(function(C){return C.W==1?g.U(C,XO0(L,m),2):(n=C.J)?g.U(C,jj(L,{mode:"readwrite",Tb:!0},function(Z){var z=[dk(Z,n.mainDownloadsLibraryEntity,"mainDownloadsLibraryEntity")];n.mainDownloadsListEntity&&z.push(dk(Z,n.mainDownloadsListEntity,"mainDownloadsListEntity"));return g.w9.all(z)}),0):C.Zl(0)})},XO0=function(L,m){var n,C,Z,z,v,X,N,T,V,a,q,D,O,e,I,t,b,P;
return g.B(function(F){if(F.W==1)return n=g.cq("main_downloads_library_id","mainDownloadsLibraryEntity"),C=g.cq("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),g.U(F,jj(L,{mode:"readonly",Tb:!0},function(r){return g.w9.all([Y$(r,n,"mainDownloadsLibraryEntity"),Y$(r,C,"mainDownloadsListEntity")])}),2);
Z=F.J;z=g.M(Z);v=z.next().value;X=z.next().value;N=v;T=X;N||(N={id:n});V=g.M(m);for(a=V.next();!a.done;a=V.next())if(q=a.value,q===g.hH){if(N.smartDownloadsList)return F.return();N.smartDownloadsList=q}else if(D=g.ot(q).entityType,O={},D==="mainPlaylistEntity"?O.playlistItem=q:D==="mainVideoEntity"&&(O.videoItem=q),!g.$T(O)){e=void 0;if((e=T)==null?0:e.downloads){I=!1;t=g.M(T.downloads);for(b=t.next();!b.done;b=t.next())if(P=b.value,P.playlistItem===q||P.videoItem===q){I=!0;break}I||T.downloads.push(O)}else T=
{id:C,downloads:[O]};N.downloadsList=C}return F.return({mainDownloadsLibraryEntity:N,mainDownloadsListEntity:T})})},TzH=function(L,m){var n,C,Z,z,v,X,N,T,V,a,q,D,O,e,I;
return g.B(function(t){if(t.W==1)return n=g.cq("main_downloads_library_id","mainDownloadsLibraryEntity"),C=g.cq("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),g.U(t,jj(L,{mode:"readonly",Tb:!0},function(b){return g.w9.all([Y$(b,n,"mainDownloadsLibraryEntity"),Y$(b,C,"mainDownloadsListEntity"),Y$(b,g.hH,"mainDownloadsListEntity")])}),2);
Z=t.J;z=g.M(Z);v=z.next().value;X=z.next().value;N=z.next().value;T=v;V=X;a=N;if(!T)return t.Zl(0);if(m===g.hH&&((q=a)==null?0:q.downloads))a.downloads=[];else if((D=V)==null?0:D.downloads)for(O=g.ot(m).entityType,e=0;e<V.downloads.length;e++)if(I=V.downloads[e],O==="mainVideoEntity"&&I.videoItem===m){V.downloads.splice(e,1);break}else if(O==="mainPlaylistEntity"&&I.playlistItem===m){V.downloads.splice(e,1);break}return g.U(t,jj(L,{mode:"readwrite",Tb:!0},function(b){var P=[dk(b,T,"mainDownloadsLibraryEntity")];
V&&P.push(dk(b,V,"mainDownloadsListEntity"));a&&P.push(dk(b,a,"mainDownloadsListEntity"));return g.w9.all(P)}),0)})},Ji=function(L,m){var n,C,Z,z,v,X,N,T,V,a,q;
return g.B(function(D){if(D.W==1)return n=g.cq(m,"transfer"),C=g.cq(m,"videoDownloadContextEntity"),g.U(D,jj(L,{mode:"readonly",Tb:!0},function(O){return g.w9.all([Y$(O,n,"transfer"),Y$(O,C,"videoDownloadContextEntity")])}),2);
Z=D.J;z=g.M(Z);v=z.next().value;X=z.next().value;N=v;T=X;q={videoId:m,cotn:(V=N)==null?void 0:V.cotn,offlineModeType:(a=T)==null?void 0:a.offlineModeType};return D.return(q)})},Ai=function(L,m,n,C,Z){var z,v,X,N,T,V,a,q,D,O,e,I,t,b,P,F,r,x,Y,Ed;
return g.B(function(N3){switch(N3.W){case 1:return z=g.cq(L,"musicTrack"),v=g.cq(L,"transfer"),g.U(N3,jj(m,{mode:"readonly",Tb:!0},function(ZF){return g.w9.all([Y$(ZF,z,"musicTrack"),Y$(ZF,v,"transfer"),Ww(ZF,"musicTrack"),Ww(ZF,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:X=N3.J;N=g.M(X);T=N.next().value;V=N.next().value;a=N.next().value;q=N.next().value;D=T;O=V;e=a;I=q;if(!D){N3.Zl(3);break}return g.U(N3,VWp(D,e),4);case 4:return t=N3.J,g.U(N3,gi(t),3);case 3:b=[];P=g.M(I);for(F=P.next();!F.done;F=P.next())r=F.value,x=g.ot(r.key).entityId,Y=wi(r),Ed=g.ot(Y.action.entityKey).entityId,x!==L&&Ed!==L||DN(n,r.actionProto)||b.push(r.key);return g.U(N3,jj(m,{mode:"readwrite",Tb:!0},function(ZF){var $P=b.map(function(mZ){return KE(ZF,mZ)});
$P.push(KE(ZF,z,{Fm:!0}));return g.w9.all($P)}),6);
case 6:OP(O),Z&&N2(Z),EP(C,{entityKey:z,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"}),g.gp(N3)}})},bE=function(L,m,n,C,Z){var z,v,X,N,T,V,a,q,D,O,e,I,t,b,P,F,r,x,Y,Ed,N3,ZF,$P,mZ,J_,xP,Vw,T0,h_,Bm,nX,Pz,k_,EC,f,UC;
return g.B(function(JJ){switch(JJ.W){case 1:return z=g.cq(L,m),v=g.cq("music_downloads_library_id","musicDownloadsLibraryEntity"),g.U(JJ,jj(n,{mode:"readonly",Tb:!0},function(CJ){return g.w9.all([Y$(CJ,z,m),Y$(CJ,v,"musicDownloadsLibraryEntity"),Ww(CJ,m),Ww(CJ,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:X=JJ.J;N=g.M(X);T=N.next().value;V=N.next().value;a=N.next().value;q=N.next().value;D=T;O=V;e=a;I=q;if(!D){JJ.Zl(3);break}return g.U(JJ,VWp(D,e),4);case 4:return t=JJ.J,g.U(JJ,gi(t),3);case 3:b=[];P=new Map;if(!D){JJ.Zl(6);break}return g.U(JJ,irZ(D,e,O),7);case 7:b=JJ.J;F=g.M(b);for(r=F.next();!r.done;r=F.next())x=r.value,Y=g.ot(x).entityId,P.set(Y,{videoId:Y,playlistId:L,offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});return g.U(JJ,LL(n,"transfer"),8);case 8:for(Ed=JJ.J,N3=
g.M(Ed),ZF=N3.next();!ZF.done;ZF=N3.next())$P=ZF.value,mZ=g.ot($P.key).entityId,(J_=P.get(mZ))&&$P&&(J_.cotn=$P.cotn);case 6:xP=[];Vw=g.M(I);for(T0=Vw.next();!T0.done;T0=Vw.next())h_=T0.value,Bm=g.ot(h_.key).entityId,nX=wi(h_),Bm!==L&&nX.rootActionId!==L||DN(C,h_.actionProto)||xP.push(h_.key);Pz=g.cq(L,m);return g.U(JJ,jj(n,{mode:"readwrite",Tb:!0},function(CJ){var AJ=xP.map(function(S){return KE(CJ,S)});
AJ.push(KE(CJ,Pz,{Fm:!0}));return g.w9.all(AJ)}),9);
case 9:if(!D){JJ.Zl(0);break}b.reverse();if(!b.length){JJ.Zl(0);break}k_=g.M(b);EC=k_.next();case 12:if(EC.done){JJ.Zl(0);break}f=EC.value;UC=g.ot(f).entityId;if(!UC){JJ.Zl(13);break}return g.U(JJ,Ai(UC,n,C,Z,P.get(UC)),13);case 13:EC=k_.next(),JJ.Zl(12)}})},ti=function(L,m,n){var C,Z,z,v,X,N,T;
return g.B(function(V){if(V.W==1)return g.U(V,jj(L,{mode:"readwrite",Tb:!0},function(a){var q=Ww(a,"transfer"),D=Ww(a,"offlineOrchestrationActionWrapperEntity");return g.w9.all([q,D]).then(function(O){O=g.M(O);var e=O.next().value;var I=O.next().value;O=$g1.map(function(F){return jFf(a,F)});
I=g.M(I);for(var t=I.next();!t.done;t=I.next()){t=t.value;var b=g.ot(t.actionProto.entityKey).entityType==="musicTrack",P=t.actionProto.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD";DN(m,t.actionProto)||b&&(!b||P)||O.push(KE(a,t.key,{Fm:!0}))}return g.w9.all(O).then(function(){return e})})}),2);
C=V.J;Z=g.M(C);for(z=Z.next();!z.done;z=Z.next())v=z.value,OP(v),X=g.ot(v.key).entityId,N={videoId:X,offlineDeleteReason:void 0,cotn:v.cotn},N2(N),T=g.cq(X,"musicTrack"),EP(n,{entityKey:T,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"});return g.U(V,jsz(),0)})},aKZ=function(L){for(var m,n=g.M(L.additionalMetadatas),C=n.next();!C.done;C=n.next())C=C.value,C.offlineMusicVideoData&&(m=C.offlineMusicVideoData);
var Z,z,v,X,N;return{id:g.cq(L.videoId,"musicTrack"),videoId:L.videoId,title:L.title,thumbnailDetails:L.thumbnail,lengthMs:String(Number(L.lengthSeconds)*1E3),albumTitle:(Z=m)==null?void 0:Z.releaseTitle,musicVideoType:(z=m)==null?void 0:z.musicVideoType,contentRating:{explicitType:(v=m)==null?void 0:v.explicitType},artistNames:((X=m)==null?void 0:X.byline)||((N=m)==null?void 0:N.channelName),downloadMetadata:g.cq(L.videoId,"musicTrackDownloadMetadataEntity")}},irZ=function(L,m,n){var C,Z,z,v,X,N,
T,V,a,q,D,O,e,I,t,b,P,F;
return g.B(function(r){C=[];Z=new Set;if((z=n)==null?0:(v=z.downloadedTracks)==null?0:v.length)for(X=g.M(n.downloadedTracks),N=X.next();!N.done;N=X.next())T=N.value,Z.add(T);if(L.tracks){V=g.M(L.tracks);for(a=V.next();!a.done;a=V.next())q=a.value,Z.has(q)||C.push(q);D=g.M(m);for(O=D.next();!O.done;O=D.next())if(e=O.value,e.id!==L.id&&(I=e.tracks))for(t=g.M(I),b=t.next();!b.done;b=t.next())P=b.value,F=C.indexOf(P),F!==-1&&C.splice(F,1)}return r.return(C)})},VWp=function(L,m){var n,C,Z,z,v,X,N,T;
return g.B(function(V){n=lE(L.thumbnailDetails);C=g.M(m);for(Z=C.next();!Z.done;Z=C.next())if(z=Z.value,z.id!==L.id)for(v=g.M(lE(z.thumbnailDetails)),X=v.next();!X.done;X=v.next())N=X.value,T=n.indexOf(N),T!==-1&&n.splice(T,1);return V.return(n)})},quw=function(L,m){var n,C,Z,z,v,X,N,T,V;
return g.B(function(a){if(a.W==1)return n=g.cq("music_downloads_library_id","musicDownloadsLibraryEntity"),g.U(a,cw(L,n,"musicDownloadsLibraryEntity"),2);(C=a.J)||(C={id:n});Z=g.ot(m).entityType;Z==="musicTrack"?(z=C.downloadedTracks)!=null&&z.includes(m)||(C.downloadedTracks=((v=C.downloadedTracks)!=null?v:[]).concat(m)):Z==="musicPlaylist"?(X=C.downloadedPlaylists)!=null&&X.includes(m)||(C.downloadedPlaylists=((N=C.downloadedPlaylists)!=null?N:[]).concat(m)):Z!=="musicAlbumRelease"||(T=C.downloadedAlbumReleases)!=
null&&T.includes(m)||(C.downloadedAlbumReleases=((V=C.downloadedAlbumReleases)!=null?V:[]).concat(m));return g.U(a,o2(L,C,"musicDownloadsLibraryEntity"),0)})},Dg1=function(L,m){var n,C,Z,z,v,X,N;
return g.B(function(T){if(T.W==1)return n=g.cq("music_downloads_library_id","musicDownloadsLibraryEntity"),g.U(T,cw(L,n,"musicDownloadsLibraryEntity"),2);C=T.J;if(!C)return T.Zl(0);Z=g.ot(m).entityType;Z==="musicTrack"?z=C.downloadedTracks:Z==="musicPlaylist"&&(z=C.downloadedPlaylists);if((v=z)==null?0:v.length)for(X=0;X<z.length;X++)if(N=z[X],N===m){z.splice(X,1);break}return g.U(T,o2(L,C,"musicDownloadsLibraryEntity"),0)})},Orp=function(L){var m=L.videos;
L=[];var n=[];if(m){m=g.M(m);for(var C=m.next();!C.done;C=m.next()){var Z=C.value.offlineVideoData.videoId;C=g.cq(Z,"musicTrack");Z=g.cq(Z,"musicTrackDownloadMetadataEntity");L.push(C);n.push(Z)}}return{sB:L,gN:n}},fL=function(L,m,n){m={track:aKZ(m)};
n&&(m.playlistId=n);if(L=g.k(L.actionMetadata,lKH))m.maximumDownloadQuality=L.maximumDownloadQuality;return{musicTrackEntityActionMetadata:m}},wOz=function(L){var m,n,C,Z,z,v,X,N;
return g.B(function(T){switch(T.W){case 1:return m=g.x2(),n=lGr(L),C=g.m2(R_f),g.M3(T,2),z={My:!0},g.U(T,g.FZ(m,n,C,void 0,z),4);case 4:Z=T.J;g.t_(T,3);break;case 2:v=g.fJ(T);if(v instanceof g.Gg)throw X="GetOffline network manager error: "+v.message,z8(X,v),Error(X);z8("GetOffline fetch request error",v);throw Error("GetOffline fetch request error");case 3:N=UP(Z);if(!Z)throw z8("Network request failed"),Error("Network request failed");if(N!==void 0)BU(N);else if(!Z.videos||!Z.videos.length)throw z8("No data"),
Error("No data");return T.return(Z.videos.map(function(V){return V.offlineVideoData}))}})},e_r=function(L){var m,n,C,Z,z,v,X,N;
return g.B(function(T){switch(T.W){case 1:return m=g.x2(),n=RyJ(L),C=g.m2(R_f),g.M3(T,2),z={My:!0},g.U(T,g.FZ(m,n,C,void 0,z),4);case 4:Z=T.J;g.t_(T,3);break;case 2:v=g.fJ(T);if(v instanceof g.Gg)throw X="GetOffline network manager error for playlist: "+v.message,z8(X,v),Error(X);z8("GetOffline fetch request error for playlist",v);throw Error("GetOffline fetch request error for playlist");case 3:N=UP(Z);if(!Z)throw z8("Network request failed for playlist"),Error("Network request failed for playlist");
if(N!==void 0)BU(N,"playlist");else if(!Z.playlists||!Z.playlists.length)throw z8("No data for playlist"),Error("No data for playlist");return T.return(Z.playlists.map(function(V){return V.offlinePlaylistData}))}})},MWr=function(L,m,n,C){var Z,z,v,X,N,T,V,a,q,D,O,e,I,t,b,P,F,r,x,Y,Ed,N3,ZF,$P,mZ,J_,xP,Vw,T0,h_;
return g.B(function(Bm){switch(Bm.W){case 1:return g.U(Bm,ms(),2);case 2:Z=Bm.J;if(!Z)return Bm.return([]);z=[];if((v=C)==null?0:v.length){z=C;Bm.Zl(3);break}return g.U(Bm,LL(Z,"mainPlaylistEntity"),4);case 4:z=Bm.J;case 3:if(!z.length)return Bm.return([]);X=[];N=Date.now()/1E3;T=g.M(z);V=T.next();case 5:if(V.done)return X.length?g.U(Bm,ga_(X),10):Bm.return([]);a=V.value;if(!a.downloadState){q=void 0;Bm.Zl(8);break}return g.U(Bm,cw(Z,a.downloadState,"mainPlaylistDownloadStateEntity"),9);case 9:q=
Bm.J;case 8:D=q;O=void 0;I=(e=(O=a)==null?void 0:O.entityMetadata)&&e.nextAutoRefreshIntervalSeconds?Number(e.nextAutoRefreshIntervalSeconds):NaN;t=Number.isNaN(I)?L:I;P=b=void 0;F=((b=D)==null?0:b.lastSyncedTimestampMillis)?Number((P=D)==null?void 0:P.lastSyncedTimestampMillis)/1E3:0;x=r=void 0;Y=((r=D)==null?0:r.addedTimestampMillis)?Number((x=D)==null?void 0:x.addedTimestampMillis)/1E3:0;if(n||!e||F+t<=N){Ed=[];N3=void 0;if((N3=a.videos)==null?0:N3.length)for(ZF=g.M(a.videos),$P=ZF.next();!$P.done;$P=
ZF.next())mZ=$P.value,J_=JSON.parse(g.ot(mZ).entityId),J_.videoId&&Ed.push(J_.videoId);xP="0";e&&(Vw=void 0,xP=String(Number((Vw=e.offlineLastModifiedTimestampSeconds)!=null?Vw:0).toFixed()));T0={playlistId:a.playlistId,videoIds:Ed,offlineLastModifiedTimestamp:xP,autoSync:m,offlineDateAddedTimestamp:String(Y.toFixed())};X.push(T0)}V=T.next();Bm.Zl(5);break;case 10:return h_=Bm.J,Bm.return(h_)}})},Sup=function(){var L,m,n,C,Z;
return g.B(function(z){if(z.W==1)return g.U(z,ms(),2);if(z.W!=3)return(L=z.J)?g.U(z,LL(L,"refresh"),3):z.return(!1);m=z.J;if((n=m[0])==null||!n.refreshTime)return z.return(!1);C=Number(m[0].refreshTime);Z=Date.now()/1E3;return z.return(isFinite(C)&&Z>=C)})},J90=function(L,m){var n,C,Z;
return g.B(function(z){switch(z.W){case 1:return g.M3(z,2),g.U(z,IK_(L,m),4);case 4:return C=z.J,g.U(z,ZrD(C),5);case 5:n=va_(C);g.t_(z,3);break;case 2:Z=g.fJ(z),z8("getAndProcessSmartDownloadsResponse request or processing error",Z);case 3:return z.return(n)}})},A9D=function(L,m,n,C){var Z,z,v,X,N,T,V,a,q,D,O,e,I,t,b,P,F,r,x,Y,Ed,N3,ZF,$P,mZ,J_,xP,Vw,T0,h_;
return g.B(function(Bm){switch(Bm.W){case 1:return g.U(Bm,ms(),2);case 2:Z=Bm.J;if(!Z)return Bm.return([]);z=[];if((v=C)==null?0:v.length){z=C;Bm.Zl(3);break}return g.U(Bm,LL(Z,"musicPlaylist"),4);case 4:z=Bm.J;case 3:if(!z.length)return Bm.return([]);X=[];N=Date.now()/1E3;T=g.M(z);V=T.next();case 5:if(V.done)return X.length?g.U(Bm,ga_(X),10):Bm.return([]);a=V.value;q=void 0;O=(D=(q=a)==null?void 0:q.entityMetadata)&&D.nextAutoRefreshIntervalSeconds?Number(D.nextAutoRefreshIntervalSeconds):NaN;e=
Number.isNaN(O)?L:O;t=I=0;b="DOWNLOAD_SYNC_STATE_UNKNOWN";if(!a.downloadMetadata){Bm.Zl(8);break}return g.U(Bm,cw(Z,a.downloadMetadata,"musicPlaylistDownloadMetadataEntity"),9);case 9:P=Bm.J,r=F=void 0,I=Number((r=(F=P)==null?void 0:F.addedTimestampMillis)!=null?r:"0")/1E3,Y=x=void 0,t=Number((Y=(x=P)==null?void 0:x.lastModifiedTimestampMillis)!=null?Y:"0")/1E3,N3=Ed=void 0,b=(N3=(Ed=P)==null?void 0:Ed.syncState)!=null?N3:"DOWNLOAD_SYNC_STATE_UNKNOWN";case 8:ZF=void 0;if(n||b!=="DOWNLOAD_SYNC_STATE_UP_TO_DATE"||
!D||Number((ZF=D.lastSyncedTimestampSeconds)!=null?ZF:0)+e<=N){$P=[];mZ=void 0;if((mZ=a.tracks)==null?0:mZ.length)for(J_=g.M(a.tracks),xP=J_.next();!xP.done;xP=J_.next())Vw=xP.value,$P.push(g.ot(Vw).entityId);T0={playlistId:a.playlistId,videoIds:$P,offlineLastModifiedTimestamp:String(t.toFixed()),autoSync:m,offlineDateAddedTimestamp:String(I.toFixed())};X.push(T0)}V=T.next();Bm.Zl(5);break;case 10:return h_=Bm.J,Bm.return(h_)}})},IK_=function(L,m){var n,C,Z,z,v,X,N,T,V,a;
return g.B(function(q){switch(q.W){case 1:return n=g.x2(),g.U(q,ms(),2);case 2:C=q.J;if(!C){q.Zl(3);break}return g.U(q,Jk1(C),4);case 4:Z=q.J;case 3:var D=Z;z={context:g.ov(),browseId:"FEdownloads",browseRequestSupportedMetadata:{downloadsBrowseParams:{offlineFeatureSettingState:{isSdEnabled:L},offlineClientState:D,clientStateRequestData:{preferredFormatType:m}}}};v=g.m2(brf);g.M3(q,5);N={My:!0};return g.U(q,g.FZ(n,z,v,void 0,N),7);case 7:X=q.J;g.t_(q,6);break;case 5:T=g.fJ(q);if(T instanceof g.Gg)throw V=
"DPS network manager error for smart downloads: "+T.message,z8(V,T),Error(V);z8("DPS fetch request error for smart downloads",T);throw Error("DPS fetch request error for smart downloads");case 6:a=UP(X);if(X)a!==void 0&&BU(a,"smart downloads");else throw z8("Network request failed for smart downloads"),Error("Network request failed for smart downloads");return q.return(X)}})},fKl=function(L,m){var n,C,Z,z,v,X,N,T;
return g.B(function(V){switch(V.W){case 1:return n=g.x2(),C={context:g.ov(),videoPlaybackPositionEntities:L,lastSyncTimestampUsec:m},Z=g.m2(tWr),g.M3(V,2),v={My:!0},g.U(V,g.FZ(n,C,Z,void 0,v),4);case 4:z=V.J;g.t_(V,3);break;case 2:X=g.fJ(V);if(X instanceof g.Gg)throw N="VPPS network manager error: "+X.message,z8(N,X),Error(N);z8("VPPS fetch request error",X);throw Error("VPPS fetch request error");case 3:T=UP(z);if(z)T!==void 0&&BU(T,"position sync");else throw z8("Network request failed for position sync"),
Error("Network request failed for position sync");return V.return(z)}})},BzJ=function(L,m,n){var C,Z,z,v,X,N,T,V;
return g.B(function(a){switch(a.W){case 1:C=g.x2();var q=n.refreshData,D=n.isEnqueuedForExpiredStreamUrlRefetch,O=n.Xo,e=n.offlineSourceData,I=n.mediaCapabilities,t={entityKey:L};q&&(t.refreshData=q);D&&(t.isExpiredStreamUrlRefetch=D);O&&(t.downloadParameters=O);e&&(t.offlineSourceData=e);q={context:g.tW(m),signatureTimestamp:20340,videos:[t]};I&&(q.mediaCapabilities=I);Z=q;z=g.m2(Ug_);g.M3(a,2);X={My:!0};return g.U(a,g.FZ(C,Z,z,void 0,X),4);case 4:v=a.J;g.t_(a,3);break;case 2:N=g.fJ(a);if(N instanceof
g.Gg)throw T="GetPDE network manager error: "+N.message,z8(T,N),Error(T);z8("GetPDE fetch request error",N);throw Error("GetPDE fetch request error");case 3:V=UP(v);if(v)V!==void 0&&BU(V,"PDE");else throw z8("Network request failed for PDE"),Error("Network request failed for PDE");return a.return(v)}})},UP=function(L){var m;
return(m=L.errorMetadata)==null?void 0:m.status},BU=function(L,m){m=m?" for "+m:"";
if(L===0)throw L="Empty response body"+m,z8(L),Error(L);L="Response with error"+m;z8(L);throw Error(L);},ga_=function(L){var m,n,C,Z,z,v,X,N;
return g.B(function(T){switch(T.W){case 1:return m=g.x2(),n=whZ(L),C=g.m2(PK_),g.M3(T,2),z={My:!0},g.U(T,g.FZ(m,n,C,void 0,z),4);case 4:Z=T.J;g.t_(T,3);break;case 2:v=g.fJ(T);if(v instanceof g.Gg)throw X="offlinePlaylistSyncCheck network manager error: "+v.message,z8(X,v),Error(X);z8("offlinePlaylistSyncCheck fetch request error",v);throw Error("offlinePlaylistSyncCheck fetch request error");case 3:N=UP(Z);if(!Z)throw z8("Network request failed for playlist sync"),Error("Network request failed for playlist sync");
if(N!==void 0)BU(N,"playlist sync");else if(!Z.offlinePlaylistSyncCheckDatas||!Z.offlinePlaylistSyncCheckDatas.length)throw z8("No data for playlist sync"),Error("No data for playlist sync");return T.return(Z.offlinePlaylistSyncCheckDatas.map(function(V){return V.offlinePlaylistSyncCheckData}))}})},PU=function(L){this.W=L},saJ=function(L,m){var n,C,Z,z,v,X;
return g.B(function(N){switch(N.W){case 1:n=new Map,C=g.M(m),Z=C.next();case 2:if(Z.done){N.Zl(4);break}z=Z.value;v=n;X=v.set;return g.U(N,L.J(z),5);case 5:X.call(v,z,N.J);Z=C.next();N.Zl(2);break;case 4:return N.return(n)}})},sP=function(L,m,n,C,Z,z){m=g.cq(m,n);
C=Object.assign({},z,{priority:C,retryScheduleIntervalsInSeconds:Z});return{actionType:L,entityKey:m,actionMetadata:C}},QH=function(L,m,n,C,Z,z){this.status=L;
this.W=m;this.L=n;this.J=C;this.G=Z;this.downloadState=z},Qap=function(L,m,n){this.W=L;
this.yd=m;this.G=n},uG0=function(L,m){var n,C,Z,z,v,X,N,T,V;
return g.B(function(a){switch(a.W){case 1:return n=m.entityKey,Z=(C=g.k(m.actionMetadata,pL))==null?void 0:C.isEnqueuedForExpiredStreamUrlRefetch,g.M3(a,2),z=void 0,g.U(a,pOl(L,m),4);case 4:z=a.J;g.M3(a,5);var q=(q=g.k(m.actionMetadata,pL))?{maximumDownloadQuality:q.maximumDownloadQuality}:void 0;return g.U(a,BzJ(n,L.yd,{isEnqueuedForExpiredStreamUrlRefetch:Z,Xo:q,offlineSourceData:z}),7);case 7:v=a.J;g.t_(a,6,2);break;case 5:return g.fJ(a,2),X=VH(m)?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":
"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR",z8("PDE handleAdd error"),a.return(FF(m,!1,void 0,"OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED",X,"DOWNLOAD_STATE_FAILED"));case 6:return g.U(a,Frf(L,v,m),8);case 8:return a.return(FF(m,!0,v.orchestrationActions));case 2:return N=g.fJ(a),T="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",V="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",N instanceof g.$G&&N.type==="QUOTA_EXCEEDED"&&(T="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
V="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),z8("PDE handleAdd error"),a.return(FF(m,!1,void 0,T,V,"DOWNLOAD_STATE_FAILED"))}})},kYw=function(L,m){var n,C,Z,z,v,X,N,T,V,a,q,D,O,e,I,t,b,P,F,r,x,Y,Ed,N3;
return g.B(function(ZF){switch(ZF.W){case 1:return n=m.entityKey,C=g.ot(n).entityId,g.U(ZF,jj(L.W,{mode:"readonly",Tb:!0},function($P){var mZ=Y$($P,n,"playbackData"),J_=Y$($P,g.cq(C,"offlineVideoPolicy"),"offlineVideoPolicy");$P=Y$($P,g.cq(C,"transfer"),"transfer");return g.w9.all([mZ,J_,$P])}),2);
case 2:Z=ZF.J;z=g.M(Z);v=z.next().value;X=z.next().value;N=z.next().value;T=v;V=X;a=N;if(!T||!V)return ZF.return(FF(m,!0));q=[];e=((O=T)==null?0:O.playerResponseJson)?JSON.parse(T.playerResponseJson):null;if(!(a&&e&&L.yd.N("html5_refresh_deprecated_downloads"))){ZF.Zl(3);break}D=h_p(L,e,a);return g.U(ZF,r9D(L,a),4);case 4:q=ZF.J;case 3:I={lastPlayerResponseTimestampSeconds:T.playerResponseTimestamp,offlineToken:V.offlineToken,formatIds:q};t={};if((b=a)==null?0:b.maximumDownloadQuality)t.maximumDownloadQuality=
a.maximumDownloadQuality;g.M3(ZF,5);P=void 0;return g.U(ZF,pOl(L,m),7);case 7:return P=ZF.J,g.M3(ZF,8),g.U(ZF,BzJ(n,L.yd,{refreshData:I,Xo:t,offlineSourceData:P,mediaCapabilities:D}),10);case 10:F=ZF.J;g.t_(ZF,9,5);break;case 8:return g.fJ(ZF,5),r=VH(m)?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR",z8("PDE handleRefresh error"),ZF.return(FF(m,!1,void 0,"OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED",r,
"DOWNLOAD_STATE_FAILED"));case 9:return g.U(ZF,Frf(L,F,m),11);case 11:return ZF.return(FF(m,!0,F.orchestrationActions));case 5:return x=g.fJ(ZF),Y="PDE handleRefresh error",x instanceof Error&&(Y="PDE handleRefresh error: "+x.message),Ed="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",N3="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",x instanceof g.$G&&x.type==="QUOTA_EXCEEDED"&&(Ed="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",N3="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
z8(Y),ZF.return(FF(m,!1,void 0,Ed,N3,"DOWNLOAD_STATE_FAILED"))}})},pOl=function(L,m){var n,C,Z,z;
return g.B(function(v){if(v.W==1)return n=g.ot(m.entityKey).entityId,C=g.cq(n,"videoDownloadContextEntity"),g.U(v,cw(L.W,C,"videoDownloadContextEntity"),2);Z=v.J;return(z=Z)!=null&&z.offlineModeType?v.return({offlineModeType:Z.offlineModeType}):v.return(void 0)})},Frf=function(L,m,n){var C,Z,z,v,X;
return g.B(function(N){if(N.W==1){if(!m.frameworkUpdates||!g.k(m.frameworkUpdates,IR))return N.return();if(!(g.k(m.frameworkUpdates,IR).mutations&&g.k(m.frameworkUpdates,IR).mutations.length>0&&g.k(m.frameworkUpdates,IR).mutations[0].type==="ENTITY_MUTATION_TYPE_DELETE"))return N.Zl(2);C=g.ot(g.k(m.frameworkUpdates,IR).mutations[0].entityKey).entityId;return g.U(N,Ji(L.W,C),3)}if(N.W!=2){Z=N.J;z=g.k(n.actionMetadata,pL);if(X=(v=z)==null?void 0:v.playlistId)Z.playlistId=X;Z.offlineDeleteReason="OFFLINE_DELETE_REASON_UNKNOWN";
return g.bB(L.yd)?g.U(N,SP(C,L.W,n,L.G,Z),2):g.p5(L.yd)?g.U(N,Ai(C,L.W,n,L.G),2):N.Zl(2)}return g.U(N,TI$(g.k(m.frameworkUpdates,IR)),0)})},FF=function(L,m,n,C,Z,z){return new QH(m?"OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS":"OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",VH(L),n,C,Z,z)},h_p=function(L,m,n){m=xpr(L.yd,n.cotn,m);
n=g.h1(m);return g.po3(m,n,L.yd)},r9D=function(L,m){var n,C,Z,z,v,X,N,T,V,a,q;
return g.B(function(D){if(D.W==1)return n=[],g.U(D,jj(L.W,{mode:"readonly",Tb:!0},function(O){var e=[],I=m.offlineVideoStreams;if(I){I=g.M(I);for(var t=I.next();!t.done;t=I.next())e.push(Y$(O,t.value,"offlineVideoStreams"))}return g.w9.all(e)}),2);
if(C=D.J)for(Z=g.M(C),z=Z.next();!z.done;z=Z.next())if(v=z.value,X=void 0,(X=v)==null?0:X.streamsProgress)for(N=v.streamsProgress,T=0;T<N.length;T++)V=N[T],a=JSON.parse(V.formatStreamBytes),q={itag:a.itag,lmt:a.lastModified,xtags:a.xtags},n.push(q);return D.return(n)})},Hrw=function(L,m){this.W=L;
this.yd=m},Yu$=function(L,m){var n,C,Z,z,v,X,N,T,V,a,q,D;
return g.B(function(O){switch(O.W){case 1:return n=VH(m),g.U(O,LL(L.W,"videoPlaybackPositionEntity"),2);case 2:C=O.J;if(C.length===0)return O.return(new QH("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",n));g.M3(O,3);return g.U(O,rk.getInstance(),5);case 5:Z=O.J;if(!Z)throw Error("prefStorage is undefined");return g.U(O,Z.get("psi"),6);case 6:return z=O.J,N=(X=(v=z)==null?void 0:v.zj)!=null?X:"0",g.U(O,fKl(C,N),7);case 7:return T=O.J,V={isPaused:T.watchHistoryPaused,zj:T.syncTimestampUsec},g.U(O,Z.set("psi",
V),8);case 8:if(V.isPaused){O.Zl(9);break}a=g.k(T.frameworkUpdates,IR);if(!T.frameworkUpdates||!a){O.Zl(9);break}return g.U(O,TI$(a),9);case 9:g.t_(O,4);break;case 3:return q=g.fJ(O),D="PPE handleRefresh error: "+(q instanceof Error?q.message:"unknown error"),z8(D),O.return(new QH("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",n,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return O.return(new QH("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
n))}})},GYo=function(L,m){var n,C,Z,z,v,X,N,T;
return g.B(function(V){switch(V.W){case 1:return n=VH(m),C=g.ot(m.entityKey).entityId,g.M3(V,2),g.U(V,rk.getInstance(),4);case 4:Z=V.J;if(!Z)throw Error("prefStorage is undefined");return g.U(V,Z.get("psi"),5);case 5:z=V.J;v=g.k(m.actionMetadata,Wr$);if(((X=z)==null?void 0:X.isPaused)!==!1||(N=v)==null||!N.lastPlaybackPositionSeconds){V.Zl(6);break}T={key:g.cq(C,"videoPlaybackPositionEntity"),videoId:C,lastPlaybackPositionSeconds:v.lastPlaybackPositionSeconds};return g.U(V,o2(L.W,T,"videoPlaybackPositionEntity"),
6);case 6:g.t_(V,3);break;case 2:return g.fJ(V),V.return(new QH("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",n,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return V.return(new QH("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",n))}})},dgr=function(L,m){var n,C,Z;
return g.B(function(z){switch(z.W){case 1:n=VH(m);g.M3(z,2);C=g.ot(m.entityKey).entityId;if(C==="!*$_ALL_ENTITIES_!*$")return g.U(z,zyo(L.W),5);Z=g.cq(C,"videoPlaybackPositionEntity");return g.U(z,Z_1(L.W,Z),5);case 5:g.t_(z,3);break;case 2:return g.fJ(z),z.return(new QH("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",n,void 0,"OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return z.return(new QH("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
n))}})},Kr0=function(L,m){this.api=L;
this.W=m;this.logger=new g.ST("woffle");this.J=!1;this.Xe={hS:this.hS}},xgz=function(L){return g.B(function(m){return m.return(O_H(L))})},y9F=function(L){var m;
return g.B(function(n){if(n.W==1)return g.U(n,g.C9g(L),2);m=n.J;return n.return(m.filter(function(C){return!!C.url}).map(function(C){return C.url}))})},uE=function(L,m){var n=g.NA(m);
if(n===1||n===0)return Promise.resolve();(n=jao(L,m))&&n.stopVideo();L.G=0;return xgz(m)},hi=function(L,m,n,C){n=n===void 0?!1:n;
C=C===void 0?!0:C;m=typeof m==="string"?m:m.videoDetails.videoId;if(g.NA(m)===2){var Z=jao(L,m);Z&&Z.stopVideo();g.Tq(m,2);L.G=2;n?oaF(L.W):C&&c9f(L.W)}},jao=function(L,m){var n;
return((n=L.player)==null?void 0:n.getVideoData().videoId)===m?L.player:null},L_l=function(L,m){this.W=L;
this.yd=m},n0p=function(L,m){var n,C;
return g.B(function(Z){switch(Z.W){case 1:return n=VH(m),g.U(Z,cw(L.W,m.entityKey,"transfer"),2);case 2:if(C=Z.J)return Z.return(new QH("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",n));g.M3(Z,3);return g.U(Z,m8F(L,m),5);case 5:g.t_(Z,4);break;case 3:return g.fJ(Z),Z.return(new QH("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",n,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return Z.return(new QH("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
n))}})},Czz=function(L,m){var n,C;
return g.B(function(Z){switch(Z.W){case 1:return n=VH(m),g.U(Z,cw(L.W,m.entityKey,"transfer"),2);case 2:C=Z.J;if(!C||C.transferState!=="TRANSFER_STATE_COMPLETE")return Z.return(new QH("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",n));g.M3(Z,3);return g.U(Z,m8F(L,m,!0),5);case 5:g.t_(Z,4);break;case 3:return g.fJ(Z),Z.return(new QH("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",n,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));
case 4:return Z.return(new QH("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",n))}})},ZMw=function(L,m){var n,C,Z,z,v,X,N,T,V,a;
return g.B(function(q){switch(q.W){case 1:return n=VH(m),C=g.ot(m.entityKey).entityId,g.U(q,jj(L.W,{mode:"readonly",Tb:!0},function(D){var O=Y$(D,m.entityKey,"transfer");D=Y$(D,g.cq(C,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.w9.all([O,D])}),2);
case 2:Z=q.J;z=g.M(Z);v=z.next().value;X=z.next().value;N=v;T=X;if(!N||N.transferState!=="TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH")return q.return(new QH("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",n));g.M3(q,3);N.transferState="TRANSFER_STATE_TRANSFER_IN_QUEUE";return g.U(q,o2(L.W,N,"transfer"),5);case 5:V=g.ot(N.key).entityId;H_Z({videoId:V,jZ:N,offlineModeType:(a=T)==null?void 0:a.offlineModeType});g.t_(q,4);break;case 3:return g.fJ(q),q.return(new QH("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",
n,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return q.return(new QH("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",n))}})},m8F=function(L,m,n){n=n===void 0?!1:n;
var C,Z,z,v,X,N,T,V,a,q,D,O,e,I,t;return g.B(function(b){switch(b.W){case 1:return C=g.k(m.actionMetadata,zkZ),Z=g.ot(m.entityKey).entityId,z=g.cq(Z,"downloadStatusEntity"),g.U(b,jj(L.W,{mode:"readonly",Tb:!0},function(P){var F=Y$(P,z,"downloadStatusEntity");P=Y$(P,g.cq(Z,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.w9.all([F,P])}),2);
case 2:return v=b.J,X=g.M(v),N=X.next().value,T=X.next().value,V=N,a=T,q="TRANSFER_STATE_TRANSFER_IN_QUEUE",((D=V)==null?void 0:D.downloadState)==="DOWNLOAD_STATE_USER_DELETED"&&(q="TRANSFER_STATE_PAUSED_BY_USER"),I={key:m.entityKey,transferState:q,cotn:g.lt(16),enqueuedTimestampMs:Date.now().toString(),maximumDownloadQuality:(O=C)==null?void 0:O.maximumDownloadQuality,preferredAudioTrack:(e=C)==null?void 0:e.preferredAudioTrack,transferRetryCount:0,isRefresh:n,hasLoggedFirstStarted:!1},g.U(b,jj(L.W,
{mode:"readwrite",Tb:!0},function(P){var F=[];n&&F.push(KE(P,g.cq(Z,"offlineVideoStreams")));F.push(dk(P,I,"transfer"));return g.w9.all(F)}),3);
case 3:if(!n){b.Zl(4);break}return g.U(b,xgz(Z),4);case 4:rkw({videoId:Z,jZ:I,offlineModeType:(t=a)==null?void 0:t.offlineModeType}),g.gp(b)}})},E0$=function(L,m,n,C){if(!L.action.entityKey)throw Error("entityKey is missing.");
var Z=g.ot(L.action.entityKey);Z={entityType:Z.qH,entityId:Z.entityId,offlineOrchestrationActionType:L.action.actionType,orchestrationAction:{orchestrationActionId:L.actionId}};m&&(Z.offlineOrchestrationActionResult=m.status,Z.isRetryable=n?!1:m.W,m.G&&(Z.offlineOrchestrationFailureReason=v0o(m.G,Z.isRetryable)));var z,v;if((z=L.action.actionMetadata)==null?0:(v=z.offlineLoggingData)==null?0:v.offlineModeType)Z.offlineModeType=L.action.actionMetadata.offlineLoggingData.offlineModeType;C&&(Z.additionalOrchestrationActions=
C.map(function(X){return{orchestrationActionId:X.actionId}}));
return Z},v0o=function(L,m){return L!=="OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR"||m?L==="OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR"&&m?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":L:"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR"},Xuw=function(L,m){var n={offlineOrchestrationContext:E0$(L)};
m=SVo(m,n);IGr(MJl(),m,L.rootActionId)},NLF=function(L,m,n,C){C=C===void 0?[]:C;
m={offlineOrchestrationContext:E0$(L,m,n,C)};m=SVo(3,m);IGr(MJl(),m,L.rootActionId)},TLr=function(){this.actions=[]},VlZ=function(L,m){m=g.M(m);
for(var n=m.next();!n.done;n=m.next())n=n.value,Xuw(n,1),L.actions.push(n);L.actions.sort(L.W)},iMp=function(L,m){if(m)for(var n=0;n<L.actions.length;n++)if(m==="!*$_ALL_ENTITIES_!*$"&&L.actions[n].actionId!==m||m!=="!*$_ALL_ENTITIES_!*$"&&L.actions[n].rootActionId===m&&L.actions[n].actionId!==m)L.actions.splice(n,1),n--},$8p=function(L,m){L=g.M(L.actions);
for(var n=L.next();!n.done;n=L.next())if(n.value.actionId===m)return!0;return!1},ri=function(L,m,n,C,Z){g.u.call(this);
var z=this;this.J=L;this.LI=m;this.wd=n;this.B=C;this.yd=Z;this.W=new TLr;this.S=new g.kQ;this.G=new g.jW(function(){z.retry()});
this.C=NaN;this.K=!1;this.Xe={NCI:function(){return z.W},
Kk:function(){return z.S},
TCd:function(){return z.G},
retry:function(){return z.retry()}};
g.h(this,this.G);this.X=this.J.observe(this.Je.bind(this))},D8_=function(L,m,n,C,Z){var z;
return g.B(function(v){if(v.W==1)return z=new ri(L,m,n,C,Z),g.U(v,aHZ(z),2);qip(z);return v.return(z)})},qip=function(L){var m=L.W.actions[0];
return L.L?((m==null?void 0:m.action.actionType)==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&L.L[0].action.actionType!=="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(L.K=!0),Promise.resolve()):OMw(L)},OMw=function(L){var m,n,C,Z,z,v,X,N,T,V,a,q,D,O,e,I,t;
return g.B(function(b){switch(b.W){case 1:if(L.L)throw Error("Already processing an action");if(L.FK())return b.return();m=L.W.actions.shift();uyl(L.wd,!m);if(m===void 0)return b.return();m.action.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&m.actionId==="DOWNLOADS_LIST_ENTITY_ID_SMART_DOWNLOADS"&&iMp(L.W,m.actionId);n="";m.action.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&m.rootActionId===m.actionId&&(n=m.actionId);C=[m];L.L=C;if(Z=L.LI[m.entityType]){b.Zl(2);break}L.L=
void 0;return g.U(b,OMw(L),3);case 3:return b.return();case 2:z=g.M(C);for(v=z.next();!v.done;v=z.next())X=v.value,Xuw(X,2);g.M3(b,4,5);return g.U(b,saJ(Z,C.map(function(P){return P.action})),7);
case 7:N=b.J,T=g.M(C),V=T.next();case 8:if(V.done){b.Zl(10);break}a=V.value;q=N.get(a.action);return g.U(b,lH$(L,a,q),9);case 9:V=T.next();b.Zl(8);break;case 10:iMp(L.W,n);case 5:g.Pm(b);L.L=void 0;g.sd(b,6);break;case 4:return D=g.fJ(b),z8("Orchestration error",D),g.M3(b,12),g.U(b,Rkz(L,C),14);case 14:g.t_(b,5);break;case 12:O=g.fJ(b);z8("Orchestration retry error",O);e=g.M(C);for(I=e.next();!I.done;I=e.next())t=I.value,t.retryScheduleIndex<3&&VlZ(L.W,[t]);b.Zl(5);break;case 6:return g.U(b,OMw(L),
0)}})},lH$=function(L,m,n){var C,Z,z,v,X,N,T,V,a,q,D,O;
return g.B(function(e){switch(e.W){case 1:C=m.retryScheduleIndex+2===3;if(n.status==="OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS"){e.Zl(2);break}if(n.status!=="OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE"){e.Zl(0);break}NLF(m,n,C);if(n.W&&m.retryScheduleIndex+1<3)return g.U(e,Rkz(L,[m]),0);z=((Z=n)==null?0:Z.J)?n.J:"OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN";v={entityKey:m.action.entityKey,failureReason:z};X=void 0;g.bB(L.yd)?X="mainVideoDownloadStateEntity":g.p5(L.yd)&&(X="musicTrackDownloadMetadataEntity");
if(!X||!n.downloadState){e.Zl(7);break}N=g.ot(m.action.entityKey).entityId;return g.U(e,q2(N,X,L.J,n.downloadState),7);case 7:EP(L.B,v);if(n.downloadState==="DOWNLOAD_STATE_FAILED"&&L.yd.N("html5_auto_retry_failed_pde_actions")){e.Zl(0);break}z8("Orchestration result is not retryable, deleting action");return g.U(e,Z_1(L.J,eP(m).key),0);case 2:T=void 0;try{T=(V=n.L)==null?void 0:V.map(function(I){return L.createAction(I,m)})}catch(I){return NLF(m,n,C),a={entityKey:m.action.entityKey,
failureReason:"OFFLINE_OPERATION_FAILURE_REASON_UNSUPPORTED_ENTITY_FAILED"},EP(L.B,a),z8("Orchestration subactions creation error",I),e.return()}NLF(m,n,C,T);if(!T){e.Zl(12);break}q=T.map(function(I){return eP(I)});
D=0;case 13:if(!(D<T.length)||L.K){e.Zl(15);break}return g.U(e,jj(L.J,{mode:"readwrite",Tb:!0},function(I){var t=[];t.push(KYp(I,q.slice(D,D+10),"offlineOrchestrationActionWrapperEntity"));return g.w9.all(t)}),16);
case 16:D+=10;e.Zl(13);break;case 15:if(L.K)return L.K=!1,e.return();case 12:return O=eP(m),g.U(e,Z_1(L.J,O.key),17);case 17:Xuw(m,4),g.gp(e)}})},Ml$=function(L,m){var n,C,Z,z,v,X,N,T,V,a,q,D;
return g.B(function(O){n=[];C=Infinity;Z=4E3;z=g.M(m);for(v=z.next();!v.done;v=z.next())X=v.value,N=Number(X.enqueueTimeSec),T=wup(N),V=X.retryScheduleIndex,a=V!=null&&V>0,T>0&&a?(C=Math.min(C,N),Z=Math.min(T,Z)):n.push(X);isFinite(C)&&(!L.G.isActive()||C<L.C)&&(L.C=C,L.G.start(Z));L.S.nh()||(q=n.length,n=n.filter(function(e){var I;e=((I=e.actionProto)==null?void 0:I.actionType)||"OFFLINE_ORCHESTRATION_ACTION_TYPE_UNKNOWN";return!ekF.includes(e)}),D=n.length<q,!L.G.isActive()&&D&&L.G.start(1));
n.length>0&&g0$(L,n);return g.U(O,qip(L),0)})},IHJ=function(L){var m,n,C,Z,z,v,X;
return g.B(function(N){if(N.W==1)return g.U(N,Si$(L),2);m=N.J;n=[];C=g.M(m);for(Z=C.next();!Z.done;Z=C.next())z=Z.value,v=g.ot(z.key),X=v.entityId,$8p(L.W,X)||n.push(z);return g.U(N,Ml$(L,n),0)})},wup=function(L){L=L*1E3-Date.now();
return L>4E3?4E3:L},Rkz=function(L,m){var n,C,Z;
return g.B(function(z){n=g.M(m);for(C=n.next();!C.done;C=n.next()){Z=C.value;var v=void 0,X=void 0,N=((X=Z.action)==null?void 0:(v=X.actionMetadata)==null?void 0:v.retryScheduleIntervalsInSeconds)||[1,2,4];v=1;Z.retryScheduleIndex<N.length&&(v=N[Z.retryScheduleIndex]);Z.W=v*1E3+Date.now();Z.retryScheduleIndex++}return g.U(z,JUf(L,m),0)})},aHZ=function(L){var m;
return g.B(function(n){if(n.W==1)return g.U(n,LL(L.J,"offlineOrchestrationActionWrapperEntity"),2);m=n.J;return g.U(n,Ml$(L,m),0)})},g0$=function(L,m){m.length!==0&&m.forEach(function(n){n=wi(n);
n.retryScheduleIndex<3&&VlZ(L.W,[n])})},Si$=function(L,m){var n;
return g.B(function(C){if(C.W==1)return g.U(C,LL(L.J,"offlineOrchestrationActionWrapperEntity",m),2);n=C.J;return C.return(n.filter(VJl))})},JUf=function(L,m){if(m.length===0)return Promise.resolve([]);
m=m.map(function(n){return eP(n)});
return Cyz(L.J,m)},AU_=function(L){this.Pv=L;
this.W=void 0},bMH=function(L,m){var n,C,Z,z;
return g.B(function(v){n=m.videoId;C=!0;if(m.captionTracks.length)Z=hXr(m),L.W=new g.Ab(L.Pv,m,Z);else if(m.hw)z=g.TfU(m),L.W=new g.tb(L.Pv,m.hw,n,z,m.u2,m.eventId),C=m.u2;else return v.return();return v.return(new Promise(function(X){var N;(N=L.W)==null||N.ez({TM:function(){return g.B(function(T){if(T.W==1)return g.U(T,L.TM(n,C),2);X();g.gp(T)})},
lD:function(){}})}))})},tlo=function(L){var m;
return g.B(function(n){if(n.W==1)return g.U(n,Dp0(L),2);m=n.J;return n.return(!!m&&m.length>0)})},kt=function(L){g.u.call(this);
this.W=L;this.J=this.W.observe(this.G.bind(this))},fH0=function(L,m){var n,C,Z,z,v,X,N;
return g.B(function(T){switch(T.W){case 1:if(m.length===0)return T.return([]);n=m.map(function(V){return g.cq(V,"transfer")});
return g.U(T,LL(L.W,"transfer",n),2);case 2:C=T.J;Z=C.filter(VJl).map(function(V){return g.ot(V.key).entityId});
z=m.filter(function(V){return Z.indexOf(V)===-1});
if(z.length===0)return T.return([]);v=g.M(z);X=v.next();case 3:if(X.done){T.Zl(5);break}N=X.value;return g.U(T,xgz(N),4);case 4:X=v.next();T.Zl(3);break;case 5:return T.return(z)}})},PzD=function(L,m,n,C,Z,z){var v,X,N;
return g.B(function(T){v="STREAM_TYPE_UNKNOWN";n.video&&n.audio?(v="STREAM_TYPE_AUDIO_AND_VIDEO",z8("unexpected stream type")):n.video&&!n.audio?v="STREAM_TYPE_VIDEO":!n.video&&n.audio&&(v="STREAM_TYPE_AUDIO");X=g.cq(m,"offlineVideoStreams");N={numBytesDownloaded:Z.toFixed(),numTotalBytes:z.toFixed(),streamType:v,streamState:"DOWNLOAD_STREAM_STATE_IN_PROGRESS",formatStreamBytes:JSON.stringify(C),itag:v==="STREAM_TYPE_AUDIO_AND_VIDEO"?Number(n.itag):void 0};return g.U(T,jj(L,{mode:"readwrite",Tb:!0},
function(V){var a=Y$(V,X,"offlineVideoStreams"),q=Y$(V,g.cq(m,"transfer"),"transfer");return g.w9.all([a,q]).then(function(D){D=g.M(D);var O=D.next().value;D=D.next().value;if(!D)return KE(V,X).then(function(){});
var e=U8z(O);O=BLz(O,C,N,X);var I=dk(V,O,"offlineVideoStreams");U8z(O)>e&&(D.lastProgressTimeMs=Date.now().toString());e=[I];D.offlineVideoStreams||(D.offlineVideoStreams=[]);D.offlineVideoStreams.indexOf(X)===-1&&(D.offlineVideoStreams.push(X),e.push(dk(V,D,"transfer")));return g.w9.all(e)})}),0)})},smp=function(L,m){var n,C,Z,z,v;
return g.B(function(X){if(X.W==1)return n=g.cq(m,"offlineVideoStreams"),g.U(X,cw(L,n,"offlineVideoStreams"),2);C=X.J;if(!C||!C.streamsProgress)return X.return();Z=g.M(C.streamsProgress);for(z=Z.next();!z.done;z=Z.next())v=z.value,v.streamState="DOWNLOAD_STREAM_STATE_COMPLETE",v.numTotalBytes!==v.numBytesDownloaded&&(v.numBytesDownloaded=v.numTotalBytes);return g.U(X,o2(L,C,"offlineVideoStreams"),0)})},BLz=function(L,m,n,C){if(L&&L.streamsProgress){C=L;
a:{m=m.itag+";"+m.xtags;for(var Z=L.streamsProgress,z=0;z<Z.length;z++){var v=JSON.parse(Z[z].formatStreamBytes);if(v.itag+";"+v.xtags===m){Z[z]=n;n=Z;break a}}Z.push(n);n=Z}C.streamsProgress=n}else L={key:C,streamsProgress:[n]};return L},U8z=function(L){if(L==null?0:L.streamsProgress){var m=0;
L=L.streamsProgress;for(var n=0;n<L.length;n++){var C=L[n];isNaN(Number(C.numBytesDownloaded))?z8("stream progress bytes number invalid"):m+=Number(C.numBytesDownloaded)}return m}return 0},Qmf=function(L,m,n,C){g.u.call(this);
var Z=this;this.J=L;this.api=m;this.Hv=n;this.Je=C;this.S=new g.kQ;this.L=new g.jW(function(){Z.W&&Z.W.transferState==="TRANSFER_STATE_TRANSFERRING"&&Z.S.nh()&&((Z.W.transferRetryCount||0)<3?hi(Z.B,Z.K,!1,!1):uE(Z.B,Z.K.videoDetails.videoId),Z.GR("TRANSFER_FAILURE_REASON_TIMEOUT_NO_PROGRESS"))});
this.wd=this.KI=0;this.X=this.C=!1;this.YU=g.Ee(this.api.D().experiments,"html5_transfer_processing_logs_interval");this.Qd=new g.tC(this);this.Xe={fZo:function(){return Z.L},
aZ1:function(){return Z.Je},
Kk:function(){return Z.S}};
this.LI=this.J.observe(this.hc.bind(this));this.B=new Kr0(m,this);this.pI=new AU_(m);this.aj=new kt(this.J);this.rd=this.S.listen("publicytnetworkstatus-online",this.BI.bind(this));this.SD=this.S.listen("publicytnetworkstatus-offline",this.a$b.bind(this));this.X=this.api.D().N("html5_less_transfer_processing_logs");g.h(this,this.Qd);this.Qd.j(m,"offlinetransferpause",this.ZXK);if(g.bB(this.api.D()))this.G="mainVideoDownloadStateEntity";else if(g.p5(this.api.D())||g.f4(this.api.D()))this.G="musicTrackDownloadMetadataEntity"},
puw=function(L){return g.B(function(m){if(m.W==1)m=g.U(m,aGo(),2);
else{var n=L.aj;var C=g.Xw();C=Object.keys(C);n=fH0(n,C);m=g.U(m,n,0)}return m})},Yt=function(L,m){m=m===void 0?!1:m;
var n;return g.B(function(C){if(C.W==1){if(L.W)throw Error("Already downloading a video");L.wd=0;L.C=!1;return g.U(C,F_Z(L),2)}return C.W!=4?(n=C.J,hyJ(L.Hv,!n),n&&L.S.nh()?m?g.U(C,new Promise(function(Z){g.aT(Z,1E3)}),4):C.Zl(4):(!n&&L.W&&HU(L),C.Zl(0))):g.U(C,uX0(L,n),0)})},hk_=function(L){return g.B(function(m){if(m.W==1)return L.K?g.U(m,uE(L.B,L.K.videoDetails.videoId),3):m.Zl(0);
HU(L);g.gp(m)})},rUp=function(L,m){var n,C,Z;
return g.B(function(z){switch(z.W){case 1:return g.M3(z,2),(n=!!m.captionTracks.length||!!m.hw)?g.U(z,tlo(m.videoId),4):z.return();case 4:return(C=z.J)?z.return():g.U(z,bMH(L.pI,m),5);case 5:g.t_(z,0);break;case 2:Z=g.fJ(z),z8("Caption downloading error",Z,m.cotn),g.gp(z)}})},uX0=function(L,m){var n,C,Z,z,v,X;
return g.B(function(N){switch(N.W){case 1:if(L.C)return N.return();L.C=!0;L.W=m;n=g.ot(L.W.key);C=n.entityId;Z=void 0;if(L.W.transferState==="TRANSFER_STATE_TRANSFERRING")return g.U(N,WU(L,C),7);if(L.W.transferState!=="TRANSFER_STATE_TRANSFER_IN_QUEUE"||L.W.transferRetryCount||L.W.hasLoggedFirstStarted){N.Zl(3);break}return g.U(N,WU(L,C),5);case 5:return Z=N.J,L.W.hasLoggedFirstStarted=!0,g.U(N,k2r(L),6);case 6:kJl({videoId:C,jZ:L.W,offlineModeType:Z},void 0,void 0,!0);N.Zl(3);break;case 7:Z=N.J,
T8({transferStatusType:"TRANSFER_STATUS_TYPE_RESUME_PROCESSING",statusType:"OFFLINING_RETRIED"},{videoId:C,jZ:L.W,offlineModeType:Z});case 3:return g.U(N,HMF(L),8);case 8:return z=null,g.M3(N,9),g.U(N,Yiw(L,m),11);case 11:z=N.J;L.K=z;g.t_(N,10);break;case 9:return v=g.fJ(N),z8("error getting player response",v,m.cotn),g.U(N,L.GR("TRANSFER_FAILURE_REASON_SERVER_PROPERTY_MISSING"),12);case 12:return N.return();case 10:return X=xpr(L.api.D(),m.cotn,z),g.U(N,rUp(L,X),13);case 13:return g.U(N,y9F(X.videoId),
14);case 14:X.qF=N.J;var T=L.B,V=X,a=m.maximumDownloadQuality;V.getPlayerResponse();g.Tq(V.videoId,2);T.G=2;T.J=!1;var q;(q=T.player)==null||q.dispose();T.player=T.api.QR(V);V={};T.player.jb((V.localmediachange=T.kp,V.signatureexpired=T.Jn,V.statechange=T.l0K,V),T);T.N("html5_generate_content_po_token")&&T.player.dj();a=T.hS(a);T.player.VW(g.UO(a,a,!0,"m"),!1);T.player.Yb(!1);L.L.start(108E5);g.gp(N)}})},F_Z=function(L){var m,n;
return g.B(function(C){if(C.W==1)return g.U(C,LL(L.J,"transfer"),2);m=C.J;n=m.filter(W_1).sort(G2o);return n.length===0?C.return():C.return(n[0])})},HMF=function(L){var m,n,C;
return g.B(function(Z){if(Z.W==1){if(!L.W)return G8(L,"onTransferStart"),Z.return();L.L.start(108E5);return g.U(Z,di(L,"TRANSFER_STATE_TRANSFERRING"),2)}m=L.W;return(C=((n=m)==null?0:n.key)?g.ot(m.key).entityId:"")&&L.G?g.U(Z,q2(C,L.G,L.J,"DOWNLOAD_STATE_DOWNLOAD_IN_PROGRESS"),0):Z.Zl(0)})},oaF=function(L){var m,n,C,Z;
g.B(function(z){switch(z.W){case 1:if(!L.W){G8(L,"onTransferPausedByUser");z.Zl(2);break}m=L.W;L.L.stop();return g.U(z,di(L,"TRANSFER_STATE_PAUSED_BY_USER"),3);case 3:C=((n=m)==null?0:n.key)?g.ot(m.key).entityId:"";if(!C||!L.G){z.Zl(4);break}return g.U(z,q2(C,L.G,L.J,"DOWNLOAD_STATE_PAUSED"),4);case 4:return g.U(z,WU(L,C),6);case 6:Z=z.J,YVD({videoId:C,jZ:m,offlineModeType:Z});case 2:HU(L),Yt(L),g.gp(z)}})},c9f=function(L){var m,n,C;
g.B(function(Z){if(Z.W==1){if(!L.W)return G8(L,"onTransferPausedByNetwork"),Z.return();L.L.stop();return g.U(Z,di(L,"TRANSFER_STATE_TRANSFER_IN_QUEUE"),2)}if(Z.W!=3)return m=L.W,(C=((n=m)==null?0:n.key)?g.ot(m.key).entityId:"")&&L.G?g.U(Z,q2(C,L.G,L.J,"DOWNLOAD_STATE_PAUSED"),3):Z.Zl(3);HU(L);g.gp(Z)})},d8J=function(L){var m,n,C,Z,z;
g.B(function(v){switch(v.W){case 1:if(!L.W)return G8(L,"onTransferComplete"),v.return();m=L.W;L.L.stop();if(!m||!L.K){v.Zl(2);break}n=xpr(L.api.D(),m.cotn,L.K);return g.U(v,rUp(L,n),2);case 2:return g.U(v,di(L,"TRANSFER_STATE_COMPLETE","DOWNLOAD_STREAM_STATE_COMPLETE"),4);case 4:Z=((C=m)==null?0:C.key)?g.ot(m.key).entityId:"";if(!Z||!L.G){v.Zl(5);break}return g.U(v,q2(Z,L.G,L.J,"DOWNLOAD_STATE_COMPLETE"),5);case 5:return g.U(v,smp(L.J,Z),7);case 7:return g.U(v,WU(L,Z),8);case 8:z=v.J,T8({transferStatusType:"TRANSFER_STATUS_TYPE_COMPLETED",
statusType:"SUCCESS"},{videoId:Z,jZ:m,offlineModeType:z}),HU(L),Yt(L),g.gp(v)}})},K__=function(L,m,n){var C,Z;
g.B(function(z){switch(z.W){case 1:if(!L.W)return G8(L,"onTransferProgress: "+m),z.return();if(L.W.transferState==="TRANSFER_STATE_TRANSFERRING"){z.Zl(2);break}return g.U(z,HMF(L),2);case 2:C=Date.now();if(!(C-L.KI>1E3)){z.Zl(4);break}L.KI=C;return g.U(z,PzD(L.J,n.videoId,n.J,n.sU,n.bytesDownloaded,n.W),5);case 5:if(L.X&&!(L.X&&C-L.wd>L.YU)){z.Zl(4);break}L.wd=C;return g.U(z,WU(L,m),7);case 7:Z=z.J,kJl({videoId:m,jZ:L.W,offlineModeType:Z},n.bytesDownloaded,n.W);case 4:L.L.start(108E5),g.gp(z)}})},
x8w=function(L){var m=(L.W.transferRetryCount||0)<3;
m&&(L=L.W,L.transferRetryCount=(L.transferRetryCount||0)+1);return m},yU0=function(L,m){m=m===void 0?"TRANSFER_FAILURE_REASON_UNKNOWN":m;
var n,C,Z,z;return g.B(function(v){if(v.W==1)return L.W||G8(L,"setTransferToFailed: "+m),n="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",m==="TRANSFER_FAILURE_REASON_NETWORK"?n="OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED":m==="TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE"&&(n="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED"),g.U(v,di(L,"TRANSFER_STATE_FAILED","DOWNLOAD_STREAM_STATE_ERROR_STREAMS_MISSING",m),2);if(v.W!=3)return EP(L.Je,{entityKey:(C=L.W)==null?void 0:C.key,failureReason:n}),
Z=L.W?g.ot(L.W.key).entityId:"",g.U(v,WU(L,Z),3);z=v.J;var X={videoId:Z,jZ:L.W,offlineModeType:z},N=m,T={transferStatusType:"TRANSFER_STATUS_TYPE_TERMINATED_WITH_FAILURE",statusType:"FAILED"};N&&(T.transferFailureReason=N,T.failureReason=Wjz(N));T8(T,X);g.gp(v)})},di=function(L,m,n,C){var Z;
return g.B(function(z){if(z.W==1){if(!L.W)return G8(L,"saveTransferState: "+m),z.return();L.W.transferState=m;L.W.failureReason=C;g.M3(z,2);return g.U(z,k2r(L,function(v){return n?Ww(v,"offlineVideoStreams",L.W.offlineVideoStreams).then(function(X){for(var N=g.M(X),T=N.next();!T.done;T=N.next())if((T=T.value)&&T.streamsProgress){T=g.M(T.streamsProgress);for(var V=T.next();!V.done;V=T.next())V.value.streamState=n}return KYp(v,X.filter(function(a){return!!a}),"offlineVideoStreams")}):g.w9.resolve(void 0)}),
4)}if(z.W!=2)return g.t_(z,0);
Z=g.fJ(z);return Z instanceof g.$G&&Z.type==="QUOTA_EXCEEDED"?g.U(z,L.GR("TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE"),0):z.Zl(0)})},k2r=function(L,m){var n;
return g.B(function(C){if(!L.W)return C.return();n=L.W;return g.U(C,jj(L.J,{mode:"readwrite",Tb:!0},function(Z){var z=[dk(Z,n,"transfer")];m&&z.push(m(Z));return g.w9.all(z)}),0)})},HU=function(L){L.W=void 0;
L.K=void 0;L.L.stop()},Yiw=function(L,m){var n,C,Z,z,v;
return g.B(function(X){if(X.W==1)return n=g.ot(m.key),C=n.entityId,Z=g.cq(C,"playbackData"),g.U(X,cw(L.J,Z,"playbackData"),2);z=X.J;if((v=z)==null?0:v.playerResponseJson)return X.return(JSON.parse(z.playerResponseJson));throw Error("No PlayerResponse found");})},G8=function(L,m){L.api.kU("woffle",{mcte:m});
z8("missing current transfer entity.")},WU=function(L,m){var n,C,Z;
return g.B(function(z){if(z.W==1)return g.U(z,cw(L.J,g.cq(m,"videoDownloadContextEntity"),"videoDownloadContextEntity"),2);n=z.J;return z.return((Z=(C=n)==null?void 0:C.offlineModeType)!=null?Z:void 0)})},W_1=function(L){return jm$[L.transferState]!==void 0},G2o=function(L,m){var n=jm$[L.transferState],C=jm$[m.transferState];
return n!==C?n-C:Number(L.enqueuedTimestampMs)-Number(m.enqueuedTimestampMs)},KL=function(L,m){var n=this;
this.yd=L;this.api=m;this.S=new g.kQ;this.K=new g.$z;this.Xe={nk:function(){return n.G.Xe.nk()},
Kk:function(){return n.S},
ZDZ:function(){return n.G},
oi:function(){return n.oi()},
Wn:function(){return n.Wn()},
kM:function(){return n.kM()},
K1:function(){return n.K1()},
n1:function(){return n.n1()},
Rb:function(C){return n.Rb(C)}};
this.G=new QsD(function(){return o0J(n)},function(){n.kM()},this.api.S3(),this.api.N.bind(this.api));
this.W=new vU(this.api);phF(this.G)},o0J=function(L){return g.B(function(m){L.api.Vd("onOrchestrationBecameLeader");
return g.U(m,L.Wn(),0)})},Ltr=function(L){var m,n;
return g.B(function(C){if(C.W==1)return g.U(C,ms(),2);if(C.W!=3){m=C.J;if(!m)return z8("PES is undefined"),C.return();L.J=new Qmf(m,L.api,L.G,L.W);n=L.OA(m);return g.U(C,D8_(m,n,L.G,L.W,L.yd),3)}L.B=C.J;return g.U(C,cU0(L),0)})},cU0=function(L){var m;
return g.B(function(n){switch(n.W){case 1:if(!L.J)return z8("transferManager is undefined"),n.return();if(L.J.W){n.Zl(2);break}return g.U(n,Yt(L.J),2);case 2:if(!L.yd.N("woffle_enable_main_downloads_library")){n.Zl(4);break}return g.U(n,L.RO(),4);case 4:if(!L.yd.N("html5_offline_playback_position_sync")){n.Zl(6);break}return g.U(n,L.TC(),7);case 7:return g.U(n,L.Rb(864E5),6);case 6:return g.U(n,L.refreshAllStaleEntities(43200,!0),9);case 9:return g.U(n,L.xR(),10);case 10:if(!L.yd.N("html5_retry_downloads_for_expiration")){n.Zl(11);
break}return g.U(n,L.n1(),11);case 11:return L.C=g.DC(function(){L.refreshAllStaleEntities(43200,!0);L.xR()},9E5),g.xZ(g.j5(),function(){return L.K1()}),g.U(n,ms(),13);
case 13:return m=n.J,g.U(n,ss1(m),14);case 14:Fjw(L.G),g.gp(n)}})},mL_=function(){var L,m,n,C,Z,z;
return g.B(function(v){switch(v.W){case 1:return g.U(v,ms(),2);case 2:L=v.J;if(!L)return v.return([]);m=Date.now()/1E3;return g.U(v,LL(L,"offlineVideoPolicy"),3);case 3:n=v.J,C=g.M(n),Z=C.next();case 4:if(Z.done){v.Zl(6);break}z=Z.value;if(!(z.expirationTimestamp&&Number(z.expirationTimestamp)<m)){v.Zl(5);break}z.action="OFFLINE_VIDEO_POLICY_ACTION_DISABLE";z.offlinePlaybackDisabledReason="OFFLINE_PLAYBACK_DISABLED_REASON_CLIENT_OFFLINE_CONTENT_EXPIRED";return g.U(v,o2(L,z,"offlineVideoPolicy"),5);
case 5:Z=C.next();v.Zl(4);break;case 6:return v.return(n.map(function(X){return X.key}))}})},xt=function(L,m,n,C,Z){var z,v,X;
return g.B(function(N){if(N.W==1)return g.U(N,ms(),2);z=N.J;if(!z)return N.return([]);v=m.map(function(T){var V=g.cq(T,n);V={actionType:C,entityKey:V,actionMetadata:Object.assign({},ykH(),Z)};C!=="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&(V.actionMetadata.priority=0);T=new RR(n,T,V);return eP(T)});
X=Cyz(z,v);phF(L.G);return N.return(X)})},ns0=function(L,m,n,C){var Z,z,v,X,N,T,V,a;
return g.B(function(q){switch(q.W){case 1:Z=[],z=g.M(m),v=z.next();case 2:if(v.done){q.Zl(4);break}X=v.value;if(X.upToDate||n&&!X.shouldAutoSyncMetadata||!X.playlistId){q.Zl(3);break}N={};switch(C){case "mainPlaylistEntity":T={nextAutoRefreshIntervalSeconds:X.checkInSeconds,autoSync:n};N={mainPlaylistEntityActionMetadata:T};break;case "musicPlaylist":V={autoSync:n},N={musicPlaylistEntityActionMetadata:V}}return g.U(q,xt(L,[X.playlistId],C,"OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",N),6);case 6:(a=
q.J)&&Z.push.apply(Z,g.q3(a));case 3:v=z.next();q.Zl(2);break;case 4:return q.return(Z)}})},CPr=function(L,m){var n;
return g.B(function(C){return m.length?(n=ykH(),g.pp(n,pL,{isEnqueuedForExpiredStreamUrlRefetch:!0}),L.api.kU("qrd",{v:m.length}),C.return(xt(L,m,"playbackData","OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",n))):C.return([])})},Zk0=function(L,m,n){this.W=L;
this.yd=m;this.G=n},Esz=function(L,m){var n,C,Z,z,v,X,N,T,V,a,q,D,O,e,I,t,b;
return g.B(function(P){switch(P.W){case 1:return n=VH(m),C=g.ot(m.entityKey),Z=C.entityId,z=[],g.M3(P,2),g.U(P,zA_(L,Z),4);case 4:z=P.J;if(!(L.yd.N("woffle_enable_main_downloads_library")&&((v=z)==null?0:v.length))){P.Zl(5);break}return g.U(P,NzH(L.W,[m.entityKey]),5);case 5:g.t_(P,3);break;case 2:return X=g.fJ(P),N="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",T="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",X instanceof g.$G&&X.type==="QUOTA_EXCEEDED"?(N="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
T="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"):z8("Playlist add error"),P.return(new QH("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",n,void 0,N,T));case 3:V=[];if(!L.yd.N("html5_offline_prevent_redownload_downloaded_video")){P.Zl(7);break}return g.U(P,Kjl(L.W,"mainVideoEntity",z),8);case 8:z=P.J;case 7:if((a=z)==null?0:a.length)for(q=g.M(z),D=q.next();!D.done;D=q.next())if(O=D.value,e=O.offlineVideoData,I=void 0,(I=e)==null?0:I.videoId)t=void 0,b=Number(((t=m.actionMetadata)==null?void 0:t.priority)||
0)+1,V.push(sP("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",e.videoId,"mainVideoEntity",b,yH,vsw(m,e,Z)));return P.return(new QH("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",n,V))}})},Nu1=function(L,m){var n,C,Z,z,v,X,N,T,V,a,q,D,O,e,I,t,b,P,F,r,x,Y,Ed,N3,ZF,$P,mZ,J_,xP,Vw,T0,h_,Bm,nX,Pz,k_,EC,f,UC,JJ,CJ,AJ,S,nJ,Au,y7,F$,KJ,mD,Zj,H_,J,w,A,Q,G,Ta,W,c,p,A_,Or,X8,X$,YP,IU,Lm,I1,up,bg,ey,Ud,sr,bp;
return g.B(function(Xp){switch(Xp.W){case 1:return n=VH(m),C=m.entityKey,Z=g.ot(C).entityId,z=[],v=!1,Z==="!*$_ALL_ENTITIES_!*$"?(v=!0,g.U(Xp,LL(L.W,"mainPlaylistEntity"),5)):g.U(Xp,cw(L.W,C,"mainPlaylistEntity"),4);case 4:(X=Xp.J)&&z.push(X);Xp.Zl(3);break;case 5:z=Xp.J;case 3:if((N=z)==null||!N.length)return Xp.return(new QH("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",n));T=g.k(m.actionMetadata,XaD);a=(V=T)==null?void 0:V.nextAutoRefreshIntervalSeconds;D=(q=T)==null?void 0:q.autoSync;O=[];I=e=
!0;t=!1;if(!v&&D===!1){Xp.Zl(6);break}g.M3(Xp,7);return g.U(Xp,MWr(0,!!D,!0,z),9);case 9:O=Xp.J;g.t_(Xp,8);break;case 7:b=g.fJ(Xp);if(!(b instanceof Error&&b.message==="No data")){b instanceof Error&&b.message==="Empty response body"&&z8(b.message);Xp.Zl(8);break}return Z==="!*$_ALL_ENTITIES_!*$"?g.U(Xp,CKZ(L.W,m,L.G,"OFFLINE_DELETE_REASON_UNAVAILABLE"),8):g.U(Xp,mg$(Z,L.W,m,L.G),8);case 8:if(!O.length||!v&&O[0].playlistId!==Z)return Xp.return(new QH("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
n));case 6:if(v){P=[];F=g.M(O);for(r=F.next();!r.done;r=F.next())x=r.value,x.upToDate||D&&!x.shouldAutoSyncMetadata||!x.playlistId||(Y={nextAutoRefreshIntervalSeconds:x.checkInSeconds,autoSync:D},P.push(sP("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",x.playlistId,"mainPlaylistEntity",0,yH,{mainPlaylistEntityActionMetadata:Y})));return Xp.return(new QH("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",n,P))}O.length&&(Ed=O[0],t=!!Ed.upToDate,D&&(e=(N3=Ed.shouldAutoSyncMetadata)!=null?N3:!0,I=(ZF=Ed.shouldAutoSyncVideos)!=
null?ZF:!0,Ed.checkInSeconds&&(a=Ed.checkInSeconds)));if(t||!e)return Xp.return(new QH("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",n));$P=[];mZ=z[0];if(!mZ.downloadState){J_=void 0;Xp.Zl(15);break}return g.U(Xp,cw(L.W,mZ.downloadState,"mainPlaylistDownloadStateEntity"),16);case 16:J_=Xp.J;case 15:return xP=J_,T0=((Vw=xP)==null?0:Vw.addedTimestampMillis)?String(xP.addedTimestampMillis):void 0,g.M3(Xp,17),g.U(Xp,zA_(L,Z,T0,a),19);case 19:$P=Xp.J;g.t_(Xp,18);break;case 17:h_=g.fJ(Xp);if(!(h_ instanceof
Error&&h_.message==="No data for playlist")){if(h_ instanceof Error&&h_.message==="Empty response body for playlist")z8(h_.message);else return Bm="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",nX="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",h_ instanceof g.$G&&h_.type==="QUOTA_EXCEEDED"&&(Bm="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",nX="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),Xp.return(new QH("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",n,void 0,Bm,nX));
Xp.Zl(18);break}return g.U(Xp,mg$(Z,L.W,m,L.G),18);case 18:if(!I)return Xp.return(new QH("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",n));Pz=[];k_=new Map;if((EC=$P)==null?0:EC.length)for(f=g.M($P),UC=f.next();!UC.done;UC=f.next())JJ=UC.value,CJ=JJ.offlineVideoData,AJ=void 0,((AJ=CJ)==null?0:AJ.videoId)&&k_.set(CJ.videoId,CJ);S=new Map;nJ=[];if((Au=mZ)==null?0:(y7=Au.videos)==null?0:y7.length)for(F$=g.M(mZ.videos),KJ=F$.next();!KJ.done;KJ=F$.next())if(mD=KJ.value,Zj=JSON.parse(g.ot(mD).entityId),
H_=Zj.videoId)k_.has(H_)?(S.set(H_,k_.get(H_)),k_.delete(H_)):nJ.push(H_);w=Number(((J=m.actionMetadata)==null?void 0:J.priority)||0)+1;A=g.M(k_.entries());for(Q=A.next();!Q.done;Q=A.next())G=Q.value,Ta=g.M(G),W=Ta.next().value,c=Ta.next().value,p=W,A_=c,Pz.push(sP("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",p,"mainVideoEntity",w,yH,vsw(m,A_,Z)));Or=g.M(S.entries());for(X8=Or.next();!X8.done;X8=Or.next())X$=X8.value,YP=g.M(X$),IU=YP.next().value,Lm=YP.next().value,I1=IU,up=Lm,Pz.push(sP("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",
I1,"mainVideoEntity",w,yH,vsw(m,up,Z)));bg=g.M(nJ);for(ey=bg.next();!ey.done;ey=bg.next())Ud=ey.value,sr={playlistId:Z},bp={offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_REFRESH"},mainVideoEntityActionMetadata:sr},Pz.push(sP("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",Ud,"mainVideoEntity",0,yH,bp));return Xp.return(new QH("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",n,Pz))}})},Tuo=function(L,m){var n,C,Z,z;
return g.B(function(v){switch(v.W){case 1:return n=VH(m),g.M3(v,2),C=g.ot(m.entityKey).entityId,C==="!*$_ALL_ENTITIES_!*$"?g.U(v,CKZ(L.W,m,L.G,(Z=m.actionMetadata)==null?void 0:(z=Z.offlineLoggingData)==null?void 0:z.offlineDeleteReason),5):g.U(v,mg$(C,L.W,m,L.G),6);case 6:if(!L.yd.N("woffle_enable_main_downloads_library")){v.Zl(5);break}return g.U(v,TzH(L.W,m.entityKey),5);case 5:g.t_(v,3);break;case 2:return g.fJ(v),v.return(new QH("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",n,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
"OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return v.return(new QH("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",n))}})},zA_=function(L,m,n,C){var Z,z,v,X,N,T,V;
return g.B(function(a){switch(a.W){case 1:return g.U(a,e_r([m]),2);case 2:return Z=a.J,g.U(a,Vb$(L,Z[0],n,C),3);case 3:return z=a.J,v=z.mainPlaylistEntity,X=z.mvd,T=ckw(v,(N=X)==null?void 0:N.avatar),g.M3(a,4),g.U(a,M2(T),6);case 6:g.t_(a,5);break;case 4:V=g.fJ(a),V instanceof Error&&V.message==="Failed to fetch"&&z8(V.message);case 5:return a.return(Z[0].videos)}})},Vb$=function(L,m,n,C){var Z,z,v,X,N,T,V,a,q,D,O,e,I,t,b,P,F;
return g.B(function(r){switch(r.W){case 1:Z=Date.now().toString();n||(n=Z);z=m.videos;v=m.playlistId;X=[];N=[];if(z)for(T=g.M(z),V=T.next();!V.done;V=T.next()){a=V.value;q=a.offlineVideoData;if(!q||!q.videoId)throw z8("Invalid offlineVideoData for playlist"),Error("Invalid offlineVideoData for playlist");D=q.videoId;O={videoId:D,playlistId:v};e={id:g.cq(JSON.stringify(O),"mainPlaylistVideoEntity"),video:g.cq(D,"mainVideoEntity")};X.push(e);N.push(e.id)}t={key:g.cq(v,"mainPlaylistDownloadStateEntity"),
addedTimestampMillis:n,lastSyncedTimestampMillis:Z};b={key:g.cq(v,"mainPlaylistEntity"),playlistId:v,videos:N,title:m.title,thumbnailStyleData:ikz(m),visibility:$L1(m),downloadState:t.key};m.channel&&(P=m.channel.offlineChannelData,I=aWH(g.cq(v,"ytMainChannelEntity"),P),b.channelOwner=I.id);((F=b)==null?0:F.entityMetadata)?(b.entityMetadata.offlineLastModifiedTimestampSeconds=m.lastModifiedTimestamp,C&&(b.entityMetadata.nextAutoRefreshIntervalSeconds=String(C))):b&&(b.entityMetadata={nextAutoRefreshIntervalSeconds:C?
String(C):void 0,offlineLastModifiedTimestampSeconds:m.lastModifiedTimestamp});g.M3(r,2);return g.U(r,jj(L.W,{mode:"readwrite",Tb:!0},function(x){var Y=dk(x,b,"mainPlaylistEntity"),Ed=dk(x,t,"mainPlaylistDownloadStateEntity");Y=[Y,Ed];Ed=g.M(X);for(var N3=Ed.next();!N3.done;N3=Ed.next())Y.push(dk(x,N3.value,"mainPlaylistVideoEntity"));I&&Y.push(dk(x,I,"ytMainChannelEntity"));return g.w9.all(Y)}),4);
case 4:g.t_(r,3);break;case 2:throw g.fJ(r),z8("PES failure for playlist"),Error("PES failure for playlist");case 3:return r.return({mainPlaylistEntity:b,mvd:I,PEI:X})}})},aWH=function(L,m){return{id:L,
channelId:m.channelId,title:m.title,avatar:m.thumbnail}},ikz=function(L){var m=[],n=L.videos;
n&&n.length>0&&m.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_FIRST_VIDEO"),value:{collageThumbnail:{coverThumbnail:n[0].offlineVideoData.thumbnail}}});if((L=L.additionalMetadadatas)&&L.length>0)for(L=g.M(L),n=L.next();!n.done;n=L.next()){var C=n.value.offlineBundleItemPlaylistData,Z=void 0;n=(Z=C)==null?void 0:Z.style;Z=void 0;C={collageThumbnail:{coverThumbnail:(Z=C)==null?void 0:Z.coverThumbnail}};switch(n){case "BUNDLE_ITEM_STYLE_UNSPECIFIED":m.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_UNKNOWN"),
value:C});break;case "BUNDLE_ITEM_STYLE_TWO_BY_TWO":m.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_TWO_BY_TWO"),value:C});break;case "BUNDLE_ITEM_STYLE_ONE_AND_TWO_AVATAR":m.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_ONE_AND_TWO_AVATAR"),value:C});break;case "BUNDLE_ITEM_STYLE_ONE_AND_TWO":m.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_ONE_AND_TWO"),value:C})}}return m},$L1=function(L){switch(L.privacy){case "PRIVATE":return"PLAYLIST_VISIBILITY_PRIVATE";
case "PUBLIC":return"PLAYLIST_VISIBILITY_PUBLIC";case "UNLISTED":return"PLAYLIST_VISIBILITY_UNLISTED";default:return"PLAYLIST_VISIBILITY_UNKNOWN"}},vsw=function(L,m,n){m={offlineVideoData:m,
playlistId:n};if(L=g.k(L.actionMetadata,XaD))m.maximumDownloadQuality=L.maximumDownloadQuality;return{mainVideoEntityActionMetadata:m}},qkH=function(L,m,n){this.W=L;
this.yd=m;this.G=n},lWF=function(L,m){var n,C,Z,z,v,X,N,T,V,a,q,D,O;
return g.B(function(e){switch(e.W){case 1:return n=VH(m),C=g.ot(m.entityKey),Z=C.entityId,z=g.k(m.actionMetadata,jP),X=!((v=z)==null?0:v.playlistId),g.M3(e,2),g.U(e,DL0(L,Z,void 0,(N=z)==null?void 0:N.offlineVideoData,X),4);case 4:g.t_(e,3);break;case 2:return T=g.fJ(e),V="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",a="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",T instanceof g.$G&&T.type==="QUOTA_EXCEEDED"&&(V="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",a="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
e.return(new QH("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",n,void 0,V,a));case 3:q=1;q=Number(((D=m.actionMetadata)==null?void 0:D.priority)||0)+1;var I=(I=g.k(m.actionMetadata,jP))?{playbackDataActionMetadata:{maximumDownloadQuality:I.maximumDownloadQuality}}:void 0;O=sP("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",Z,"playbackData",q,OkZ,I);return e.return(new QH("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",n,[O]))}})},RAD=function(L,m){var n,C,Z,z,v,X,N,T,V,a,q,D,O,e,I,t,b;
return g.B(function(P){switch(P.W){case 1:return n=VH(m),C=g.ot(m.entityKey),Z=C.entityId,g.U(P,cw(L.W,m.entityKey,"mainVideoEntity"),2);case 2:z=P.J;if(!z){v=void 0;P.Zl(3);break}return g.U(P,cw(L.W,z.downloadState,"mainVideoDownloadStateEntity"),4);case 4:v=P.J;case 3:X=v;if(!z||!X)return P.return(new QH("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",n));g.M3(P,5);return g.U(P,DL0(L,Z,X.addedTimestampMillis,(T=g.k(m.actionMetadata,jP))==null?void 0:T.offlineVideoData),7);case 7:V=1;V=Number(((a=
m.actionMetadata)==null?void 0:a.priority)||0)+1;N=sP("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",Z,"playbackData",V,OkZ);g.t_(P,6);break;case 5:q=g.fJ(P);if(!(q instanceof Error&&q.message==="No data")){if(q instanceof Error&&q.message==="Empty response body")z8(q.message);else return D="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",O="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",q instanceof g.$G&&q.type==="QUOTA_EXCEEDED"&&(D="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
O="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),P.return(new QH("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",n,void 0,D,O));P.Zl(6);break}return g.U(P,Ji(L.W,Z),9);case 9:e=P.J;I=g.k(m.actionMetadata,jP);if(b=(t=I)==null?void 0:t.playlistId)e.playlistId=b;e.offlineDeleteReason="OFFLINE_DELETE_REASON_UNAVAILABLE";return g.U(P,SP(Z,L.W,m,L.G,e),6);case 6:return P.return(new QH("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",n,N?[N]:void 0))}})},waD=function(L,m){var n,C,Z,z,v,X,N,T,V,a;
return g.B(function(q){switch(q.W){case 1:return n=VH(m),g.M3(q,2),C=g.ot(m.entityKey).entityId,C==="!*$_ALL_ENTITIES_!*$"?g.U(q,CKZ(L.W,m,L.G,(V=m.actionMetadata)==null?void 0:(a=V.offlineLoggingData)==null?void 0:a.offlineDeleteReason),5):g.U(q,Ji(L.W,C),6);case 6:Z=q.J;z=g.k(m.actionMetadata,jP);if(X=(v=z)==null?void 0:v.playlistId)Z.playlistId=X;Z.offlineDeleteReason=(N=m.actionMetadata)==null?void 0:(T=N.offlineLoggingData)==null?void 0:T.offlineDeleteReason;return g.U(q,SP(C,L.W,m,L.G,Z),7);
case 7:if(!L.yd.N("woffle_enable_main_downloads_library")){q.Zl(5);break}return g.U(q,TzH(L.W,m.entityKey),5);case 5:g.t_(q,3);break;case 2:return g.fJ(q),q.return(new QH("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",n,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return q.return(new QH("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",n))}})},DL0=function(L,m,n,C,Z){var z,v,X,N,T,V;
return g.B(function(a){switch(a.W){case 1:if(z=C){a.Zl(2);break}return g.U(a,wOz([m]),3);case 3:v=a.J,z=v[0];case 2:return g.U(a,eAz(L,z,n,Z),4);case 4:X=a.J;N=X.mainVideoEntity;T=X.channelEntity;g.M3(a,5);var q=lE(N.thumbnail),D=lE(T.avatar);return g.U(a,M2(q.concat(D)),7);case 7:g.t_(a,0);break;case 5:V=g.fJ(a),V instanceof Error&&V.message==="Failed to fetch"&&z8(V.message),g.gp(a)}})},eAz=function(L,m,n,C){var Z,z,v,X,N,T,V,a,q,D,O,e,I;
return g.B(function(t){switch(t.W){case 1:n||(n=Date.now().toString());z=(Z=m.channel)==null?void 0:Z.offlineChannelData;v={id:g.cq(m.videoId,"ytMainChannelEntity"),channelId:z.channelId,title:z.title,avatar:z.thumbnail};X={key:g.cq(m.videoId,"mainVideoDownloadStateEntity"),playbackData:g.cq(m.videoId,"playbackData"),addedTimestampMillis:n,videoDownloadContextEntity:g.cq(m.videoId,"videoDownloadContextEntity")};N={key:g.cq(m.videoId,"videoPlaybackPositionEntity"),videoId:m.videoId,lastPlaybackPositionSeconds:"0"};
L.yd.N("html5_offline_playback_position_sync")&&(T={playbackPosition:N.key});V=g.cq(m.videoId,"mainVideoEntity");a={key:V,videoId:m.videoId,title:m.title,thumbnail:m.thumbnail,localizedStrings:{viewCount:m.shortViewCountText},userState:T,lengthSeconds:m.lengthSeconds?Number(m.lengthSeconds):void 0,publishedTimestampMillis:m.publishedTimestamp?(Number(m.publishedTimestamp)*1E3).toString():void 0,formattedDescription:m.description,owner:v.id,downloadState:X.key};if(!L.yd.N("woffle_enable_main_downloads_library")||
!C){t.Zl(2);break}return g.U(t,XO0(L.W,[V]),3);case 3:if(O=t.J)q=O.mainDownloadsLibraryEntity,D=O.mainDownloadsListEntity;case 2:return I=dpw,e={key:g.cq(m.videoId,"downloadStatusEntity"),downloadState:"DOWNLOAD_STATE_PENDING_DOWNLOAD"},g.pp(X,I,e),g.U(t,jj(L.W,{mode:"readwrite",Tb:!0},function(b){var P=dk(b,v,"ytMainChannelEntity"),F=dk(b,X,"mainVideoDownloadStateEntity"),r=dk(b,a,"mainVideoEntity");P=[P,F,r];L.yd.N("html5_offline_playback_position_sync")&&(F=dk(b,N,"videoPlaybackPositionEntity"),
P.push(F));q&&(F=dk(b,q,"mainDownloadsLibraryEntity"),P.push(F));D&&(F=dk(b,D,"mainDownloadsListEntity"),P.push(F));e&&(b=dk(b,e,"downloadStatusEntity"),P.push(b));return g.w9.all(P)}),4);
case 4:return t.return({mainVideoEntity:a,channelEntity:v})}})},gsD=function(L,m,n){this.W=L;
this.yd=m;this.G=n},SkF=function(L,m){var n,C,Z,z,v,X,N,T,V,a,q,D,O,e,I,t,b,P,F,r,x,Y,Ed,N3,ZF,$P,mZ;
return g.B(function(J_){switch(J_.W){case 1:return n=VH(m),C=[],g.U(J_,rk.getInstance(),2);case 2:Z=J_.J;if(!Z){J_.Zl(3);break}return g.U(J_,Z.get("sdois"),4);case 4:return z=J_.J,g.U(J_,(X=Z)==null?void 0:X.get("lmqf"),5);case 5:v=J_.J;case 3:g.M3(J_,6);if(z===void 0)throw Error("prefStorage or opt-in state is undefined");N=[];if(z){J_.Zl(8);break}return g.U(J_,EaF(L.W),9);case 9:N=J_.J,N.reverse();case 8:if(!N.length){J_.Zl(10);break}T=g.M(N);V=T.next();case 11:if(V.done){J_.Zl(10);break}a=V.value;
if(!a){J_.Zl(12);break}q=g.ot(a).entityId;return g.U(J_,Ji(L.W,q),14);case 14:return D=J_.J,D.offlineDeleteReason="OFFLINE_DELETE_REASON_PARENT_LIST_DELETE",g.U(J_,SP(q,L.W,{entityKey:a,actionType:m.actionType},L.G,D),12);case 12:V=T.next();J_.Zl(11);break;case 10:return g.U(J_,IK_(z,(O=v)!=null?O:"SD"),16);case 16:return e=J_.J,g.U(J_,ZrD(e),17);case 17:I=va_(e);if(!L.yd.N("woffle_enable_main_downloads_library")){J_.Zl(18);break}if(z){J_.Zl(19);break}return g.U(J_,TzH(L.W,g.hH),19);case 19:return g.U(J_,
NzH(L.W,[g.hH]),18);case 18:if((t=I)==null?0:t.length)for(b=g.M(I),P=b.next();!P.done;P=b.next())if(r=F=P.value,x=r.actionType,Y=r.entityKey,Ed=r.actionMetadata,x&&Y&&Ed&&!g.k(Ed,MbZ)){x==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(Ed.offlineLoggingData={offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});if(N3=g.k(F.actionMetadata,jP))N3.playlistId="DOWNLOADS_LIST_ENTITY_ID_SMART_DOWNLOADS",F.actionMetadata=Object.assign({},F.actionMetadata,{mainVideoEntityActionMetadata:N3});C.push(F)}g.t_(J_,
7);break;case 6:return ZF=g.fJ(J_),$P="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",mZ="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",ZF instanceof g.$G&&ZF.type==="QUOTA_EXCEEDED"&&($P="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",mZ="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),J_.return(new QH("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",n,void 0,$P,mZ));case 7:return J_.return(new QH("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",n,C))}})},IWo=function(){KL.apply(this,
arguments);
this.X="mainVideoEntity"},JXD=function(L,m,n){m=m===void 0?43200:m;
n=n===void 0?!0:n;var C=C===void 0?!1:C;var Z,z,v;return g.B(function(X){switch(X.W){case 1:if(!L.S.nh())return X.return([]);Z=[];g.M3(X,2);return g.U(X,MWr(m,n,C),4);case 4:Z=X.J;g.t_(X,3);break;case 2:z=g.fJ(X),z instanceof Error&&z.message==="No data"||z instanceof Error&&z.message==="Empty response body"&&z8(z.message);case 3:return v=ns0(L,Z,n,"mainPlaylistEntity"),X.return(v)}})},AXp=function(L,m,n,C){C=C===void 0?!1:C;
var Z,z,v,X,N,T,V,a,q,D,O,e,I,t,b;return g.B(function(P){switch(P.W){case 1:return Z=[],g.U(P,Sup(),2);case 2:return(z=P.J)||C?g.U(P,J90(m,n),3):P.return([]);case 3:v=P.J;if((X=v)==null||!X.length)return P.return([]);N={offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_REFRESH"};T=g.M(v);V=T.next();case 4:if(V.done){P.Zl(6);break}q=a=V.value;D=q.actionType;O=q.entityKey;e=q.actionMetadata;if(!(D&&O&&e)||g.k(e,MbZ)){P.Zl(5);break}D==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(e.offlineLoggingData=
N);I=g.ot(O);t=I.entityId;return g.U(P,xt(L,[t],"mainVideoEntity",D,e),8);case 8:b=P.J,Z=Z.concat(b);case 5:V=T.next();P.Zl(4);break;case 6:return P.return(Z)}})},bkJ=function(L,m){this.W=L;
this.G=m},fWf=function(L,m){var n,C,Z,z,v,X,N,T,V,a,q,D,O,e,I,t;
return g.B(function(b){switch(b.W){case 1:return n=VH(m),C=g.ot(m.entityKey),Z=C.entityId,z=[],g.M3(b,2),g.U(b,tbz(L,Z),4);case 4:z=b.J;if((v=z)==null||!v.length){b.Zl(5);break}return g.U(b,quw(L.W,m.entityKey),5);case 5:g.t_(b,3);break;case 2:return X=g.fJ(b),N="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",T="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",X instanceof g.$G&&X.type==="QUOTA_EXCEEDED"&&(N="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",T="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
b.return(new QH("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",n,void 0,N,T));case 3:return V=[],g.U(b,Kjl(L.W,"musicTrack",z),7);case 7:z=b.J;if(z.length)for(a=g.M(z),q=a.next();!q.done;q=a.next())if(D=q.value,O=D.offlineVideoData,e=void 0,(e=O)==null?0:e.videoId)I=void 0,t=Number(((I=m.actionMetadata)==null?void 0:I.priority)||0)+1,V.push(sP("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",O.videoId,"musicTrack",t,oR,fL(m,O,Z)));return b.return(new QH("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",n,V))}})},
UL_=function(L,m){var n,C,Z,z,v,X,N,T,V,a,q,D,O,e,I,t,b,P,F,r,x,Y,Ed,N3,ZF,$P,mZ,J_,xP,Vw,T0,h_,Bm,nX,Pz,k_,EC,f,UC,JJ,CJ,AJ,S,nJ,Au,y7,F$,KJ,mD,Zj,H_,J,w,A,Q,G,Ta,W,c;
return g.B(function(p){switch(p.W){case 1:return n=VH(m),C=m.entityKey,Z=g.ot(C).entityId,z=[],v=!1,Z==="!*$_ALL_ENTITIES_!*$"?(v=!0,g.U(p,LL(L.W,"musicAlbumRelease"),5)):g.U(p,cw(L.W,C,"musicAlbumRelease"),4);case 4:(X=p.J)&&z.push(X);p.Zl(3);break;case 5:z=p.J;case 3:if((N=z)==null||!N.length)return p.return(new QH("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",n));if(v){T=[];V=g.M(z);for(a=V.next();!a.done;a=V.next())q=a.value,D=g.ot(q.id).entityId,T.push(sP("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",
D,"musicAlbumRelease",0,oR));return p.return(new QH("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",n,T))}O=[];e=z[0];I=void 0;if(!e.downloadMetadata){p.Zl(6);break}return g.U(p,cw(L.W,e.downloadMetadata,"musicAlbumReleaseDownloadMetadataEntity"),7);case 7:t=p.J,I=Number((P=(b=t)==null?void 0:b.addedTimestampMillis)!=null?P:"0")/1E3;case 6:return g.M3(p,8),g.U(p,tbz(L,Z,(F=I)==null?void 0:F.toString()),10);case 10:O=p.J;g.t_(p,9);break;case 8:r=g.fJ(p);if(!(r instanceof Error&&r.message==="No data")){if(r instanceof
Error&&r.message==="Empty response body")z8(r.message);else return x="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",Y="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",r instanceof g.$G&&r.type==="QUOTA_EXCEEDED"&&(x="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",Y="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),p.return(new QH("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",n,void 0,x,Y));p.Zl(9);break}return g.U(p,bE(Z,"musicAlbumRelease",L.W,m,L.G),9);case 9:Ed=[];N3=new Map;
if((ZF=O)==null?0:ZF.length)for($P=g.M(O),mZ=$P.next();!mZ.done;mZ=$P.next())J_=mZ.value,xP=J_.offlineVideoData,Vw=void 0,((Vw=xP)==null?0:Vw.videoId)&&N3.set(xP.videoId,xP);T0=new Map;h_=[];if((Bm=e)==null?0:(nX=Bm.tracks)==null?0:nX.length)for(Pz=g.M(e.tracks),k_=Pz.next();!k_.done;k_=Pz.next())if(EC=k_.value,f=g.ot(EC).entityId)N3.has(f)?(T0.set(f,N3.get(f)),N3.delete(f)):h_.push(f);JJ=Number(((UC=m.actionMetadata)==null?void 0:UC.priority)||0)+1;CJ=g.M(N3.entries());for(AJ=CJ.next();!AJ.done;AJ=
CJ.next())S=AJ.value,nJ=g.M(S),Au=nJ.next().value,y7=nJ.next().value,F$=Au,KJ=y7,Ed.push(sP("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",F$,"musicTrack",JJ,oR,fL(m,KJ)));mD=g.M(T0.entries());for(Zj=mD.next();!Zj.done;Zj=mD.next())H_=Zj.value,J=g.M(H_),w=J.next().value,A=J.next().value,Q=w,G=A,Ed.push(sP("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",Q,"musicTrack",JJ,oR,fL(m,G)));Ta=g.M(h_);for(W=Ta.next();!W.done;W=Ta.next())c=W.value,Ed.push(sP("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",c,"musicTrack",
0,oR));return p.return(new QH("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",n,Ed))}})},Buw=function(L,m){var n,C;
return g.B(function(Z){switch(Z.W){case 1:return n=VH(m),g.M3(Z,2),C=g.ot(m.entityKey).entityId,C==="!*$_ALL_ENTITIES_!*$"?g.U(Z,ti(L.W,m,L.G),5):g.U(Z,bE(C,"musicAlbumRelease",L.W,m,L.G),6);case 6:return g.U(Z,Dg1(L.W,m.entityKey),5);case 5:g.t_(Z,3);break;case 2:return g.fJ(Z),Z.return(new QH("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",n,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return Z.return(new QH("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
n))}})},tbz=function(L,m,n){var C,Z,z;
return g.B(function(v){switch(v.W){case 1:return g.U(v,e_r([m]),2);case 2:return C=v.J,g.U(v,PPo(L,C[0],n),3);case 3:return Z=v.J,z=lE(Z.thumbnailDetails),g.U(v,M2(z),4);case 4:return v.return(C[0].videos)}})},PPo=function(L,m,n){var C,Z,z,v,X,N,T,V,a,q,D,O,e,I;
return g.B(function(t){if(t.W==1){C=m.additionalMetadadatas;Z=void 0;if(C&&C.length>0)for(z=g.M(C),v=z.next();!v.done;v=z.next())if(X=v.value,X.offlineMusicPlaylistData){Z=X.offlineMusicPlaylistData;break}N=m.playlistId;T=Orp(m);V=T.sB;a=T.gN;q=n?(Number(n)*1E3).toString():Date.now().toString();D=m.lastModifiedTimestamp?(Number(m.lastModifiedTimestamp)*1E3).toString():"0";O={id:g.cq(N,"musicAlbumReleaseDownloadMetadataEntity"),trackDownloadMetadatas:a,lastModifiedTimestampMillis:D,addedTimestampMillis:q,
syncState:"DOWNLOAD_SYNC_STATE_UP_TO_DATE"};e={id:g.cq(N,"musicAlbumRelease"),title:m.title,audioPlaylistId:N,trackCount:m.totalVideoCount,tracks:V,downloadMetadata:O.id};Z&&(e.thumbnailDetails=(I=Z.albumHqThumbnail)!=null?I:Z.albumArtistThumbnail,e.artistDisplayName=Z.albumArtistDisplayName,e.releaseDate=Z.albumReleaseDate,e.contentRating={explicitType:Z.albumReleaseExplicitType},e.releaseType=Z.albumReleaseType);return g.U(t,jj(L.W,{mode:"readwrite",Tb:!0},function(b){var P=dk(b,e,"musicAlbumRelease");
b=dk(b,O,"musicAlbumReleaseDownloadMetadataEntity");return g.w9.all([P,b])}),2)}return t.return(e)})},s0H=function(L,m){this.W=L;
this.G=m},paf=function(L,m){var n,C,Z,z,v,X,N,T,V,a,q,D,O,e,I,t;
return g.B(function(b){switch(b.W){case 1:return n=VH(m),C=g.ot(m.entityKey),Z=C.entityId,z=[],g.M3(b,2),g.U(b,Q0D(L,Z),4);case 4:z=b.J;if((v=z)==null||!v.length){b.Zl(5);break}return g.U(b,quw(L.W,m.entityKey),5);case 5:g.t_(b,3);break;case 2:return X=g.fJ(b),N="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",T="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",X instanceof g.$G&&X.type==="QUOTA_EXCEEDED"&&(N="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",T="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
b.return(new QH("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",n,void 0,N,T));case 3:return V=[],g.U(b,Kjl(L.W,"musicTrack",z),7);case 7:z=b.J;if(z.length)for(a=g.M(z),q=a.next();!q.done;q=a.next())if(D=q.value,O=D.offlineVideoData,e=void 0,(e=O)==null?0:e.videoId)I=void 0,t=Number(((I=m.actionMetadata)==null?void 0:I.priority)||0)+1,V.push(sP("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",O.videoId,"musicTrack",t,cU,fL(m,O,Z)));return b.return(new QH("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",n,V))}})},
Ft$=function(L,m){var n,C,Z,z,v,X,N,T,V,a,q,D,O,e,I,t,b,P,F,r,x,Y,Ed,N3,ZF,$P,mZ,J_,xP,Vw,T0,h_,Bm,nX,Pz,k_,EC,f,UC,JJ,CJ,AJ,S,nJ,Au,y7,F$,KJ,mD,Zj,H_,J,w,A,Q,G,Ta,W,c,p,A_,Or,X8,X$,YP,IU,Lm,I1,up,bg,ey;
return g.B(function(Ud){switch(Ud.W){case 1:return n=VH(m),C=m.entityKey,Z=g.ot(C).entityId,z=[],v=!1,Z==="!*$_ALL_ENTITIES_!*$"?(v=!0,g.U(Ud,LL(L.W,"musicPlaylist"),5)):g.U(Ud,cw(L.W,C,"musicPlaylist"),4);case 4:(X=Ud.J)&&z.push(X);Ud.Zl(3);break;case 5:z=Ud.J;case 3:if((N=z)==null||!N.length)return Ud.return(new QH("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",n));T=g.k(m.actionMetadata,lKH);a=(V=T)==null?void 0:V.autoSync;q=[];O=D=!0;e=!1;I=void 0;if(!v&&a===!1){Ud.Zl(6);break}g.M3(Ud,7);return g.U(Ud,
A9D(0,!!a,!0,z),9);case 9:q=Ud.J;g.t_(Ud,8);break;case 7:t=g.fJ(Ud);if(!(t instanceof Error&&t.message==="No data")){t instanceof Error&&t.message==="Empty response body"&&z8(t.message);Ud.Zl(8);break}return Z==="!*$_ALL_ENTITIES_!*$"?g.U(Ud,ti(L.W,m,L.G),8):g.U(Ud,bE(Z,"musicPlaylist",L.W,m,L.G),8);case 8:if(!q.length||!v&&q[0].playlistId!==Z)return Ud.return(new QH("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",n));case 6:if(v){b=[];P=g.M(q);for(F=P.next();!F.done;F=P.next())r=F.value,r.upToDate||
a&&!r.shouldAutoSyncMetadata||!r.playlistId||(x={autoSync:a},b.push(sP("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",r.playlistId,"musicPlaylist",0,cU,{musicPlaylistEntityActionMetadata:x})));return Ud.return(new QH("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",n,b))}q.length&&(Y=q[0],e=!!Y.upToDate,a&&(D=(Ed=Y.shouldAutoSyncMetadata)!=null?Ed:!0,O=(N3=Y.shouldAutoSyncVideos)!=null?N3:!0,Y.checkInSeconds&&(I=Y.checkInSeconds)));if(e||!D)return Ud.return(new QH("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
n));ZF=[];$P=z[0];mZ=void 0;if(!$P.downloadMetadata){Ud.Zl(15);break}return g.U(Ud,cw(L.W,$P.downloadMetadata,"musicPlaylistDownloadMetadataEntity"),16);case 16:J_=Ud.J,mZ=Number((Vw=(xP=J_)==null?void 0:xP.addedTimestampMillis)!=null?Vw:"0")/1E3;case 15:return g.M3(Ud,17),g.U(Ud,Q0D(L,Z,(T0=mZ)==null?void 0:T0.toString(),I),19);case 19:ZF=Ud.J;g.t_(Ud,18);break;case 17:h_=g.fJ(Ud);if(!(h_ instanceof Error&&h_.message==="No data")){if(h_ instanceof Error&&h_.message==="Empty response body")z8(h_.message);
else return Bm="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",nX="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",h_ instanceof g.$G&&h_.type==="QUOTA_EXCEEDED"&&(Bm="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",nX="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),Ud.return(new QH("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",n,void 0,Bm,nX));Ud.Zl(18);break}return g.U(Ud,bE(Z,"musicPlaylist",L.W,m,L.G),18);case 18:if(!O)return Ud.return(new QH("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
n));Pz=[];k_=new Map;if((EC=ZF)==null?0:EC.length)for(f=g.M(ZF),UC=f.next();!UC.done;UC=f.next())JJ=UC.value,CJ=JJ.offlineVideoData,AJ=void 0,((AJ=CJ)==null?0:AJ.videoId)&&k_.set(CJ.videoId,CJ);S=new Map;nJ=[];if((Au=$P)==null?0:(y7=Au.tracks)==null?0:y7.length)for(F$=g.M($P.tracks),KJ=F$.next();!KJ.done;KJ=F$.next())if(mD=KJ.value,Zj=g.ot(mD).entityId)k_.has(Zj)?(S.set(Zj,k_.get(Zj)),k_.delete(Zj)):nJ.push(Zj);J=Number(((H_=m.actionMetadata)==null?void 0:H_.priority)||0)+1;w=g.M(k_.entries());for(A=
w.next();!A.done;A=w.next())Q=A.value,G=g.M(Q),Ta=G.next().value,W=G.next().value,c=Ta,p=W,Pz.push(sP("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",c,"musicTrack",J,cU,fL(m,p)));A_=g.M(S.entries());for(Or=A_.next();!Or.done;Or=A_.next())X8=Or.value,X$=g.M(X8),YP=X$.next().value,IU=X$.next().value,Lm=YP,I1=IU,Pz.push(sP("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",Lm,"musicTrack",J,cU,fL(m,I1)));up=g.M(nJ);for(bg=up.next();!bg.done;bg=up.next())ey=bg.value,Pz.push(sP("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",
ey,"musicTrack",0,cU));return Ud.return(new QH("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",n,Pz))}})},uUl=function(L,m){var n,C;
return g.B(function(Z){switch(Z.W){case 1:return n=VH(m),g.M3(Z,2),C=g.ot(m.entityKey).entityId,C==="!*$_ALL_ENTITIES_!*$"?g.U(Z,ti(L.W,m,L.G),5):g.U(Z,bE(C,"musicPlaylist",L.W,m,L.G),6);case 6:return g.U(Z,Dg1(L.W,m.entityKey),5);case 5:g.t_(Z,3);break;case 2:return g.fJ(Z),Z.return(new QH("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",n,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return Z.return(new QH("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
n))}})},Q0D=function(L,m,n,C){var Z,z,v;
return g.B(function(X){switch(X.W){case 1:return g.U(X,e_r([m]),2);case 2:return Z=X.J,g.U(X,hAl(L,Z[0],n,C),3);case 3:return z=X.J,v=lE(z.thumbnailDetails),g.U(X,M2(v),4);case 4:return X.return(Z[0].videos)}})},hAl=function(L,m,n,C){var Z,z,v,X,N,T,V,a,q;
return g.B(function(D){return D.W==1?(Z=m.playlistId,z=Orp(m),v=z.sB,X=z.gN,N=n?(Number(n)*1E3).toString():Date.now().toString(),T=m.lastModifiedTimestamp?(Number(m.lastModifiedTimestamp)*1E3).toString():"0",V={id:g.cq(Z,"musicPlaylistDownloadMetadataEntity"),trackDownloadMetadatas:X,lastModifiedTimestampMillis:T,addedTimestampMillis:N,syncState:"DOWNLOAD_SYNC_STATE_UP_TO_DATE"},a={id:g.cq(Z,"musicPlaylist"),title:m.title,playlistId:Z,thumbnailDetails:m.thumbnail,visibility:rX1(m),trackCount:m.totalVideoCount,
tracks:v,downloadMetadata:V.id},C&&(((q=a)==null?0:q.entityMetadata)?a.entityMetadata.nextAutoRefreshIntervalSeconds=String(C):a&&(a.entityMetadata={nextAutoRefreshIntervalSeconds:String(C)})),g.U(D,jj(L.W,{mode:"readwrite",Tb:!0},function(O){var e=dk(O,a,"musicPlaylist");O=dk(O,V,"musicPlaylistDownloadMetadataEntity");return g.w9.all([e,O])}),2)):D.return(a)})},rX1=function(L){switch(L.privacy){case "PRIVATE":return"PLAYLIST_ENTITY_VISIBILITY_PRIVATE";
case "PUBLIC":return"PLAYLIST_ENTITY_VISIBILITY_PUBLIC";case "UNLISTED":return"PLAYLIST_ENTITY_VISIBILITY_UNLISTED";default:return"PLAYLIST_ENTITY_VISIBILITY_UNKNOWN"}},knH=function(L,m){this.W=L;
this.G=m},Gnr=function(L,m){var n,C,Z,z,v,X,N,T,V,a,q,D,O;
return g.B(function(e){switch(e.W){case 1:return n=VH(m),C=g.ot(m.entityKey),Z=C.entityId,z=g.k(m.actionMetadata,Hk1),g.M3(e,2),g.U(e,YkD(L,Z,void 0,(v=z)==null?void 0:v.track,(X=z)==null?void 0:X.albumRelease),4);case 4:if((N=z)==null?0:N.playlistId){e.Zl(5);break}return g.U(e,quw(L.W,m.entityKey),5);case 5:g.t_(e,3);break;case 2:return T=g.fJ(e),V="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",a="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",T instanceof g.$G&&T.type==="QUOTA_EXCEEDED"&&
(V="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",a="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),e.return(new QH("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",n,void 0,V,a));case 3:D=Number(((q=m.actionMetadata)==null?void 0:q.priority)||0)+1;var I=(I=g.k(m.actionMetadata,Hk1))?{playbackDataActionMetadata:{maximumDownloadQuality:I.maximumDownloadQuality}}:void 0;O=sP("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",Z,"playbackData",D,WtH,I);return e.return(new QH("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
n,[O]))}})},dLJ=function(L,m){var n,C,Z,z,v,X,N,T,V,a,q,D,O,e,I;
return g.B(function(t){switch(t.W){case 1:return n=VH(m),C=g.ot(m.entityKey),Z=C.entityId,g.U(t,cw(L.W,m.entityKey,"musicTrack"),2);case 2:z=t.J;if(!z){v=void 0;t.Zl(3);break}return g.U(t,cw(L.W,z.downloadMetadata,"musicTrackDownloadMetadataEntity"),4);case 4:v=t.J;case 3:X=v;if(!z||!X)return t.return(new QH("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",n));T=g.k(m.actionMetadata,Hk1);g.M3(t,5);return g.U(t,YkD(L,Z,X.addedTimestampMillis,(V=T)==null?void 0:V.track,(a=T)==null?void 0:a.albumRelease),
7);case 7:D=Number(((q=m.actionMetadata)==null?void 0:q.priority)||0)+1;N=sP("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",Z,"playbackData",D,WtH);g.t_(t,6);break;case 5:O=g.fJ(t);if(!(O instanceof Error&&O.message==="No data")){if(O instanceof Error&&O.message==="Empty response body")z8(O.message);else return e="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",I="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",O instanceof g.$G&&O.type==="QUOTA_EXCEEDED"&&(e="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
I="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),t.return(new QH("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",n,void 0,e,I));t.Zl(6);break}return g.U(t,Ai(Z,L.W,m,L.G),6);case 6:return t.return(new QH("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",n,N?[N]:void 0))}})},Ktp=function(L,m){var n,C;
return g.B(function(Z){switch(Z.W){case 1:return n=VH(m),g.M3(Z,2),C=g.ot(m.entityKey).entityId,C==="!*$_ALL_ENTITIES_!*$"?g.U(Z,ti(L.W,m,L.G),5):g.U(Z,Ai(C,L.W,m,L.G),6);case 6:return g.U(Z,Dg1(L.W,m.entityKey),5);case 5:g.t_(Z,3);break;case 2:return g.fJ(Z),Z.return(new QH("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",n,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return Z.return(new QH("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
n))}})},YkD=function(L,m,n,C,Z){var z,v,X,N,T,V;
return g.B(function(a){switch(a.W){case 1:if(z=C){a.Zl(2);break}return g.U(a,wOz([m]),3);case 3:v=a.J,X=v[0],z=aKZ(X);case 2:return g.U(a,xLF(L,z,m,Z,n),4);case 4:N=a.J;T=N.musicTrackEntity;V=N.Yt;var q=lE(T.thumbnailDetails),D=[];V&&(D=lE(V.thumbnailDetails));return g.U(a,M2(q.concat(D)),0)}})},xLF=function(L,m,n,C,Z){var z;
return g.B(function(v){return v.W==1?(Z||(Z=Date.now().toString()),z={id:g.cq(n,"musicTrackDownloadMetadataEntity"),playbackData:g.cq(n,"playbackData"),addedTimestampMillis:Z,videoDownloadContextEntity:g.cq(n,"videoDownloadContextEntity")},C&&(m.albumRelease=C.id),g.U(v,jj(L.W,{mode:"readwrite",Tb:!0},function(X){var N=[],T=dk(X,z,"musicTrackDownloadMetadataEntity");N.push(T);T=dk(X,m,"musicTrack");N.push(T);C&&(X=dk(X,C,"musicAlbumRelease"),N.push(X));return g.w9.all(N)}),2)):v.W!=3?g.U(v,q2(n,"musicTrackDownloadMetadataEntity",
L.W,"DOWNLOAD_STATE_PENDING_DOWNLOAD"),3):v.return({musicTrackEntity:m,
Yt:C})})},Ld=function(){KL.apply(this,arguments);
this.X="musicTrack"},yXf=function(L,m,n){m=m===void 0?43200:m;
n=n===void 0?!0:n;var C=C===void 0?!1:C;var Z,z;return g.B(function(v){switch(v.W){case 1:if(!L.S.nh())return v.return([]);Z=[];g.M3(v,2);return g.U(v,A9D(m,n,C),4);case 4:Z=v.J;g.t_(v,3);break;case 2:g.fJ(v);case 3:return z=ns0(L,Z,n,"musicPlaylist"),v.return(z)}})},j0p=function(){g.S2.apply(this,arguments);
var L=this;this.events=new g.tC(this);this.yd=this.player.D();this.Xe={KPN:function(){return L.W},
qa:function(){return L.qa()},
Zy:function(m){return L.Zy(m)}}},osJ=function(L){var m;
L=g.k((m=L.getWatchNextResponse())==null?void 0:m.currentVideoEndpoint,g.t1);if(L==null?0:L.playlistId)var n=L.playlistId;return n},cX1=function(L,m){var n,C,Z,z;
return g.B(function(v){if(v.W==1){n=m.clientPlaybackNonce;C={cpn:n,offlineSourceVisualElement:g.Rh(m.Je||"").getAsJson(),selectedOfflineMode:"OFFLINE_NOW",isPartialPlayback:!1};m.J&&(C.videoFmt=Number(m.J.itag));m.L&&(C.audioFmt=Number(m.L.itag));if((Z=osJ(m))&&m.videoId){var X=m.videoId;X=Z!=="PPSV"?Promise.resolve(!1):L.W.xI(X);v=g.U(v,X,3)}else v=v.Zl(2);return v}v.W!=2&&(z=v.J)&&(C.selectedOfflineMode="OFFLINE_MODE_TYPE_AUTO_OFFLINE");L.J=n;g.vE("offlinePlaybackStarted",C);g.gp(v)})};
g.yE.prototype.QR=g.za(45,function(L){return this.app.QR(L)});
g.RY.prototype.QR=g.za(44,function(L){return g.z4d(this,9,L)});
g.R(u1,Fz);g.vm.Object.defineProperties(u1.prototype,{entityMetadata:{configurable:!0,enumerable:!0,get:function(){return this.W.entityMetadata},
set:function(L){this.W.entityMetadata=L}}});
g.R(koH,u1);koH.prototype.J=function(){return[]};
g.R(HAF,u1);HAF.prototype.J=function(){return[]};
g.R(YUw,u1);YUw.prototype.J=function(){return[]};
g.R(WUz,u1);WUz.prototype.J=function(){return[]};
g.R(Gof,u1);Gof.prototype.J=function(){return[]};
g.R(dTp,u1);dTp.prototype.J=function(){var L=[];this.W.alternateChannel&&L.push(this.W.alternateChannel);this.W.alternateChannelList&&L.push.apply(L,g.q3(this.W.alternateChannelList));this.W.oneofChannelEntity&&L.push(this.W.oneofChannelEntity);return[].concat(g.q3(new Set(L)))};
g.R(KU1,u1);KU1.prototype.J=function(){var L=[];this.W.entryCollection&&L.push(this.W.entryCollection);return[].concat(g.q3(new Set(L)))};
g.R(xTH,Fz);xTH.prototype.J=function(){var L=[];this.W.video&&L.push(this.W.video);return[].concat(g.q3(new Set(L)))};
g.R(yx$,u1);yx$.prototype.J=function(){var L=[];this.W.parentPlaylist&&L.push(this.W.parentPlaylist);if(this.W.entries)for(var m=g.M(this.W.entries),n=m.next();!n.done;n=m.next())L.push.apply(L,g.q3((new xTH(n.value)).J()));return[].concat(g.q3(new Set(L)))};
g.R(jEF,u1);jEF.prototype.J=function(){var L=[];this.W.descriptionEntity&&L.push(this.W.descriptionEntity);this.W.creators&&L.push.apply(L,g.q3(this.W.creators));this.W.theBiggestFan&&L.push(this.W.theBiggestFan);return[].concat(g.q3(new Set(L)))};
g.R(ocZ,u1);ocZ.prototype.J=function(){return[]};
g.R(cxf,u1);cxf.prototype.J=function(){return[]};
g.R(LV$,u1);LV$.prototype.J=function(){return[]};
g.R(mEr,u1);mEr.prototype.J=function(){return[]};
g.R(ndf,u1);ndf.prototype.J=function(){return[]};
g.R(C7f,u1);C7f.prototype.J=function(){return[]};
g.R(ZqD,u1);ZqD.prototype.J=function(){return[]};
g.R(zHJ,u1);zHJ.prototype.J=function(){return[]};
g.R(vd0,u1);vd0.prototype.J=function(){return[]};
g.R(EdJ,u1);EdJ.prototype.J=function(){var L=[];this.W.downloadsList&&L.push(this.W.downloadsList);this.W.smartDownloadsList&&L.push(this.W.smartDownloadsList);this.W.recommendedDownloadsList&&L.push(this.W.recommendedDownloadsList);this.W.refresh&&L.push(this.W.refresh);return[].concat(g.q3(new Set(L)))};
g.R(Xlr,Fz);Xlr.prototype.J=function(){var L=[];this.W.video&&L.push(this.W.video);this.W.playlist&&L.push(this.W.playlist);this.W.videoItem&&L.push(this.W.videoItem);this.W.playlistItem&&L.push(this.W.playlistItem);return[].concat(g.q3(new Set(L)))};
g.R(No1,u1);No1.prototype.J=function(){var L=[];this.W.refresh&&L.push(this.W.refresh);if(this.W.downloads)for(var m=g.M(this.W.downloads),n=m.next();!n.done;n=m.next())L.push.apply(L,g.q3((new Xlr(n.value)).J()));return[].concat(g.q3(new Set(L)))};
g.R(ToJ,u1);ToJ.prototype.J=function(){var L=[];this.W.localImageEntities&&L.push.apply(L,g.q3(this.W.localImageEntities));return[].concat(g.q3(new Set(L)))};
g.R(VUD,u1);VUD.prototype.J=function(){var L=[];this.W.playbackData&&L.push(this.W.playbackData);this.W.localImageEntities&&L.push.apply(L,g.q3(this.W.localImageEntities));this.W.videoDownloadContextEntity&&L.push(this.W.videoDownloadContextEntity);return[].concat(g.q3(new Set(L)))};
g.R(iqF,u1);iqF.prototype.J=function(){return[]};
g.R($EF,u1);$EF.prototype.J=function(){var L=[];this.W.fakeChildren&&L.push.apply(L,g.q3(this.W.fakeChildren));return[].concat(g.q3(new Set(L)))};
g.R(anl,u1);anl.prototype.J=function(){var L=[];this.W.video&&L.push(this.W.video);this.W.playbackData&&L.push(this.W.playbackData);this.W.offlineVideoPolicy&&L.push(this.W.offlineVideoPolicy);return[].concat(g.q3(new Set(L)))};
g.R(qRH,u1);qRH.prototype.J=function(){return[]};
g.R(DEp,u1);DEp.prototype.J=function(){var L=[];this.W.channelOwner&&L.push(this.W.channelOwner);this.W.videos&&L.push.apply(L,g.q3(this.W.videos));this.W.collaboratorChannels&&L.push.apply(L,g.q3(this.W.collaboratorChannels));this.W.downloadState&&L.push(this.W.downloadState);this.W.refresh&&L.push(this.W.refresh);return[].concat(g.q3(new Set(L)))};
g.R(Oqp,u1);Oqp.prototype.J=function(){var L=[];this.W.video&&L.push(this.W.video);this.W.channelContributor&&L.push(this.W.channelContributor);return[].concat(g.q3(new Set(L)))};
g.R(lnF,Fz);lnF.prototype.J=function(){var L=[];this.W.localImageEntities&&L.push.apply(L,g.q3(this.W.localImageEntities));this.W.videoDownloadContextEntity&&L.push(this.W.videoDownloadContextEntity);return[].concat(g.q3(new Set(L)))};
g.R(RHJ,Fz);RHJ.prototype.J=function(){var L=[];this.W.recommendedVideoMetadata&&L.push.apply(L,g.q3((new lnF(this.W.recommendedVideoMetadata)).J()));return[].concat(g.q3(new Set(L)))};
g.R(wlf,Fz);wlf.prototype.J=function(){var L=[];this.W.playbackPosition&&L.push(this.W.playbackPosition);return[].concat(g.q3(new Set(L)))};
g.R(eH$,u1);eH$.prototype.J=function(){var L=[];this.W.owner&&L.push(this.W.owner);this.W.downloadState&&L.push(this.W.downloadState);this.W.userState&&L.push.apply(L,g.q3((new wlf(this.W.userState)).J()));this.W.additionalMetadata&&L.push.apply(L,g.q3((new RHJ(this.W.additionalMetadata)).J()));return[].concat(g.q3(new Set(L)))};
g.R(gdF,u1);gdF.prototype.J=function(){var L=[];this.W.userChannelDetails&&L.push(this.W.userChannelDetails);return[].concat(g.q3(new Set(L)))};
g.R(MUl,u1);MUl.prototype.J=function(){var L=[];this.W.channelOwner&&L.push(this.W.channelOwner);this.W.playbackPosition&&L.push(this.W.playbackPosition);this.W.localImageEntities&&L.push.apply(L,g.q3(this.W.localImageEntities));this.W.downloadStatus&&L.push(this.W.downloadStatus);return[].concat(g.q3(new Set(L)))};
g.R(SRF,u1);SRF.prototype.J=function(){return[]};
g.R(In1,u1);In1.prototype.J=function(){return[]};
g.R(Jd0,u1);Jd0.prototype.J=function(){return[]};
g.R(AdZ,u1);AdZ.prototype.J=function(){return[]};
g.R(bqZ,u1);bqZ.prototype.J=function(){return[]};
g.R(tU$,u1);tU$.prototype.J=function(){return[]};
g.R(fnw,u1);fnw.prototype.J=function(){return[]};
g.R(UEr,u1);UEr.prototype.J=function(){return[]};
g.R(BoF,u1);BoF.prototype.J=function(){return[]};
g.R(P7r,u1);P7r.prototype.J=function(){return[]};
g.R(sAo,u1);sAo.prototype.J=function(){return[]};
g.R(QAZ,u1);QAZ.prototype.J=function(){return[]};
g.R(pll,u1);pll.prototype.J=function(){var L=[];this.W.trackDownloadMetadatas&&L.push.apply(L,g.q3(this.W.trackDownloadMetadatas));return[].concat(g.q3(new Set(L)))};
g.R(FVZ,u1);
FVZ.prototype.J=function(){var L=[];this.W.downloadedTracks&&L.push.apply(L,g.q3(this.W.downloadedTracks));this.W.smartDownloadedTracks&&L.push.apply(L,g.q3(this.W.smartDownloadedTracks));this.W.downloadedEpisodes&&L.push.apply(L,g.q3(this.W.downloadedEpisodes));this.W.downloadedAlbumReleases&&L.push.apply(L,g.q3(this.W.downloadedAlbumReleases));this.W.smartDownloadedAlbumReleases&&L.push.apply(L,g.q3(this.W.smartDownloadedAlbumReleases));this.W.downloadedPlaylists&&L.push.apply(L,g.q3(this.W.downloadedPlaylists));this.W.smartDownloadedPlaylists&&
L.push.apply(L,g.q3(this.W.smartDownloadedPlaylists));this.W.metadataOnlyTracks&&L.push.apply(L,g.q3(this.W.metadataOnlyTracks));return[].concat(g.q3(new Set(L)))};
g.R(uHf,u1);uHf.prototype.J=function(){var L=[];this.W.trackDownloadMetadatas&&L.push.apply(L,g.q3(this.W.trackDownloadMetadatas));return[].concat(g.q3(new Set(L)))};
g.R(hHD,u1);hHD.prototype.J=function(){var L=[];this.W.playbackData&&L.push(this.W.playbackData);this.W.localImageEntities&&L.push.apply(L,g.q3(this.W.localImageEntities));this.W.videoDownloadContextEntity&&L.push(this.W.videoDownloadContextEntity);return[].concat(g.q3(new Set(L)))};
g.R(rdH,u1);rdH.prototype.J=function(){var L=[];this.W.musicLibraryStatusEntity&&L.push(this.W.musicLibraryStatusEntity);this.W.primaryArtists&&L.push.apply(L,g.q3(this.W.primaryArtists));this.W.details&&L.push(this.W.details);this.W.userDetails&&L.push(this.W.userDetails);this.W.tracks&&L.push.apply(L,g.q3(this.W.tracks));this.W.share&&L.push(this.W.share);this.W.downloadMetadata&&L.push(this.W.downloadMetadata);this.W.refresh&&L.push(this.W.refresh);return[].concat(g.q3(new Set(L)))};
g.R(kNw,u1);kNw.prototype.J=function(){var L=[];this.W.albumRelease&&L.push(this.W.albumRelease);this.W.tracks&&L.push.apply(L,g.q3(this.W.tracks));return[].concat(g.q3(new Set(L)))};
g.R(Hq$,u1);Hq$.prototype.J=function(){var L=[];this.W.albumRelease&&L.push(this.W.albumRelease);return[].concat(g.q3(new Set(L)))};
g.R(YRr,u1);YRr.prototype.J=function(){var L=[];this.W.details&&L.push(this.W.details);this.W.userDetails&&L.push(this.W.userDetails);return[].concat(g.q3(new Set(L)))};
g.R(WVH,u1);WVH.prototype.J=function(){var L=[];this.W.parentArtist&&L.push(this.W.parentArtist);return[].concat(g.q3(new Set(L)))};
g.R(GN$,u1);GN$.prototype.J=function(){var L=[];this.W.parentArtist&&L.push(this.W.parentArtist);return[].concat(g.q3(new Set(L)))};
g.R(dE_,u1);dE_.prototype.J=function(){return[]};
g.R(KVw,u1);KVw.prototype.J=function(){return[]};
g.R(xEr,Fz);xEr.prototype.J=function(){var L=[];this.W.creatorEntity&&L.push(this.W.creatorEntity);return[].concat(g.q3(new Set(L)))};
g.R(yd0,u1);
yd0.prototype.J=function(){var L=[];this.W.tracks&&L.push.apply(L,g.q3(this.W.tracks));this.W.refresh&&L.push(this.W.refresh);this.W.musicLibraryStatusEntity&&L.push(this.W.musicLibraryStatusEntity);this.W.details&&L.push(this.W.details);this.W.downloadMetadata&&L.push(this.W.downloadMetadata);this.W.sideloadMetadata&&L.push(this.W.sideloadMetadata);this.W.userDetails&&L.push(this.W.userDetails);this.W.entryCollection&&L.push(this.W.entryCollection);this.W.share&&L.push(this.W.share);this.W.podcastShowAdditionalMetadata&&
L.push.apply(L,g.q3((new xEr(this.W.podcastShowAdditionalMetadata)).J()));return[].concat(g.q3(new Set(L)))};
g.R(jAD,u1);jAD.prototype.J=function(){return[]};
g.R(odz,u1);
odz.prototype.J=function(){var L=[];this.W.musicLibraryStatusEntity&&L.push(this.W.musicLibraryStatusEntity);this.W.artists&&L.push.apply(L,g.q3(this.W.artists));this.W.audioModeVersion&&L.push(this.W.audioModeVersion);this.W.videoModeVersion&&L.push(this.W.videoModeVersion);this.W.userDetails&&L.push(this.W.userDetails);this.W.details&&L.push(this.W.details);this.W.albumRelease&&L.push(this.W.albumRelease);this.W.share&&L.push(this.W.share);this.W.libraryEdit&&L.push(this.W.libraryEdit);this.W.downloadMetadata&&
L.push(this.W.downloadMetadata);this.W.playbackPosition&&L.push(this.W.playbackPosition);this.W.lyrics&&L.push(this.W.lyrics);return[].concat(g.q3(new Set(L)))};
g.R(cdp,u1);cdp.prototype.J=function(){var L=[];this.W.parentTrack&&L.push(this.W.parentTrack);return[].concat(g.q3(new Set(L)))};
g.R(LY_,u1);LY_.prototype.J=function(){var L=[];this.W.parentTrack&&L.push(this.W.parentTrack);return[].concat(g.q3(new Set(L)))};
g.R(mFH,u1);mFH.prototype.J=function(){return[]};
g.R(noH,u1);noH.prototype.J=function(){return[]};
g.R(CSw,u1);CSw.prototype.J=function(){return[]};
g.R(ZGz,u1);ZGz.prototype.J=function(){return[]};
g.R(zS_,u1);zS_.prototype.J=function(){var L=[];this.W.transfer&&L.push(this.W.transfer);this.W.adsPlaybackData&&L.push.apply(L,g.q3(this.W.adsPlaybackData));this.W.drmLicense&&L.push(this.W.drmLicense);this.W.offlineVideoPolicy&&L.push(this.W.offlineVideoPolicy);this.W.videoDownloadContextEntity&&L.push(this.W.videoDownloadContextEntity);return[].concat(g.q3(new Set(L)))};
g.R(vow,u1);vow.prototype.J=function(){return[]};
g.R(Eol,u1);Eol.prototype.J=function(){var L=[];this.W.offlineVideoStreams&&L.push.apply(L,g.q3(this.W.offlineVideoStreams));this.W.captionTrack&&L.push.apply(L,g.q3(this.W.captionTrack));return[].concat(g.q3(new Set(L)))};
g.R(XRD,u1);XRD.prototype.J=function(){return[]};
g.R(NFZ,u1);NFZ.prototype.J=function(){return[]};
g.R(TFH,u1);TFH.prototype.J=function(){return[]};
g.R(V1Z,u1);V1Z.prototype.J=function(){return[]};
g.R(iGw,u1);iGw.prototype.J=function(){return[]};
g.R($F_,u1);$F_.prototype.J=function(){return[]};
g.R(akH,u1);akH.prototype.J=function(){return[]};
g.R(qqz,u1);qqz.prototype.J=function(){return[]};
g.R(DFp,u1);DFp.prototype.J=function(){return[]};
g.R(OGp,u1);OGp.prototype.J=function(){return[]};
g.R(lk_,u1);lk_.prototype.J=function(){return[]};
g.R(RS1,u1);RS1.prototype.J=function(){return[]};
g.R(wRf,u1);wRf.prototype.J=function(){return[]};
g.R(eSw,u1);eSw.prototype.J=function(){return[]};
g.R(go$,u1);go$.prototype.J=function(){return[]};
g.R(M10,u1);M10.prototype.J=function(){return[]};
g.R(Sqf,u1);Sqf.prototype.J=function(){return[]};
g.R(Ik_,u1);Ik_.prototype.J=function(){return[]};
g.R(J50,u1);J50.prototype.J=function(){return[]};
g.R(A5p,u1);A5p.prototype.J=function(){return[]};
g.R(bG1,u1);bG1.prototype.J=function(){return[]};
g.R(t1Z,u1);t1Z.prototype.J=function(){return[]};
var brf=["browse","music/browse","unplugged/browse"],PK_=["offline/playlist_sync_check"],R_f=["offline"],tWr=["offline/offline_video_playback_position_sync"],Ug_=["offline/get_playback_data_entity"],he;rk.getInstance=function(){return g.B(function(L){return L.return(new Promise(function(m){g.y3().then(function(n){n?(rk.instance||(rk.instance=new rk(n)),m(rk.instance)):m(void 0)})}))})};
rk.prototype.get=function(L){var m=this,n,C,Z;return g.B(function(z){if(z.W==1)return g.U(z,PS_(m.token),2);if(z.W!=3)return n=z.J,g.U(z,n.get("prefs",L),3);C=z.J;if(!C)return z.return();Z=(0,g.SI)();return C.expirationTimestampMs<=Z?z.return():z.return(C.value)})};
rk.prototype.set=function(L,m,n){n=n===void 0?31536E3:n;var C=this,Z,z,v;return g.B(function(X){if(X.W==1)return Z=(0,g.SI)(),z={key:L,value:m,expirationTimestampMs:Z+n*1E3},g.U(X,PS_(C.token),2);v=X.J;return g.U(X,g.UD(v,"prefs",z),0)})};
rk.prototype.remove=function(L){var m=this,n;return g.B(function(C){if(C.W==1)return g.U(C,PS_(m.token),2);n=C.J;return g.U(C,n.delete("prefs",L),0)})};
g.R(k$,g.YZ);g.R(Hw,uN0);Hw.prototype.G=function(L,m){m=r5p(m);L=(new TextEncoder).encode(JSON.stringify(L));return this.W.encrypt(L,m)};
Hw.prototype.J=function(L,m){if(!(L instanceof Uint8Array))throw sFf(1);var n=new TextDecoder;m=r5p(m);L=this.W.decrypt(L,m);return JSON.parse(n.decode(L))};
var kFr={accountLinkStatusEntity:LV$,booleanEntity:WUz,buttonEntity:go$,captionTrack:mFH,channelHandle:koH,chipEntity:akH,commerceAcquisitionClientPayloadEntity:Sqf,commerceCartListEntity:Ik_,contextNoteFeedEntityPayload:HAF,contextNoteUserRatingEntityPayload:YUw,continuationTokenEntity:qRH,downloadQualityPickerEntity:ZqD,downloadsPageRefreshTokenEntity:vd0,downloadsPageViewConfigurationEntity:SRF,downloadStatusEntity:zHJ,dismissState:qqz,sfvAudioItemCurrentlyPlayingEntity:V1Z,emojiFountainDataEntity:wRf,
emojiCustomizationSetEntity:RS1,fakeChannel:dTp,fakePlaylist:KU1,fakePlaylistEntryCollection:yx$,fakeVideo:jEF,fakeVideoDescription:ocZ,featuredProductsEntity:P7r,flowStateEntity:cxf,iconBadgeEntity:J50,interstitialInteractionStateEntity:ndf,likeButtonAnimationEntity:In1,liveChatPollStateEntity:C7f,dataFreshnessEntity:lk_,liveViewerLeaderboardChatEntryPointStateEntity:NFZ,liveViewerLeaderboardPointsEntity:TFH,liveReactionsDataEntity:eSw,logoEntity:mEr,macroMarkerEntity:Jd0,mainDownloadsLibraryEntity:EdJ,
mainDownloadsListEntity:No1,mainPlaylistDownloadStateEntity:ToJ,mainPlaylistEntity:DEp,mainPlaylistVideoEntity:Oqp,mainVideoDownloadStateEntity:VUD,mainVideoEntity:eH$,markersEngagementPanelSyncEntity:AdZ,markersVisibilityOverrideEntity:bqZ,musicAlbumReleaseDetail:kNw,musicAlbumReleaseDownloadMetadataEntity:pll,musicAlbumRelease:rdH,musicAlbumReleaseUserDetail:Hq$,musicArtistDetail:WVH,musicArtist:YRr,musicArtistUserDetail:GN$,musicDownloadsLibraryEntity:FVZ,musicLibraryEdit:dE_,musicLibraryStatusEntity:KVw,
musicPlaylist:yd0,musicPlaylistDownloadMetadataEntity:uHf,musicShare:jAD,musicTrackDetail:cdp,musicTrackDownloadMetadataEntity:hHD,musicTrack:odz,musicTrackUserDetail:LY_,offlineOrchestrationActionWrapperEntity:noH,offlineVideoPolicy:CSw,offlineVideoStreams:ZGz,offlineabilityEntity:iqF,orchestrationWebSamplingEntity:$EF,pageHeaderEntity:DFp,pdpStateEntity:A5p,pinnedProductEntity:sAo,playbackData:zS_,playerStateEntity:tU$,quantityIncrementerEntity:bG1,refresh:vow,saveToPlaylistListEntity:iGw,selectedChipIndexEntityPayload:fnw,
settingEntity:$F_,stringEntity:Gof,suggestedFeedbackChipStateEntity:UEr,transfer:Eol,trendingOfferEntity:QAZ,videoDownloadContextEntity:XRD,videoOverviewAsyncDataEntity:t1Z,videoPlaybackPositionEntity:M10,votingEntity:OGp,ytMainChannelEntity:gdF,youchatPendingResponseEntity:BoF,ytMainDownloadedVideoEntity:anl,ytMainVideoEntity:MUl};g.R(x$,uN0);x$.prototype.G=function(L){return L};
x$.prototype.J=function(L){if(L instanceof Uint8Array)throw sFf(0);return L};
g.R(yV,g.u);yV.prototype.observe=function(L){var m=this;this.observers.push(L);return function(){var n=m.observers.indexOf(L);n>=0&&m.observers.splice(n,1)}};
yV.prototype.J=function(L){nz0(this,L.data)};
yV.prototype.Go=function(){this.channel.close()};
var EzJ,z_F=new g.JX("elementsCommand");var IR=new g.JX("entityBatchUpdate");var dpw=new g.JX("downloadStatusEntity");var XaD=new g.JX("mainPlaylistEntityActionMetadata");var jP=new g.JX("mainVideoEntityActionMetadata");var lKH=new g.JX("musicPlaylistEntityActionMetadata");var Hk1=new g.JX("musicTrackEntityActionMetadata");var MbZ=new g.JX("localImageEntityActionMetadata");var pL=new g.JX("playbackDataActionMetadata");var zkZ=new g.JX("transferEntityActionMetadata");var Wr$=new g.JX("videoPlaybackPositionEntityActionMetadata");var gzf;new g.$z;new g.$z;Akf.prototype.request=function(L,m,n){m=m===void 0?{}:m;return this.locks.request(L,m,function(C){return n(C)})};var ZN=g.oU.caches,CL,BIw;nL.prototype.open=function(L){return ZN.open(fGD(L))};
nL.prototype.has=function(L){return ZN.has(fGD(L))};
nL.prototype.delete=function(L){return ZN.delete(fGD(L))};
nL.prototype.match=function(L,m){var n=this,C,Z,z,v,X,N;return g.B(function(T){switch(T.W){case 1:return g.U(T,n.keys(),2);case 2:C=T.J,Z=g.M(C),z=Z.next();case 3:if(z.done){T.Zl(5);break}v=z.value;return g.U(T,n.open(v),6);case 6:return X=T.J,g.U(T,X.match(L,m),7);case 7:if(N=T.J)return T.return(N);z=Z.next();T.Zl(3);break;case 5:return T.return()}})};
g.R(tJD,nL);tJD.prototype.keys=function(){var L,m,n,C,Z,z,v,X,N;return g.B(function(T){if(T.W==1)return L=[],m=g.WW("CacheStorage keys"),g.U(T,ZN.keys(),2);n=T.J;C=g.M(n);for(Z=C.next();!Z.done;Z=C.next()){z=Z.value;var V=z.indexOf(":");v=V===-1?{Yq:z}:{Yq:z.substring(0,V),datasyncId:z.substring(V+1)};X=v.Yq;N=v.datasyncId;N===m&&L.push(X)}return T.return(L)})};g.R(vU,g.u);vU.prototype.G=function(L){this.api.Vd("onOfflineOperationFailure",L.data)};
vU.prototype.L=function(L){this.api.publish("offlinetransferpause",L.data)};
vU.prototype.Go=function(){var L;(L=this.W)==null||L.close();var m;(m=this.J)==null||m.close()};QsD.prototype.oU=function(){this.W&&XF(this)};
QsD.prototype.FY=function(){this.J&&this.J.resolve();this.G=this.W=!1;this.X()};var ekF=["OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD","OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"];var naw="captionTrack downloadStatusEntity ytMainChannelEntity mainPlaylistEntity mainPlaylistDownloadStateEntity mainPlaylistVideoEntity mainVideoEntity mainVideoDownloadStateEntity offlineVideoPolicy offlineVideoStreams playbackData transfer videoDownloadContextEntity videoPlaybackPositionEntity".split(" ");var $g1="downloadStatusEntity musicAlbumRelease musicDownloadsLibraryEntity musicPlaylist musicTrack musicTrackDownloadMetadataEntity offlineVideoPolicy offlineVideoStreams playbackData transfer videoDownloadContextEntity".split(" ");g.R(Qap,PU);Qap.prototype.J=function(L){return iE(L)?uG0(this,L):$t(L)?kYw(this,L):Promise.reject(Error("Unsupported action type: "+L.actionType))};g.R(Hrw,PU);Hrw.prototype.J=function(L){return $t(L)?Yu$(this,L):GJl(L)?GYo(this,L):aR(L)?dgr(this,L):Promise.reject(Error("Unsupported action type: "+L.actionType))};g.l=Kr0.prototype;g.l.l0K=function(L){var m=this,n,C,Z,z;return g.B(function(v){if(!g.d(L.state,128))return v.Zl(0);n=L.state.T5;var X=(C=n)==null?void 0:C.errorCode,N=(Z=n)==null?void 0:Z.N0;z=X==="net.connect"&&N===1?"TRANSFER_FAILURE_REASON_NETWORK_LOST":(X==null?0:X.startsWith("net."))?"TRANSFER_FAILURE_REASON_NETWORK":"TRANSFER_FAILURE_REASON_INTERNAL";return g.U(v,m.GR(m.player.getVideoData().videoId,z),0)})};
g.l.GR=function(L,m){var n=this;return g.B(function(C){if(C.W==1){if(n.J)return C.return();n.J=!0;return m==="TRANSFER_FAILURE_REASON_NETWORK_LOST"?(hi(n,L,!1,!0),C.Zl(0)):g.U(C,uE(n,L),3)}g.Tq(L,4);return g.U(C,n.W.GR(m),0)})};
g.l.kp=function(L){L.status===2?(L.status!==this.G&&(HMF(this.W),g.Tq(L.videoId,2)),L.wG&&K__(this.W,L.videoId,L.wG)):L.status===4?(uE(this,L.videoId),this.GR(L.videoId,L.a7?"TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":"TRANSFER_FAILURE_REASON_INTERNAL")):L.status===1&&d8J(this.W);this.G=L.status;this.api.Vd("localmediachange",{videoId:L.videoId,status:L.status})};
g.l.Jn=function(){var L=this,m;return g.B(function(n){if(n.W==1){if(L.J)return n.return();L.J=!0;m=L.player.getVideoData().videoId;return g.U(n,uE(L,m),2)}return g.U(n,L.W.Jn(),0)})};
g.l.hS=function(L){switch(L){case "HD_1080":return"hd1080";case "HD":return"hd720";case "SD":return"large";case "LD":return"tiny";default:return"hd720"}};
g.l.N=function(L){return this.api.D().N(L)};g.R(L_l,PU);L_l.prototype.J=function(L){return iE(L)?n0p(this,L):$t(L)?Czz(this,L):GJl(L)?ZMw(this,L):Promise.reject(Error("Unsupported action type: "+L.actionType))};TLr.prototype.W=function(L,m){var n=L.action.actionMetadata.priority-m.action.actionMetadata.priority;n===0&&(L.W<m.W?n=-1:L.W>m.W&&(n=1));return n};g.R(ri,g.u);ri.prototype.Go=function(){this.X&&this.X();g.u.prototype.Go.call(this)};
ri.prototype.createAction=function(L,m){var n=g.ot(L.entityKey).entityType,C=g.lt(16);return new RR(n,C,L,m.actionId,m.rootActionId)};
ri.prototype.Je=function(L){var m=this,n,C,Z,z,v,X,N,T,V;return g.B(function(a){if(a.W==1){if(m.FK())return a.return();C=(n=L.offlineOrchestrationActionWrapperEntity)!=null?n:new Set;Z=[];z=g.M(C);for(v=z.next();!v.done;v=z.next())X=v.value,N=g.ot(X),T=N.entityId,$8p(m.W,T)||Z.push(X);return g.U(a,Si$(m,Z),2)}V=a.J;return g.U(a,Ml$(m,V),0)})};
ri.prototype.retry=function(){var L=this;return g.B(function(m){return g.U(m,IHJ(L),0)})};AU_.prototype.TM=function(L,m){m=m===void 0?!0:m;var n=this,C,Z,z,v,X,N,T,V;return g.B(function(a){switch(a.W){case 1:if(!n.W)return a.return();C=[];Z=g.Cy(n.W.J,m);z=[];for(v={fb:0};v.fb<Z.length;v={fb:v.fb},v.fb++)X=Z[v.fb],N=n.W.pw(X,"json3"),T=g.t2(N,{withCredentials:!0,format:"RAW"},3,500).then(function(q){return function(D){D={metadata:g.xw(Z[q.fb]),trackData:D.xhr.responseText};z.push(D)}}(v)).Cv(function(q){z8("Caption fetch error",q)}),C.push(T);
return g.U(a,rx_(C),2);case 2:return g.M3(a,3),g.U(a,qVz(L,z),5);case 5:g.t_(a,0);break;case 3:V=g.fJ(a),z8("Caption DB transaction error",V),g.gp(a)}})};g.R(kt,g.u);kt.prototype.Go=function(){this.J&&this.J();g.u.prototype.Go.call(this)};
kt.prototype.G=function(L){var m=this,n,C,Z,z,v,X,N,T;return g.B(function(V){C=(n=L.transfer)!=null?n:new Set;Z=[];z=g.M(C);for(v=z.next();!v.done;v=z.next())X=v.value,N=g.ot(X),T=N.entityId,Z.push(T);return Z.length===0?V.return():g.U(V,fH0(m,Z),0)})};g.R(Qmf,g.u);g.l=Qmf.prototype;g.l.Go=function(){this.LI&&this.LI();this.aj.dispose();this.L.dispose();this.rd&&g.cl(this.S.b2,this.rd);this.SD&&g.cl(this.S.b2,this.SD);g.u.prototype.Go.call(this)};
g.l.ZXK=function(L){var m=this,n,C,Z;return g.B(function(z){switch(z.W){case 1:n=g.cq(L,"transfer");if(m.W&&n===m.W.key){hi(m.B,m.K,!0);m.L.stop();z.Zl(0);break}return g.U(z,jj(m.J,{mode:"readwrite",Tb:!0},function(v){return Y$(v,n,"transfer").then(function(X){if(X&&X.transferState!=="TRANSFER_STATE_COMPLETE"&&X.transferState!=="TRANSFER_STATE_FAILED")return X.transferState="TRANSFER_STATE_PAUSED_BY_USER",dk(v,X,"transfer").then(function(){return X})})}),3);
case 3:C=z.J;if(!C){z.Zl(0);break}if(!L||!m.G){z.Zl(5);break}return g.U(z,q2(L,m.G,m.J,"DOWNLOAD_STATE_PAUSED"),5);case 5:return g.U(z,WU(m,L),7);case 7:Z=z.J,YVD({videoId:L,jZ:C,offlineModeType:Z}),g.gp(z)}})};
g.l.a$b=function(){var L=this;if(this.W&&this.K){hi(this.B,this.K,!1);var m=this.W,n=(m==null?0:m.key)?g.ot(m.key).entityId:"";n&&this.G&&(new Promise(function(C,Z){q2(n,L.G,L.J,"DOWNLOAD_STATE_PAUSED").catch(function(z){Z(z)})})).catch(function(C){z8("Download state setting error",C)})}this.L.stop()};
g.l.BI=function(){this.W?uX0(this,this.W):Yt(this)};
g.l.hc=function(L){var m=this;return g.B(function(n){switch(n.W){case 1:if(!m.W){n.Zl(2);break}if(m.W.transferState==="TRANSFER_STATE_COMPLETE"||m.W.transferState==="TRANSFER_STATE_FAILED"||!L.transfer||!L.transfer.has(m.W.key)){n.Zl(3);break}return g.U(n,cw(m.J,m.W.key,"transfer"),4);case 4:m.W=n.J;if(m.W){n.Zl(3);break}return g.U(n,hk_(m),3);case 3:if(m.W)return n.return();case 2:return g.U(n,Yt(m),0)}})};
g.l.GR=function(L,m){var n=this,C,Z,z,v,X;return g.B(function(N){switch(N.W){case 1:if(!n.W){G8(n,"onTransferFailure: "+L);N.Zl(2);break}C=n.W;z=((Z=C)==null?0:Z.key)?g.ot(C.key).entityId:"";a:switch(L){case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_PLAYABILITY":case "TRANSFER_FAILURE_REASON_TOO_MANY_RETRIES":var T=!1;break a;default:T=!0}return T&&x8w(n)?g.U(N,di(n,"TRANSFER_STATE_TRANSFER_IN_QUEUE"),8):g.U(N,
yU0(n,L),5);case 5:if(!z||!n.G){N.Zl(2);break}return g.U(N,q2(z,n.G,n.J,"DOWNLOAD_STATE_FAILED"),2);case 8:return g.U(N,WU(n,z),9);case 9:v=N.J;T8({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_RETRY"},{videoId:z,jZ:C,offlineModeType:v});if(!z||!n.G){N.Zl(2);break}return g.U(N,q2(z,n.G,n.J,"DOWNLOAD_STATE_RETRYABLE_FAILURE"),2);case 2:HU(n),X=Yt(n,!0),m&&m(X),g.gp(N)}})};
g.l.Jn=function(L){var m=this,n,C,Z,z,v,X,N,T,V,a,q,D;return g.B(function(O){switch(O.W){case 1:if(!m.W){G8(m,"onMaybeTransferStreamsExpired");O.Zl(2);break}return x8w(m)?g.U(O,di(m,"TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH"),9):g.U(O,yU0(m,"TRANSFER_FAILURE_REASON_STREAM_MISSING"),5);case 5:if(!m.G){O.Zl(2);break}n=m.W;Z=((C=n)==null?0:C.key)?g.ot(n.key).entityId:"";if(!Z){O.Zl(2);break}return g.U(O,q2(Z,m.G,m.J,"DOWNLOAD_STATE_FAILED"),2);case 9:return m.W||G8(m,"onMaybeTransferStreamsExpiredRetryAttempting"),
z=m.W,X=((v=z)==null?0:v.key)?g.ot(z.key).entityId:"",g.U(O,WU(m,X),10);case 10:return N=O.J,T8({transferStatusType:"TRANSFER_STATUS_TYPE_DEQUEUED_BY_PLAYER_RESPONSE_EXPIRATION"},{videoId:X,jZ:z,offlineModeType:N}),T=ykH(),g.pp(T,pL,{isEnqueuedForExpiredStreamUrlRefetch:!0}),V=g.cq(X,"playbackData"),a={actionType:"OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",entityKey:V,actionMetadata:T},q=eP(new RR("playbackData",X,a)),g.U(O,o2(m.J,q,"offlineOrchestrationActionWrapperEntity"),2);case 2:HU(m),D=Yt(m,!0),
L&&L(D),g.gp(O)}})};
var LPz={},jm$=(LPz.TRANSFER_STATE_TRANSFERRING=1,LPz.TRANSFER_STATE_TRANSFER_IN_QUEUE=2,LPz);g.l=KL.prototype;g.l.oi=function(){return this.K.promise};
g.l.Wn=function(){if(this.J&&this.B)return this.K.promise;Ltr(this).then(this.K.resolve).catch(this.K.reject);return this.K.promise};
g.l.OA=function(L){var m={};return m.playbackData=new Qap(L,this.yd,this.W),m.transfer=new L_l(L,this.yd),m.videoPlaybackPositionEntity=new Hrw(L,this.yd),m};
g.l.K1=function(){var L=this;return g.B(function(m){return L.J?g.U(m,puw(L.J),0):m.Zl(0)})};
g.l.kM=function(){var L=this,m,n;return g.B(function(C){if(C.W==1)return L.J||L.B?g.U(C,L.oi(),2):C.return();L.C!==void 0&&(g.lV(L.C),L.C=void 0);L.L!==void 0&&(g.lV(L.L),L.L=void 0);(m=L.J)==null||m.dispose();L.J=void 0;(n=L.B)==null||n.dispose();L.B=void 0;L.api.Vd("onOrchestrationLostLeader");L.K=new g.$z;g.gp(C)})};
g.l.isOrchestrationLeader=function(){return this.G.W};
g.l.xI=function(){return g.B(function(L){return L.return(!1)})};
g.l.By=function(L){var m=this.W;m.api.publish("offlinetransferpause",L);var n;(n=m.J)==null||n.postMessage(L)};
g.l.BI=function(L){var m,n;return g.B(function(C){if(C.W==1)return g.U(C,ms(),2);m=C.J;if(!m)return C.return();n=g.cq(L,"transfer");return g.U(C,jj(m,{mode:"readwrite",Tb:!0},function(Z){var z=Y$(Z,n,"transfer"),v=Y$(Z,g.cq(L,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.w9.all([z,v]).then(function(X){X=g.M(X);var N=X.next().value;var T=X.next().value;return N&&N.transferState==="TRANSFER_STATE_PAUSED_BY_USER"?(N.transferState="TRANSFER_STATE_TRANSFER_IN_QUEUE",dk(Z,N,"transfer").then(function(){T8({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_USER_RESUME",
statusType:"USER_RESUMED"},{videoId:L,jZ:N,offlineModeType:T==null?void 0:T.offlineModeType});return g.w9.resolve(null)})):g.w9.resolve(null)})}),0)})};
g.l.Xl=function(L){L=L===void 0?43200:L;var m=this,n,C,Z,z,v,X,N,T;return g.B(function(V){if(V.W==1)return m.S.nh()?g.U(V,ms(),2):V.return(mL_());if(V.W!=3){n=V.J;if(!n)return V.return([]);C=Date.now()/1E3;return g.U(V,LL(n,"offlineVideoPolicy"),3)}Z=V.J;z=[];v=g.M(Z);for(X=v.next();!X.done;X=v.next())N=X.value,Number(N.lastUpdatedTimestampSeconds)+L<=C&&(T=g.ot(N.key).entityId,z.push(T));return z.length?V.return(xt(m,z,m.X,"OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH")):V.return([])})};
g.l.deleteAll=function(){return xt(this,["!*$_ALL_ENTITIES_!*$"],this.X,"OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",{offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_USER_INITIATED"}})};
g.l.refreshAllStaleEntities=function(L){var m=this;return g.B(function(n){return n.W==1?g.U(n,m.Xl(L),2):n.return(n.J)})};
g.l.setUpPositionSyncInterval=function(L){var m=this;this.L!==void 0&&(g.lV(this.L),this.L=void 0);var n=L!=null?L:864E5;this.L=g.DC(function(){m.Rb(n)},n)};
g.l.Rb=function(L){var m=this,n,C,Z,z,v,X;return g.B(function(N){switch(N.W){case 1:return g.M3(N,2),g.U(N,rk.getInstance(),4);case 4:n=N.J;if(!n)throw Error("prefStorage is undefined");return g.U(N,n.get("psi"),5);case 5:C=N.J;z=((Z=C)==null?0:Z.zj)?Number(C.zj)/1E3:0;v=Date.now();if(!(z+L<=v)){N.Zl(6);break}return g.U(N,xt(m,["!*$_ALL_ENTITIES_!*$"],"videoPlaybackPositionEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"),6);case 6:g.t_(N,0);break;case 2:X=g.fJ(N),z8("Offline manager error",X),
g.gp(N)}})};
g.l.n1=function(){var L=this,m,n,C,Z,z,v,X;return g.B(function(N){if(N.W==1)return g.U(N,ms(),2);if(N.W!=3)return(m=N.J)?g.U(N,LL(m,"transfer"),3):N.return([]);n=N.J;C=[];Z=g.M(n);for(z=Z.next();!z.done;z=Z.next())v=z.value,v.transferState==="TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH"&&v.key&&(X=g.ot(v.key).entityId,C.push(X));return N.return(CPr(L,C))})};
g.l.xR=function(){return g.B(function(L){return L.return([])})};
g.l.RO=function(){return g.B(function(L){g.gp(L)})};
g.l.TC=function(){return g.B(function(L){g.gp(L)})};g.R(Zk0,PU);Zk0.prototype.J=function(L){return iE(L)?Esz(this,L):$t(L)?Nu1(this,L):aR(L)?Tuo(this,L):Promise.reject(Error("Unsupported action type: "+L.actionType))};
var yH=[10];g.R(qkH,PU);qkH.prototype.J=function(L){return iE(L)?lWF(this,L):$t(L)?RAD(this,L):aR(L)?waD(this,L):Promise.reject(Error("Unsupported action type: "+L.actionType))};
var OkZ=[10];g.R(gsD,PU);gsD.prototype.J=function(L){return $t(L)?SkF(this,L):Promise.reject(Error("Unsupported action type: "+L.actionType))};g.R(IWo,KL);g.l=IWo.prototype;g.l.OA=function(L){var m=KL.prototype.OA.call(this,L);m.mainVideoEntity=new qkH(L,this.yd,this.W);m.mainPlaylistEntity=new Zk0(L,this.yd,this.W);m.mainDownloadsListEntity=new gsD(L,this.yd,this.W);return m};
g.l.refreshAllStaleEntities=function(L,m){var n=this,C,Z,z,v,X,N,T,V,a,q,D;return g.B(function(O){switch(O.W){case 1:C=[];if(!n.yd.N("web_player_offline_playlist_auto_refresh")){O.Zl(2);break}return g.U(O,JXD(n,L,m),3);case 3:C=O.J;case 2:return g.U(O,rk.getInstance(),4);case 4:return Z=O.J,g.U(O,(z=Z)==null?void 0:z.get("sdois"),5);case 5:return v=O.J,g.U(O,(X=Z)==null?void 0:X.get("lmqf"),6);case 6:N=O.J;if(!v){O.Zl(7);break}V=C;a=V.concat;return g.U(O,AXp(n,v,(T=N)!=null?T:"SD",L===0),8);case 8:C=
a.call(V,O.J);case 7:return q=C,D=q.concat,g.U(O,KL.prototype.refreshAllStaleEntities.call(n,L,m),9);case 9:return C=D.call(q,O.J),O.return(C)}})};
g.l.xI=function(L){var m,n,C,Z,z,v,X,N;return g.B(function(T){if(T.W==1)return g.U(T,ms(),2);if(T.W!=3)return(m=T.J)?g.U(T,cw(m,g.hH,"mainDownloadsListEntity"),3):T.return(!1);n=T.J;if((C=n)==null?0:(Z=C.downloads)==null?0:Z.length)for(z=g.cq(L,"mainVideoEntity"),v=g.M(n.downloads),X=v.next();!X.done;X=v.next())if(N=X.value,N.videoItem===z)return T.return(!0);return T.return(!1)})};
g.l.xR=function(){var L=this,m,n,C,Z,z,v,X,N;return g.B(function(T){if(T.W==1)return g.U(T,ms(),2);if(T.W!=3)return(m=T.J)?g.U(T,LL(m,"downloadStatusEntity"),3):T.return([]);n=T.J;C=[];Z=g.M(n);for(z=Z.next();!z.done;z=Z.next())v=z.value,v.downloadState==="DOWNLOAD_STATE_USER_DELETED"&&v.key&&(X=g.ot(v.key).entityId,C.push(X));return C.length?(N={offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_USER_INITIATED"}},T.return(xt(L,C,"mainVideoEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",
N))):T.return([])})};
g.l.TC=function(){var L;return g.B(function(m){return m.W==1?g.U(m,ms(),2):(L=m.J)?g.U(m,jj(L,{mode:"readwrite",Tb:!0},function(n){return Ww(n,"mainVideoEntity").then(function(C){var Z=[];C=g.M(C);for(var z=C.next();!z.done;z=C.next()){z=z.value;var v=void 0;(v=z.userState)!=null&&v.playbackPosition||(v=g.ot(z.key).entityId,v={key:g.cq(v,"videoPlaybackPositionEntity"),videoId:v,lastPlaybackPositionSeconds:"0"},Z.push(dk(n,v,"videoPlaybackPositionEntity")),z.userState={playbackPosition:v.key},Z.push(dk(n,
z,"mainVideoEntity")))}return g.w9.all(Z)})}),0):m.return()})};
g.l.RO=function(){var L,m,n,C,Z,z,v,X,N,T,V,a,q,D,O,e,I,t,b,P,F,r,x,Y,Ed,N3,ZF,$P,mZ,J_,xP,Vw,T0,h_,Bm,nX,Pz,k_;return g.B(function(EC){if(EC.W==1)return g.U(EC,ms(),2);if(EC.W!=3){L=EC.J;if(!L)return EC.return();m=g.cq("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity");return g.U(EC,jj(L,{mode:"readonly",Tb:!0},function(f){return g.w9.all([Y$(f,m,"mainDownloadsListEntity"),Y$(f,g.hH,"mainDownloadsListEntity"),Ww(f,"mainVideoEntity"),Ww(f,"mainPlaylistEntity")])}),3)}n=EC.J;
C=g.M(n);Z=C.next().value;z=C.next().value;v=C.next().value;X=C.next().value;N=Z;T=z;V=v;a=X;q=new Set;if((D=N)==null?0:(O=D.downloads)==null?0:O.length)for(e=g.M(N.downloads),I=e.next();!I.done;I=e.next())t=I.value,b=void 0,(P=(b=t.videoItem)!=null?b:t.playlistItem)&&q.add(P);if((F=T)==null?0:(r=F.downloads)==null?0:r.length)for(x=g.M(T.downloads),Y=x.next();!Y.done;Y=x.next())Ed=Y.value,Ed.videoItem&&q.add(Ed.videoItem);N3=new Set;ZF=[];$P=g.M(a);for(mZ=$P.next();!mZ.done;mZ=$P.next()){J_=mZ.value;
if(J_.videos)for(xP=g.M(J_.videos),Vw=xP.next();!Vw.done;Vw=xP.next())T0=Vw.value,(h_=JSON.parse(g.ot(T0).entityId).videoId)&&N3.add(h_);J_.key&&!q.has(J_.key)&&ZF.push(J_.key)}Bm=g.M(V);for(nX=Bm.next();!nX.done;nX=Bm.next())Pz=nX.value,Pz.key&&!q.has(Pz.key)&&(k_=g.ot(Pz.key).entityId,N3.has(k_)||ZF.push(Pz.key));return ZF.length?g.U(EC,NzH(L,ZF),0):EC.Zl(0)})};g.R(bkJ,PU);bkJ.prototype.J=function(L){return iE(L)?fWf(this,L):$t(L)?UL_(this,L):aR(L)?Buw(this,L):Promise.reject(Error("Unsupported action type: "+L.actionType))};
var oR=[10];g.R(s0H,PU);s0H.prototype.J=function(L){return iE(L)?paf(this,L):$t(L)?Ft$(this,L):aR(L)?uUl(this,L):Promise.reject(Error("Unsupported action type: "+L.actionType))};
var cU=[10];g.R(knH,PU);knH.prototype.J=function(L){return iE(L)?Gnr(this,L):$t(L)?dLJ(this,L):aR(L)?Ktp(this,L):Promise.reject(Error("Unsupported action type: "+L.actionType))};
var WtH=[10];g.R(Ld,KL);Ld.prototype.OA=function(L){var m=KL.prototype.OA.call(this,L);m.musicTrack=new knH(L,this.W);m.musicPlaylist=new s0H(L,this.W);m.musicAlbumRelease=new bkJ(L,this.W);return m};
Ld.prototype.refreshAllStaleEntities=function(L,m){var n=this,C,Z,z;return g.B(function(v){if(v.W==1)return g.U(v,yXf(n,L,m),2);if(v.W!=3)return Z=C=v.J,z=Z.concat,g.U(v,KL.prototype.refreshAllStaleEntities.call(n,L,m),3);C=z.call(Z,v.J);return v.return(C)})};g.R(j0p,g.S2);g.l=j0p.prototype;g.l.create=function(){var L=this;g.h(this,this.events);if(g.bB(this.yd))this.W=new IWo(this.yd,this.player);else if(g.p5(this.yd)||g.f4(this.yd))this.W=new Ld(this.yd,this.player);this.events.j(this.player,"onPlaybackStartExternal",function(){L.qa()});
this.events.j(this.player,"videodatachange",function(){L.qa()});
this.yd.N("html5_offline_playback_position_sync")&&this.events.j(this.player,"presentingplayerstatechange",this.Zy)};
g.l.l2=function(){return!1};
g.l.D6=function(L,m,n,C){var Z=this;return g.B(function(z){return Z.W?z.return(xt(Z.W,L,m,n,C)):z.return(Promise.reject())})};
g.l.deleteAll=function(){return this.W.deleteAll()};
g.l.Xl=function(L){return this.W.Xl(L)};
g.l.refreshAllStaleEntities=function(L){return this.W.refreshAllStaleEntities(L)};
g.l.setUpPositionSyncInterval=function(L){this.W.setUpPositionSyncInterval(L)};
g.l.By=function(L){this.W.By(L)};
g.l.BI=function(L){return this.W.BI(L)};
g.l.qa=function(){var L=this,m;return g.B(function(n){m=L.player.getVideoData();return g.Ms(m)?osJ(m)&&L.J!==m.clientPlaybackNonce?g.U(n,cX1(L,m),0):n.Zl(0):n.return()})};
g.l.Zy=function(L){var m=this,n,C,Z,z,v,X,N;return g.B(function(T){if(T.W==1)return n=m.player.getVideoData(),C=n.R6,g.av(L,2)||g.av(L,512)?g.U(T,ms(),2):T.return();if(T.W!=3){Z=T.J;if(!Z)return z8("PES is undefined"),T.return();z=n.videoId;return g.U(T,cw(Z,g.cq(z,"mainVideoEntity"),"mainVideoEntity"),3)}v=T.J;if(!v)return T.return();X=Math.floor(C).toString();N={videoPlaybackPositionEntityActionMetadata:{lastPlaybackPositionSeconds:X}};return g.U(T,m.D6([z],"videoPlaybackPositionEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_UPDATE",
N),0)})};
g.l.isOrchestrationLeader=function(){return this.W.isOrchestrationLeader()};
g.l.updateDownloadState=function(L,m){var n,C,Z,z;return g.B(function(v){if(v.W==1)return g.U(v,ms(),2);n=v.J;if(!n)return z8("PES is undefined"),v.return();C=g.ot(L);Z=C.entityType;z=C.entityId;return g.U(v,q2(z,Z,n,m,!0),0)})};g.Md("offline",j0p);})(_yt_player);
